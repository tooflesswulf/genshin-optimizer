"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[328],{89721:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Eo});var a=n(96e3),i=n(85439),r=n(36380),l=n(61391),s=n(60319),o=n(68826),c=n(32782),d=n(67550),u=n(79906),h=n(7671),Z=n(38484),p=n(78287),m=n(83249),f=n(2784),g=n(21560),b=n(73557),v=n(39857),x=n(87985),y=n(67937),w=n(72055),C=n(69360),k=n(97859),B=n(83673),S=n(53710),X=n(790),j=n(63762);const P=(0,f.createContext)({});var O=n(32718),E=n(25870),K=n(94657),M=n(44304),A=n(50670),D=n(10002),I=n(44942),T=n(47165),R=n(36893),_=n(20536),L=n(6794),G=n(56748),$=n(97856),z=n(52903);const N=f.lazy((()=>n.e(592).then(n.bind(n,1296))));function V(){var e;const{t}=(0,g.$G)("page_character"),{characterSheet:n,character:{key:a}}=(0,f.useContext)(S.K),[i,r]=(0,f.useState)(!1),{gender:l}=(0,D.Z)(),s=(0,$.Z)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(f.Suspense,{fallback:!1,children:(0,z.tZ)(N,{show:i,onHide:()=>r(!1),onSelect:s})}),(0,z.tZ)(m.Z,{color:"info",onClick:()=>r(!0),startIcon:(0,z.tZ)(G.Z,{src:(0,L.Li)(a,"iconSide",l)}),children:null!=(e=null==n?void 0:n.name)?e:t("selectCharacter")})]})}var W=n(84485),q=n(42523),F=n(56961),H=n(23570),U=n(2995),Y=n(62197),J=n(35322),Q=n(17447),ee=n(86113),te=n(2344),ne=n(26578),ae=n(98927),ie=n(99625),re=n(61278);function le(){const{modalOpen:e}=(0,f.useContext)(j.M),{setFormulaData:t}=(0,f.useContext)(j.M),n=(0,f.useCallback)((()=>null==t?void 0:t(void 0,void 0)),[t]);return(0,z.tZ)(ae.Z,{open:!!e,onClose:n,children:(0,z.BX)(x.Z,{children:[(0,z.tZ)(q.Z,{title:"Formulas & Calculations",action:(0,z.tZ)(w.Z,{onClick:n})}),(0,z.tZ)(h.Z,{sx:{pt:0},children:(0,z.tZ)(se,{})})]})})}function se(){const{data:e}=(0,f.useContext)(X.R),{data:t}=(0,f.useContext)(j.M),n=(0,ie.U)(null!=t?t:e);return(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:1e3}),children:(0,z.tZ)(d.Z,{sx:{mr:-1,mb:-1},children:n.map((([e,t])=>(0,z.tZ)(oe,{displayNs:t,sectionKey:e},e)))})})}function oe({sectionKey:e,displayNs:t}){const{data:n}=(0,f.useContext)(X.R),{database:a}=(0,f.useContext)(E.t),{data:i}=(0,f.useContext)(j.M),r=(0,f.useMemo)((()=>(0,ie.f)(null!=i?i:n,e,a)),[a,i,n,e]);if(!r)return null;if(Object.entries(t).every((([e,t])=>t.isEmpty)))return null;const{title:l,icon:s,action:o}=r;return(0,z.BX)(y.Z,{sx:{mb:1},children:[(0,z.tZ)(ee.Z,{avatar:s&&(0,z.tZ)(ne.Z,{size:2,src:s}),title:l,action:o&&(0,z.tZ)(B.Z,{children:o})}),(0,z.tZ)(F.Z,{}),(0,z.tZ)(h.Z,{children:Object.entries(t).map((([e,t])=>!t.isEmpty&&(0,z.tZ)(ce,{node:t},e)))})]})}function ce({node:e}){const{node:t}=(0,f.useContext)(j.M),[n,a]=(0,f.useState)(!1),i=(0,f.useCallback)(((e,t)=>a(t)),[]),r=(0,f.useRef)();return(0,f.useEffect)((()=>{e===t&&setTimeout((()=>{var e;return null==r||null==(e=r.current)||null==e.scrollIntoView?void 0:e.scrollIntoView({behavior:"smooth"})}),300)}),[r,e,t]),(0,z.BX)(H.Z,{sx:{bgcolor:"contentDark.main"},expanded:e===t||n,onChange:i,ref:r,children:[(0,z.BX)(U.Z,{expandIcon:(0,z.tZ)(W.Z,{}),children:[(0,z.BX)(Y.Z,{children:[(0,z.tZ)(te.Z,{color:e.info.variant,children:e.info.name})," ",(0,z.tZ)("strong",{children:(0,re.p)(e)})]}),R.jU.includes(e.info.variant)&&(0,z.tZ)(d.Z,{sx:{display:"inline-block",ml:"auto",mr:2},children:(0,z.tZ)(Q.Z,{reaction:e.info.variant,trigger:e.info.subVariant})})]}),(0,z.tZ)(J.Z,{children:e.formulas.map(((e,t)=>(0,z.tZ)(Y.Z,{component:"div",children:e},t)))})]})}var de=n(33927),ue=n(41075),he=n(107),Ze=n(15873),pe=n(60467),me=n(32510),fe=n(5658),ge=n(27216),be=n(66198),ve=n(41033),xe=n(34958),ye=n(19807),we=n(43397),Ce=n(29063),ke=n(98283),Be=n(65992),Se=n(85801);const Xe=["expand"],je=(0,Be.ZP)((e=>{const t=(0,ke.Z)(e,Xe);return(0,z.tZ)(Se.Z,Object.assign({},t))}))((({theme:e,expand:t})=>({transform:t?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})})));var Pe=n(38553),Oe=n(89343),Ee=n(87051);const Ke=["name","children","value","placeholder","defaultValue","onValueChange","percent","disabled","onReset"],Me=(0,Be.ZP)(Pe.Z)({display:"flex"});function Ae(e){let{name:t,children:n,value:a,placeholder:i,defaultValue:r=0,onValueChange:l,percent:s=!1,disabled:o=!1,onReset:c}=e,d=(0,ke.Z)(e,Ke);return(0,z.BX)(Me,Object.assign({},d,{children:[n,(0,z.tZ)(Ee.Z,{sx:{px:1},children:t}),(0,z.tZ)(Oe.CC,{sx:{flexBasis:"10em",flexGrow:1},children:(0,z.tZ)(Oe.ZP,{sx:{px:1},inputProps:{sx:{textAlign:"right"}},float:s,placeholder:i,value:a,onChange:l,disabled:o,endAdornment:s?"%":void 0})}),(0,z.tZ)(m.Z,{sx:{flexShrink:2},size:"small",color:"error",onClick:()=>c?c():l(r),disabled:o||a===r,children:(0,z.tZ)(me.Z,{})})]}))}let De,Ie=e=>e;function Te(){const{t:e}=(0,g.$G)("ui"),{characterDispatch:t}=(0,f.useContext)(S.K),{data:n}=(0,f.useContext)(X.R),[a,i]=(0,f.useState)(!1),r=(0,f.useCallback)((()=>i(!a)),[i,a]),l=n.get(xe.ri.enemy.level),s=n.get(xe.ri.enemy.defRed),o=n.get(xe.ri.enemy.defIgn),c=(0,f.useCallback)((()=>t({enemyOverride:{}})),[t]);return(0,z.BX)(y.Z,{children:[(0,z.BX)(h.Z,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap"},children:[(0,z.tZ)(be.Z,{size:"small",color:"success",label:(0,z.BX)("span",{children:[l.info.name," ",(0,z.tZ)("strong",{children:l.value})]})}),pe.fR.map((e=>(0,z.tZ)(Y.Z,{children:(0,z.tZ)(Re,{element:e})},e))),(0,z.BX)(Y.Z,{children:["DEF Red. ",(0,re.p)(s)]}),(0,z.BX)(Y.Z,{children:["DEF Ignore ",(0,re.p)(o)]}),(0,z.BX)(d.Z,{flexGrow:1,display:"flex",justifyContent:"flex-end",gap:1,children:[(0,z.tZ)(m.Z,{size:"small",color:"error",onClick:c,startIcon:(0,z.tZ)(me.Z,{}),children:e(De||(De=Ie`reset`))}),(0,z.tZ)(je,{expand:a,onClick:r,"aria-expanded":a,"aria-label":"show more",size:"small",sx:{marginLeft:0},children:(0,z.tZ)(W.Z,{})})]})]}),(0,z.tZ)(ve.Z,{in:a,timeout:"auto",unmountOnExit:!0,children:(0,z.tZ)(h.Z,{sx:{pt:0},children:(0,z.tZ)(_e,{})})})]})}function Re({element:e}){const{data:t}=(0,f.useContext)(X.R),n=t.get(xe.ri.enemy[`${e}_res_`]),a=!isFinite(n.value),i=(0,z.tZ)(we.Z,{ele:e,iconProps:Ce.m}),r=a?(0,z.BX)("span",{children:[i," ∞"]}):(0,z.BX)("span",{children:[i," ",(0,z.tZ)("strong",{children:(0,re.p)(n)})]});return(0,z.tZ)(te.Z,{color:e,children:r})}function _e({bsProps:e={xs:12,md:6}}){var t,n,a;const{character:{enemyOverride:i},characterDispatch:r}=(0,f.useContext)(S.K),{data:l}=(0,f.useContext)(X.R),s=null!=(t=i.enemyLevel)?t:l.get(xe.ri.lvl).value,o=null!=(n=i.enemyDefIgn_)?n:0,c=null!=(a=i.enemyDefRed_)?a:0;return(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(m.Z,{fullWidth:!0,sx:{height:"100%"},size:"small",component:"a",color:"warning",href:"https://genshin-impact.fandom.com/wiki/Resistance#Base_Enemy_Resistances",target:"_blank",rel:"noreferrer",children:"To get the specific resistance values of enemies, please visit the wiki."})})),(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Ae,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)("b",{children:ye.ZP.get("enemyLevel")}),value:s,placeholder:ye.ZP.getStr("enemyLevel"),defaultValue:l.get(xe.ri.lvl).value,onValueChange:e=>r({type:"enemyOverride",statKey:"enemyLevel",value:e}),onReset:()=>r({type:"enemyOverride",statKey:"enemyLevel",value:void 0})})})),pe.fR.map((t=>{const n=`${t}_enemyRes_`,a=i[n],l=a===Number.MAX_VALUE;return(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Ae,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)(te.Z,{color:t,children:(0,z.tZ)("b",{children:ye.ZP.get(n)})}),value:void 0!==a?l?1/0:a:10,placeholder:l?"∞ ":ye.ZP.getStr(n),defaultValue:10,onValueChange:e=>r({type:"enemyOverride",statKey:n,value:e}),disabled:l,percent:!0,children:(0,z.tZ)(m.Z,{color:t,onClick:()=>r({type:"enemyOverride",statKey:n,value:l?10:Number.MAX_VALUE}),startIcon:l?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),children:"Immunity"})})}),t)})),(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Ae,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)("b",{children:ye.ZP.get("enemyDefIgn_")}),value:o,placeholder:ye.ZP.getStr("enemyDefIgn_"),defaultValue:0,onValueChange:e=>r({type:"enemyOverride",statKey:"enemyDefIgn_",value:e}),percent:!0})})),(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Ae,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)("b",{children:ye.ZP.get("enemyDefRed_")}),value:c,placeholder:ye.ZP.getStr("enemyDefRed_"),defaultValue:0,onValueChange:e=>r({type:"enemyOverride",statKey:"enemyDefRed_",value:e}),percent:!0})})),(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)("small",{children:"Note: Genshin Impact halves resistance shred values below 0%. For the sake of calculations enter the RAW value and GO will do the rest. (e.g. 10% - 20% = -10%)"})})]})}var Le=n(2720),Ge=n(86953);let $e,ze=e=>e;const Ne={xs:1,md:2,lg:3};function Ve({open:e,onClose:t}){const{t:n}=(0,g.$G)("page_character");return(0,z.tZ)(ae.Z,{open:e,onClose:t,children:(0,z.BX)(x.Z,{children:[(0,z.tZ)(q.Z,{title:n($e||($e=ze`addStats.title`)),action:(0,z.tZ)(w.Z,{onClick:t})}),(0,z.tZ)(h.Z,{sx:{pt:0},children:(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(Fe,{}),(0,z.tZ)(Te,{}),(0,z.tZ)(tt,{})]})})]})})}const We=[...xe.lR],qe=(e,t)=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:e},t);function Fe(){const{t:e}=(0,g.$G)("page_character"),{character:{bonusStats:t},characterDispatch:n}=(0,f.useContext)(S.K),a=(0,f.useCallback)((e=>n({bonusStats:e})),[n]);return(0,z.tZ)(y.Z,{children:(0,z.tZ)(h.Z,{sx:{display:"flex"},children:(0,z.BX)(ue.ZP,{container:!0,columns:Ne,sx:{pt:1},spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)(he.Z,{severity:"info",variant:"filled",children:(0,z.BX)(g.cC,{i18nKey:"addStats.info",t:e,children:["You can use these fields to add buffs/debuffs not directly supported in GO, such as food buffs, abyss cards, or Superconduct. Please refer to the ",(0,z.tZ)("a",{href:"https://genshin-impact.fandom.com/wiki/Genshin_Impact_Wiki",children:"Genshin Impact wiki"})," for specific values."]})})}),(0,z.tZ)(Ge.Z,{statKeys:We,statFilters:t,setStatFilters:a,wrapperFunc:qe})]})})})}const He=["eleMas","critRate_","critDMG_","enerRech_","heal_"],Ue=["hp","atk","def",...He].map((e=>xe.ri.total[e])),Ye=["atk_","atk","hp_","hp","def_","def",...He],Je=[...ye.hX,...ye.Sx,"stamina","incHeal_","shield_","cdRed_"],Qe=xe.lR.filter((e=>!Ye.includes(e)&&!Je.includes(e)));function et({nodes:e,extra:t}){const{data:n,oldData:a}=(0,f.useContext)(X.R);return(0,z.BX)(Le.lD,{children:[e.map((e=>{var t;return(0,z.tZ)(Le.JW,{component:Ze.ZP,node:n.get(e),oldValue:null==a||null==(t=a.get(e))?void 0:t.value},JSON.stringify(e.info))})),t]})}function tt(){const{characterSheet:e}=(0,f.useContext)(S.K),{data:t}=(0,f.useContext)(X.R),n=t.get(xe.ri.special),a=e.elementKey,i=e.isMelee(),r=(0,f.useMemo)((()=>Je.filter((e=>!e.includes(a)&&(i&&e.includes("physical"),!0))).map((e=>xe.ri.total[e])).filter((e=>!!t.get(e).value))),[t,a,i]),l=(0,f.useMemo)((()=>Qe.map((e=>xe.ri.total[e])).filter((e=>t.get(e).value))),[t]);return(0,z.tZ)(y.Z,{children:(0,z.tZ)(h.Z,{children:(0,z.BX)(ue.ZP,{container:!0,columns:Ne,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(nt,{title:"Main Stats",children:(0,z.tZ)(et,{nodes:Ue,extra:n&&(0,z.BX)(Ze.ZP,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,z.BX)("span",{children:[(0,z.tZ)("b",{children:"Special:"})," ",(0,z.BX)(te.Z,{color:n.info.variant,children:[n.info.icon," ",n.info.name]})]}),(0,z.tZ)("span",{children:(0,re.p)(n)})]})})})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(nt,{title:"Other Stats",children:(0,z.tZ)(et,{nodes:r})})}),!!l.length&&(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(nt,{title:"Misc Stats",children:(0,z.tZ)(et,{nodes:l})})})]})})})}function nt({title:e,children:t}){return(0,z.BX)(x.Z,{children:[(0,z.tZ)(h.Z,{sx:{py:1},children:(0,z.tZ)(d.Z,{display:"flex",justifyContent:"space-between",children:(0,z.tZ)(Y.Z,{variant:"subtitle1",children:e})})}),t]})}var at=n(36269),it=n(46342),rt=n(62469),lt=n(85162),st=n(23119),ot=n(94380),ct=n(92794),dt=n(32912),ut=n(7300),ht=n(76638),Zt=n(35711),pt=n(82334),mt=n(29432);const ft=(0,f.createContext)(void 0);var gt=n(65469),bt=n(30507),vt=n(30597),xt=n(36617),yt=n(82716),wt=n(79924);function Ct(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return Ct=function(e){this.s=e,this.n=e.next},Ct.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new Ct(e)}class kt{constructor(e,t,n){this.prio=void 0,this.commands=void 0,this.workers=void 0,this.workDone=new Map,this._workers=void 0,this.cancel=void 0,this.cancelled=void 0,this.callback=void 0,this.notifyNonEmpty=void 0,this.commands=t.map((e=>new Bt)),this.prio=new Map(t.map(((e,t)=>[e,t]))),this.callback=n,e.forEach((e=>{e.onmessage=t=>this.onMessage(t.data,e),e.onerror=e=>this.onError(e)})),this._workers=e,this.workers=e.map((e=>Promise.resolve(e))),this.cancel=()=>{},this.cancelled=new Promise(((e,t)=>this.cancel=t)),this.cancelled.catch((t=>e.forEach((e=>e.terminate()))))}async execute(e){var t=this;const n=async function(){var n,a=!1,i=!1;try{for(var r,l=function(e){var t,n,a,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,a=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(a&&null!=(t=e[a]))return new Ct(t.call(e));n="@@asyncIterator",a="@@iterator"}throw new TypeError("Object is not async iterable")}(e);a=!(r=await l.next()).done;a=!1){const e=r.value;t.add(e)}}catch(e){i=!0,n=e}finally{try{a&&null!=l.return&&await l.return()}finally{if(i)throw n}}}();for(;;){var a;const e=null==(a=this.commands.find((e=>e.length)))?void 0:a.dequeue();if(void 0===e){const e=await Promise.race([new Promise((e=>this.notifyNonEmpty=()=>e(!0))),Promise.all([...this.workers,n]).then((e=>!1)),this.cancelled]);if(this.notifyNonEmpty=void 0,e)continue;break}const{i:t,w:i}=await Promise.race([...this.workers.map(((e,t)=>e.then((e=>({i:t,w:e}))))),this.cancelled]);this.workers[t]=new Promise((e=>this.workDone.set(i,(()=>e(i))))),i.postMessage(e)}}onError(e){this.cancel(new Error(`Worker Error: ${e.message}`))}onMessage(e,t){void 0!==e.command?this.add(e):"done"===e.resultType?this.workDone.get(t)():this.callback(e,t)}add(e){var t;const n=this.prio.get(e.command);this.commands[n].enqueue(e),null==(t=this.notifyNonEmpty)||t.call(this)}broadcast(e){this._workers.forEach((t=>t.postMessage(e)))}notifiedBroadcast(e){this.workers=this.workers.map((e=>e.then((e=>new Promise((t=>{this.workDone.set(e,(()=>t(e)))})))))),this._workers.forEach((t=>t.postMessage(e)))}}class Bt{constructor(){this.head=[],this.tail=[]}get length(){return this.head.length+this.tail.length}enqueue(e){this.tail.push(e)}dequeue(){return!this.head.length&&this.tail.length&&([this.head,this.tail]=[this.tail.reverse(),this.head]),this.head.pop()}}class St extends kt{constructor(e,t,a){super(Array(a).fill(NaN).map((e=>new Worker(new URL(n.p+n.u(623),n.b)))),["iterate","split","count"],((e,t)=>{switch(e.resultType){case"interim":this.interim(e,t);break;case"finalize":this.finalizedResults.push(e);break;case"count":this.status.total=e.count;break;case"err":this.onError(e)}})),this.maxIterateSize=16e6,this.status=void 0,this.exclusion=void 0,this.topN=void 0,this.buildValues=void 0,this.finalizedResults=[];const{exclusion:i,topN:r}=e;this.status=t,this.exclusion=i,this.topN=r,this.status.total=NaN,this.buildValues=Array(r).fill({w:void 0,val:-1/0}),this.notifiedBroadcast(this.preprocess(e))}async solve(){const{exclusion:e,maxIterateSize:t}=this;return this.finalizedResults=[],await this.execute([{command:"count",exclusion:e,maxIterateSize:t}]),this.notifiedBroadcast({command:"finalize"}),await this.execute([]),this.finalizedResults}preprocess({plotBase:e,optimizationTarget:t,arts:n,topN:a,exclusion:i,constraints:r}){let l=[...(r=r.filter((e=>e.min>-1/0))).map((e=>e.value)),t];const s=[...r.map((e=>e.min)),-1/0];e&&(l.push(e),s.push(-1/0)),l=(0,wt.dk)(l,i),({nodes:l,arts:n}=(0,wt._B)(l,s,n,a,i,{reaffine:!0,pruneArtRange:!0,pruneNodeRange:!0,pruneOrder:!0})),l=(0,vt.tL)(l,{},(e=>!1)),e&&(e=l.pop());return{command:"setup",arts:n,optTarget:l.pop(),plotBase:e,topN:a,constraints:l.map(((e,t)=>({value:e,min:s[t]})))}}interim(e,t){if(this.status.tested+=e.tested,this.status.failed+=e.failed,this.status.skipped+=e.skipped,e.buildValues){var n,a;const{topN:i}=this,r=null!=(n=this.buildValues[i-1].val)?n:-1/0;this.buildValues.filter((({w:e})=>e!==t)),this.buildValues.push(...e.buildValues.map((e=>({w:t,val:e})))),this.buildValues.sort(((e,t)=>t.val-e.val)).splice(i);const l=null!=(a=this.buildValues[i-1].val)?a:-1/0;r!==l&&this.broadcast({command:"threshold",threshold:l})}}}var Xt=n(41015),jt=n(60791),Pt=n(38114),Ot=n(76077),Et=n(96511),Kt=n(78437),Mt=n(61420),At=n(73740);function Dt({setKey:e,setNumKey:t,hideHeader:n=!1,conditionalsOnly:a=!1}){var i;const r=(0,Mt.Sk)(e),l=a?null==(i=r.setEffectDocument(t))?void 0:i.filter((e=>"states"in e)):r.setEffectDocument(t);return(0,z.tZ)(d.Z,{display:"flex",flexDirection:"column",children:l?(0,z.tZ)(At.Z,{sections:l,hideHeader:n}):null})}var It=n(15378),Tt=n(21845),Rt=n(74637),_t=n(60184),Lt=n(97797);function Gt(e){const{database:t}=(0,f.useContext)(E.t),[n,a]=(0,f.useState)((()=>t.buildSettings.get(e)));(0,f.useEffect)((()=>a(t.buildSettings.get(e))),[t,e]),(0,f.useEffect)((()=>t.buildSettings.follow(e,((e,t,n)=>"update"===t&&a(n)))),[e,a,t]);return{buildSetting:n,buildSettingDispatch:(0,f.useCallback)((n=>e&&t.buildSettings.set(e,n)),[e,t])}}let $t,zt,Nt,Vt,Wt,qt,Ft,Ht,Ut,Yt,Jt,Qt,en,tn,nn,an,rn=e=>e;function ln({disabled:e}){var t,n;const{t:a}=(0,g.$G)(["page_character_optimize","sheet"]),i=(0,f.useContext)(X.R),{database:r}=(0,f.useContext)(E.t),{character:{key:l,conditional:s},characterDispatch:o}=(0,f.useContext)(S.K),{buildSetting:{artSetExclusion:c},buildSettingDispatch:u}=Gt(l),[Z,p]=(0,f.useState)(!1),b=(0,f.useCallback)((()=>p(!0)),[p]),v=(0,f.useCallback)((()=>p(!1)),[p]),[C,k]=(0,xt.Z)();(0,f.useEffect)((()=>r.arts.followAny(k)),[r,k]);const j=(0,f.useMemo)((()=>Object.entries(Mt.WO).reverse().flatMap((([,e])=>e)).filter((e=>!e.includes("Prayers")))),[]),{artKeys:P,artSlotCount:O}=(0,f.useMemo)((()=>{const e=(0,Xt.O)(j,(e=>(0,Xt.O)(pe.Ex,(e=>0))));r.arts.values.forEach((t=>e[t.setKey]&&e[t.setKey][t.slotKey]++));const t=[...j].sort(((t,n)=>+(cn(e[t])<2)-+(cn(e[n])<2)));return C&&{artKeys:t,artSlotCount:e}}),[C,r,j]),K=!(null!=(t=c.rainbow)&&t.includes(2)),M=!(null!=(n=c.rainbow)&&n.includes(4)),{allow2:A,allow4:D}=(0,f.useMemo)((()=>({allow2:j.filter((e=>{var t;return!(null!=(t=c[e])&&t.includes(2))})).length,allow4:j.filter((e=>{var t;return!(null!=(t=c[e])&&t.includes(4))})).length})),[j,c]),I=j.length-A,T=j.length-D,R=(0,f.useMemo)((()=>Object.keys(s).filter((e=>{var t;return pe.Gt.includes(e)&&!!Object.keys(null!=(t=s[e])?t:{}).length})).length),[s]),_=(0,f.useMemo)((()=>Object.assign({},i,{data:new re.w(Object.assign({},i.data.data[0],{artSet:(0,Xt.O)(pe.Gt,(e=>(0,Lt.a9)(4)))}),void 0)})),[i]),L=(0,f.useCallback)((()=>{const e=Object.fromEntries(Object.entries(s).filter((([e,t])=>!pe.Gt.includes(e))));o({conditional:e})}),[s,o]),G=(0,f.useCallback)(((e,t=!0)=>{const n=(0,Xt.I8)(c);j.forEach((a=>{var i;t?n[a]=[...null!=(i=n[a])?i:[],e]:n[a]&&(n[a]=n[a].filter((t=>t!==e)))})),u({artSetExclusion:n})}),[j,c,u]);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(m.Z,{onClick:b,disabled:e,color:"info",startIcon:(0,z.tZ)(Ot.Z,{}),children:(0,z.BX)(d.Z,{sx:{textAlign:"left",flexGrow:1},children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:a($t||($t=rn`artSetConfig.title`))})}),(0,z.BX)(de.Z,{spacing:.5,children:[(0,z.BX)(Y.Z,{children:[a(zt||(zt=rn`artSetConfig.setEffCond`))," ",(0,z.BX)(B.Z,{color:R?"success":"warning",children:[R," ",a("artSetConfig.enabled")]})]}),(0,z.BX)(Y.Z,{children:[a(Nt||(Nt=rn`sheet:2set`))," ",(0,z.BX)(B.Z,{color:"success",children:[A," ",(0,z.tZ)(Et.Z,Object.assign({},Ce.m))," ",a("artSetConfig.allowed")]}),!!I&&" / ",!!I&&(0,z.BX)(B.Z,{color:"secondary",children:[I," ",(0,z.tZ)(Pt.Z,Object.assign({},Ce.m))," ",a("artSetConfig.excluded")]})]}),(0,z.BX)(Y.Z,{children:[a(Vt||(Vt=rn`sheet:4set`))," ",(0,z.BX)(B.Z,{color:"success",children:[D," ",(0,z.tZ)(Et.Z,Object.assign({},Ce.m))," ",a("artSetConfig.allowed")]}),!!T&&" / ",!!T&&(0,z.BX)(B.Z,{color:"secondary",children:[T," ",(0,z.tZ)(Pt.Z,Object.assign({},Ce.m))," ",a("artSetConfig.excluded")]})]}),(0,z.BX)(Y.Z,{children:[a(Wt||(Wt=rn`artSetConfig.2rainbow`))," ",(0,z.BX)(B.Z,{color:K?"success":"secondary",children:[K?(0,z.tZ)(Et.Z,Object.assign({},Ce.m)):(0,z.tZ)(Pt.Z,Object.assign({},Ce.m))," ",K?a("artSetConfig.allowed"):"Excluded"]})]}),(0,z.BX)(Y.Z,{children:[a(qt||(qt=rn`artSetConfig.4rainbow`))," ",(0,z.BX)(B.Z,{color:M?"success":"secondary",children:[M?(0,z.tZ)(Et.Z,Object.assign({},Ce.m)):(0,z.tZ)(Pt.Z,Object.assign({},Ce.m))," ",M?a("artSetConfig.allowed"):"Excluded"]})]})]})]})}),(0,z.tZ)(ae.Z,{open:Z,onClose:v,children:(0,z.BX)(x.Z,{children:[(0,z.BX)(h.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:a(Ft||(Ft=rn`artSetConfig.title`))}),(0,z.tZ)(w.Z,{onClick:v})]}),(0,z.tZ)(F.Z,{}),(0,z.BX)(h.Z,{children:[(0,z.tZ)(y.Z,{sx:{mb:1},children:(0,z.BX)(h.Z,{children:[(0,z.BX)(d.Z,{display:"flex",gap:1,children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:a(Ht||(Ht=rn`artSetConfig.modal.setCond.title`))})}),(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:(0,z.BX)(B.Z,{color:R?"success":"warning",children:[R," ",a("artSetConfig.selected")]})}),(0,z.tZ)(m.Z,{size:"small",onClick:L,color:"error",startIcon:(0,z.tZ)(me.Z,{}),children:a(Ut||(Ut=rn`artSetConfig.modal.setCond.reset`))})]}),(0,z.tZ)(Y.Z,{children:a(Yt||(Yt=rn`artSetConfig.modal.setCond.text`))})]})}),(0,z.tZ)(y.Z,{sx:{mb:1},children:(0,z.BX)(h.Z,{children:[(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:(0,z.tZ)("strong",{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.modal.ArtSetFilter.title",children:["Artifact Sets ",(0,z.BX)(te.Z,{color:"success",children:["Allowed",(0,z.tZ)(Et.Z,Object.assign({},Ce.m))]})," / ",(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluded",(0,z.tZ)(Pt.Z,Object.assign({},Ce.m))]})]})})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.modal.ArtSetFilter.intro",children:["You can allow/exclude which sets you want the builder to consider. In the following examples, ",(0,z.tZ)("strong",{children:"A"})," is on-set, and ",(0,z.tZ)("strong",{children:"R"})," is rainbow(off-set)"]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.modal.ArtSetFilter.2set",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(Pt.Z,Object.assign({},Ce.m))," 2-Set"]})})," would exclude 2-Set builds: ",(0,z.BX)("strong",{children:[(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AA"}),"RRR"]})," and ",(0,z.BX)("strong",{children:[(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AAA"}),"RR"]}),"."]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.modal.ArtSetFilter.4set",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(Pt.Z,Object.assign({},Ce.m))," 4-Set"]})})," would exclude 4-Set builds: ",(0,z.BX)("strong",{children:[(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AAAA"}),"R"]})," and ",(0,z.tZ)("strong",{children:(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AAAAA"})}),"."]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.modal.ArtSetFilter.2rain",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(Pt.Z,Object.assign({},Ce.m))," 3-Rainbow"]})})," would exclude 2-Set + 3-Rainbow builds: ",(0,z.BX)("strong",{children:["AA",(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"RRR"})]})," and ",(0,z.BX)("strong",{children:["AAA",(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"RR"})]}),"."]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.modal.ArtSetFilter.4rain",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(Pt.Z,Object.assign({},Ce.m))," 5-Rainbow"]})})," would exclude full 5-Rainbow builds: ",(0,z.tZ)("strong",{children:(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"RRRRR"})}),"."]})})]})}),(0,z.BX)(ue.ZP,{container:!0,columns:{xs:2,lg:3},sx:{mb:1},spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(sn,{setNum:2,numAllow:A,numExclude:I,setAllExclusion:G})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(sn,{setNum:4,numAllow:D,numExclude:T,setAllExclusion:G})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(y.Z,{children:(0,z.BX)(h.Z,{children:[(0,z.tZ)(Y.Z,{gutterBottom:!0,children:(0,z.tZ)("strong",{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.alExRainbow",children:[(0,z.BX)(te.Z,{color:"success",children:["Allow ",(0,z.tZ)(Et.Z,Object.assign({},Ce.m))]})," / ",(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Exclude ",(0,z.tZ)(Pt.Z,Object.assign({},Ce.m))]})," Rainbow Builds"]})})}),(0,z.BX)(d.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(m.Z,{fullWidth:!0,onClick:()=>u({artSetExclusion:(0,_t.s)(c,"rainbow",2)}),color:K?"success":"secondary",startIcon:K?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),endIcon:K?(0,z.tZ)(Et.Z,{}):(0,z.tZ)(Pt.Z,{}),children:a(Jt||(Jt=rn`artSetConfig.2rainbow`))}),(0,z.tZ)(m.Z,{fullWidth:!0,onClick:()=>u({artSetExclusion:(0,_t.s)(c,"rainbow",4)}),color:M?"success":"secondary",startIcon:M?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),endIcon:M?(0,z.tZ)(Et.Z,{}):(0,z.tZ)(Pt.Z,{}),children:a(Qt||(Qt=rn`artSetConfig.4rainbow`))})]})]})})})]}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,lg:3},children:P.map((e=>(0,z.tZ)(on,{setKey:e,fakeDataContextObj:_,slotCount:O[e]},e)))})]}),(0,z.tZ)(F.Z,{}),(0,z.tZ)(h.Z,{sx:{py:1},children:(0,z.tZ)(w.Z,{large:!0,onClick:v})})]})})]})}function sn({numAllow:e,numExclude:t,setNum:n,setAllExclusion:a}){const{t:i}=(0,g.$G)(["page_character_optimize","sheet"]);return(0,z.tZ)(y.Z,{children:(0,z.BX)(h.Z,{children:[(0,z.BX)(Y.Z,{gutterBottom:!0,children:[(0,z.tZ)("strong",{children:i(`sheet:${n}set`)})," ",(0,z.BX)(B.Z,{color:"success",children:[e," ",(0,z.tZ)(Et.Z,Object.assign({},Ce.m))," ",i("artSetConfig.allowed")]}),!!t&&" / ",!!t&&(0,z.BX)(B.Z,{color:"secondary",children:[t," ",(0,z.tZ)(Pt.Z,Object.assign({},Ce.m))," ",i("artSetConfig.excluded")]})]}),(0,z.BX)(d.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(m.Z,{fullWidth:!0,disabled:!t,onClick:()=>a(n,!1),color:"success",startIcon:(0,z.tZ)(Et.Z,{}),children:i(`artSetConfig.allowAll${n}set`)}),(0,z.tZ)(m.Z,{fullWidth:!0,disabled:!e,onClick:()=>a(n,!0),color:"secondary",startIcon:(0,z.tZ)(Pt.Z,{}),children:i(`artSetConfig.excludeAll${n}set`)})]})]})})}function on({setKey:e,fakeDataContextObj:t,slotCount:n}){var a,i;const{t:r}=(0,g.$G)("sheet"),{character:{key:l}}=(0,f.useContext)(S.K),{buildSetting:s,buildSettingDispatch:o}=Gt(l),{artSetExclusion:c}=s,u=null!=(a=null==c?void 0:c[e])?a:[],Z=!u.includes(4),p=cn(n),b=(0,Mt.Sk)(e),v=(0,f.useMemo)((()=>Z?Object.keys(b.setEffects).filter((e=>{var t;return null==(t=b.setEffects[e])?void 0:t.document.some((e=>"states"in e))})):[]),[b.setEffects,Z]),x=u.includes(2),w=u.includes(4);return(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.BX)(y.Z,{sx:{height:"100%",opacity:p<2?"50%":void 0},children:[(0,z.BX)(d.Z,{className:`grad-${b.rarity[0]}star`,width:"100%",sx:{display:"flex"},children:[(0,z.tZ)(d.Z,{component:"img",src:(0,Rt.jU)(e),sx:{height:100,width:"auto",mx:-1}}),(0,z.BX)(d.Z,{sx:{flexGrow:1,px:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:null!=(i=b.name)?i:""}),(0,z.tZ)(d.Z,{children:(0,z.BX)(Y.Z,{variant:"subtitle1",children:[b.rarity.map(((e,t)=>(0,z.BX)(d.Z,{component:"span",sx:{display:"inline-flex",alignItems:"center"},children:[e," ",(0,z.tZ)(Kt.Z,{fontSize:"inherit"})," ",t<b.rarity.length-1?"/ ":null]},e)))," ",(0,z.tZ)(pt.L,{title:(0,z.BX)(d.Z,{children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)(B.Z,{color:"success",children:r(en||(en=rn`2set`))})}),(0,z.tZ)(Y.Z,{children:(0,z.tZ)(Tt.v,{ns:`artifact_${e}_gen`,key18:"setEffects.2"})}),(0,z.BX)(d.Z,{paddingTop:2,sx:{opacity:u.includes(4)?.6:1},children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)(B.Z,{color:"success",children:r(tn||(tn=rn`4set`))})}),(0,z.tZ)(Y.Z,{children:(0,z.tZ)(Tt.v,{ns:`artifact_${e}_gen`,key18:"setEffects.4"})})]})]})})]})}),(0,z.tZ)(d.Z,{sx:{display:"flex",gap:1},children:Object.entries(n).map((([e,t])=>(0,z.tZ)(Y.Z,{sx:{flexGrow:1},variant:"subtitle2",children:(0,z.BX)(B.Z,{sx:{width:"100%"},color:t?"primary":"secondary",children:[(0,z.tZ)(It.Z,{slotKey:e,iconProps:Ce.m})," ",t]})},e)))})]})]}),(0,z.BX)(Pe.Z,{sx:{".MuiButton-root":{borderRadius:0}},fullWidth:!0,children:[(0,z.tZ)(m.Z,{startIcon:x?(0,z.tZ)(ge.Z,{}):(0,z.tZ)(fe.Z,{}),onClick:()=>o({artSetExclusion:(0,_t.s)(c,e,2)}),color:x?"secondary":"success",endIcon:x?(0,z.tZ)(Pt.Z,{}):(0,z.tZ)(Et.Z,{}),children:r(nn||(nn=rn`2set`))}),(0,z.tZ)(m.Z,{startIcon:w?(0,z.tZ)(ge.Z,{}):(0,z.tZ)(fe.Z,{}),onClick:()=>o({artSetExclusion:(0,_t.s)(c,e,4)}),color:w?"secondary":"success",endIcon:w?(0,z.tZ)(Pt.Z,{}):(0,z.tZ)(Et.Z,{}),children:r(an||(an=rn`4set`))})]}),!!v.length&&(0,z.tZ)(X.R.Provider,{value:t,children:(0,z.tZ)(h.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:v.map((t=>(0,z.tZ)(Dt,{setKey:e,setNumKey:parseInt(t),hideHeader:!0,conditionalsOnly:!0},t)))})})]})},e)}function cn(e){return Object.values(e).reduce(((e,t)=>e+(t?1:0)),0)}const dn=[0,4,8,12,16,20];function un({mainStatAssumptionLevel:e=0,setmainStatAssumptionLevel:t,disabled:n}){const{t:a}=(0,g.$G)("page_character_optimize");return(0,z.tZ)(Zt.Z,{fullWidth:!0,color:e?"success":"primary",disabled:n,title:e?a("mainStat.assumptionLvl.lvl",{lvl:e}):a("mainStat.assumptionLvl.no"),children:dn.map((e=>(0,z.tZ)(ot.Z,{onClick:()=>t(e),children:e?a("mainStat.assumptionLvl.lvl",{lvl:e}):a("mainStat.assumptionLvl.no")},e)))})}function hn(){const{character:{bonusStats:e}}=(0,f.useContext)(S.K),{data:t}=(0,f.useContext)(X.R),n=Object.keys(e);if(!n.length)return null;const a=n.map((e=>t.get(xe.ri.customBonus[e])));return(0,z.BX)(y.Z,{children:[(0,z.tZ)(h.Z,{children:(0,z.tZ)(Y.Z,{children:"Bonus Stats"})}),(0,z.tZ)(F.Z,{}),(0,z.tZ)(h.Z,{children:a.map((e=>(0,z.tZ)(Le.JW,{node:e},JSON.stringify(e.info))))})]})}var Zn=n(38162),pn=n(53777);const mn=(0,Be.ZP)("strong")({fontFamily:"monospace"}),fn=(0,Be.ZP)(Zn.Z)((({theme:e})=>({height:10,borderRadius:5})));function gn({status:{type:e,tested:t,failed:n,skipped:a,total:i,startTime:r,finishTime:l},characterName:s}){const o=isFinite(i),c="inactive"!==e,d=i-a,u=(0,z.tZ)(mn,{children:t.toLocaleString()}),h=(0,z.tZ)(mn,{children:d.toLocaleString()}),Z=!!a&&(0,z.BX)("span",{children:["(",(0,z.tZ)("b",{children:(0,z.tZ)(mn,{children:a.toLocaleString()})})," skipped)"]}),p=(0,z.tZ)(mn,{children:(0,pn.e6)(Math.round((null!=l?l:performance.now())-(null!=r?r:NaN)))});let m,f="",g="";if(c)m=100*t/d,f=(0,z.BX)(Y.Z,{children:["Generating and testing ",u,o?(0,z.BX)(z.HY,{children:["/",h]}):void 0," build configurations against the criteria for ",(0,z.tZ)("b",{children:s}),". ",Z]}),g=(0,z.BX)(Y.Z,{children:["Time elapsed: ",p]});else{if(!(t+a))return null;m=100,f=(0,z.BX)(Y.Z,{children:["Generated and tested ",u," Build configurations against the criteria for ",(0,z.tZ)("b",{children:s}),". ",Z]}),g=(0,z.BX)(Y.Z,{children:["Total duration: ",p]})}return(0,z.BX)(he.Z,{severity:"success",variant:"filled",sx:{"& .MuiAlert-message":{flexGrow:1}},children:[f,g,void 0!==m&&(0,z.BX)(ue.ZP,{container:!0,spacing:1,alignItems:"center",children:[o&&(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(Y.Z,{children:`${m.toFixed(1)}%`})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(fn,{variant:o?"determinate":"indeterminate",value:m,color:"primary"})})]})]})}var bn=n(74064),vn=n(73673),xn=n(99074),yn=n(22499),wn=n(66615),Cn=n(75213),kn=n(47746),Bn=n(47591),Sn=n(79536),Xn=n(54878),jn=n(53163),Pn=n(20353);function On({characterKey:e}){const{gender:t}=(0,D.Z)(),n=(0,O.m)(e,t);return n?(0,z.tZ)(ut.Z,{placement:"right-end",title:(0,z.tZ)(Y.Z,{children:n.name}),children:(0,z.tZ)(Pn.Z,{src:(0,L.Li)(e,"iconSide",t),size:3,sideMargin:!0})}):null}var En=n(57889);function Kn({statKey:e,disableIcon:t=!1}){return(0,z.BX)(d.Z,{component:"span",display:"flex",alignItems:"center",gap:1,children:[!t&&(0,z.tZ)(we.C,{statKey:e,iconProps:Ce.m}),(0,z.BX)("span",{children:[ye.ZP.get(e),ye.ZP.unit(e)]})]})}function Mn({statKey:e,disableIcon:t=!1}){return(0,z.tZ)(te.Z,{color:ye.ZP.getVariant(e),children:(0,z.tZ)(Kn,{statKey:e,disableIcon:t})})}var An=n(61087);function Dn({artifactId:e,slotKey:t,mainStatAssumptionLevel:n=0,showLocation:a=!1,onClick:i,BGComponent:r=x.Z}){var l;const s=(0,jn.Z)(e),{database:o}=(0,f.useContext)(E.t),c=(0,f.useCallback)((e=>(0,z.tZ)(Cn.Z,{onClick:i,sx:{height:"100%"},children:e})),[i]),u=(0,kn.Z)();if(!s)return(0,z.tZ)(r,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center"},children:(0,z.tZ)(d.Z,{component:"img",src:Sn.Z.slot[t],sx:{width:"25%",height:"auto",opacity:.7}})});const{slotKey:h,rarity:Z,level:p,mainStatKey:m,substats:g,location:b}=s,v=Math.max(Math.min(n,4*Z),p),y=ye.ZP.unit(m),w=pe.fR.find((e=>s.mainStatKey.includes(e))),C=w?(0,Bn.Fq)(u.palette[w].main,.6):(0,Bn.Fq)(u.palette.secondary.main,.6);return(0,z.tZ)(r,{sx:{height:"100%"},children:(0,z.tZ)(En.Z,{condition:!!i,wrapper:c,children:(0,z.BX)(d.Z,{display:"flex",height:"100%",children:[(0,z.BX)(d.Z,{className:`grad-${Z}star`,sx:{position:"relative",flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,z.tZ)(An.Z,{art:s,children:(0,z.tZ)(d.Z,{component:"img",src:(0,L.Hp)(s.setKey,h),sx:{m:-1,maxHeight:"110%",maxWidth:"110%"}})}),(0,z.BX)(d.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[(0,z.tZ)(be.Z,{size:"small",label:(0,z.tZ)("strong",{children:` +${p}`}),color:Xn.ZP.levelVariant(p)}),a&&(0,z.tZ)(be.Z,{size:"small",label:b?(0,z.tZ)(On,{characterKey:b&&o.chars.LocationToCharacterKey(b)}):(0,z.tZ)(wn.Z,{}),color:"secondary",sx:{overflow:"visible",".MuiChip-label":{overflow:"visible"}}})]}),(0,z.tZ)(be.Z,{size:"small",sx:{position:"absolute",bottom:0,mb:1,backgroundColor:C,p:1},icon:(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:(0,z.tZ)(Mn,{statKey:m})}),disableInteractive:!0,children:(0,z.tZ)(d.Z,{lineHeight:0,children:(0,z.tZ)(we.C,{statKey:m,iconProps:{style:{padding:"4px"}}})})}),label:(0,z.tZ)(Y.Z,{sx:{mx:-.7},children:(0,z.BX)(te.Z,{color:v!==p?"warning":void 0,children:[(0,ye.qs)(null!=(l=Xn.ZP.mainStatValue(m,Z,v))?l:0,ye.ZP.unit(m)),y]})})})]}),(0,z.tZ)(d.Z,{display:"flex",flexDirection:"column",justifyContent:"space-between",sx:{p:1},children:g.map(((e,t)=>(0,z.tZ)(In,{stat:e},t+e.key)))})]})})})}function In({stat:e}){var t,n;if(!e.value)return null;const a=null!=(t=null==(n=e.rolls)?void 0:n.length)?t:0,i=`roll${(0,Xt.uZ)(a,1,6)}`,r=ye.ZP.unit(e.key);return(0,z.tZ)(d.Z,{display:"flex",gap:1,alignContent:"center",children:(0,z.BX)(Y.Z,{sx:{flexGrow:1,display:"flex",gap:.5,alignItems:"center"},color:a?`${i}.main`:"error.main",component:"span",children:[(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:e.key&&(0,z.tZ)(Mn,{statKey:e.key})}),disableInteractive:!0,children:(0,z.tZ)(d.Z,{lineHeight:0,children:(0,z.tZ)(we.C,{statKey:e.key,iconProps:{fontSize:"inherit"}})})}),(0,z.tZ)("span",{children:`${(0,ye.qs)(e.value,ye.ZP.unit(e.key))}${r}`})]})})}var Tn=n(42906);function Rn(){const{data:e}=(0,f.useContext)(X.R),t=(0,f.useMemo)((()=>(0,ie.U)(e).filter((([,e])=>Object.values(e).some((e=>!e.isEmpty))))),[e]);return(0,z.tZ)(d.Z,{sx:{mr:-1,mb:-1},children:(0,z.tZ)(Tn.ZP,{columns:{xs:1,sm:2,md:3,xl:4},spacing:1,children:t.map((([e,t])=>(0,z.tZ)(_n,{displayNs:t,sectionKey:e},e)))})})}function _n({displayNs:e,sectionKey:t}){const n=(0,f.useContext)(ft),{data:a,oldData:i}=(0,f.useContext)(X.R),{database:r}=(0,f.useContext)(E.t),l=(0,f.useMemo)((()=>(0,ie.f)(a,t,r)),[r,a,t]),s=(0,f.useMemo)((()=>(0,Xt.xh)(e,((e,n)=>(0,Lt.UF)(["display",t,n])))),[e,t]);if(!l)return(0,z.tZ)(x.Z,{});const{title:o,icon:c,action:d}=l;return(0,z.BX)(x.Z,{children:[(0,z.tZ)(ee.Z,{avatar:c&&(0,z.tZ)(ne.Z,{size:2,src:c}),title:o,action:d&&(0,z.tZ)(B.Z,{children:d})}),(0,z.tZ)(F.Z,{}),(0,z.tZ)(Le.lD,{sx:{m:0},children:Object.entries(e).map((([e,a])=>(0,z.tZ)(Le.JW,{node:a,oldValue:i?i.get(s[e]).value:void 0,component:Ze.ZP,emphasize:JSON.stringify(n)===JSON.stringify([t,e])},e)))})]})}var Ln=n(74001),Gn=n(71026),$n=n(94758),zn=n(2031);function Nn({weaponId:e,showLocation:t=!1,onClick:n,BGComponent:a=x.Z}){const{database:i}=(0,f.useContext)(E.t),r=(0,$n.Z)(e),l=(null==r?void 0:r.key)&&(0,Ln.ub)(r.key),s=(0,f.useCallback)((e=>(0,z.tZ)(Cn.Z,{sx:{height:"100%"},onClick:n,children:e})),[n]),o=(0,f.useMemo)((()=>l&&r&&(0,bt.mP)([l.data,(0,bt.v0)(r)])),[l,r]);if(!r||!l||!o)return(0,z.tZ)(a,{sx:{height:"100%"},children:(0,z.tZ)(u.Z,{variant:"rectangular",sx:{width:"100%",height:"100%"}})});const{refinement:c,location:h}=r;return(0,z.tZ)(a,{sx:{height:"100%"},children:(0,z.tZ)(En.Z,{condition:!!n,wrapper:s,children:(0,z.BX)(d.Z,{display:"flex",height:"100%",alignItems:"stretch",children:[(0,z.BX)(d.Z,{className:`grad-${l.rarity}star`,sx:{height:"100%",position:"relative",flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end"},children:[(0,z.tZ)(zn.Z,{sheet:l,children:(0,z.tZ)(d.Z,{component:"img",src:(0,L.Aq)(r.key,r.ascension>=2),sx:{mx:-1,maxHeight:"100%",maxWidth:"100%"}})}),(0,z.BX)(d.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[(0,z.tZ)(be.Z,{size:"small",label:(0,z.tZ)("strong",{children:Gn.Z.getLevelString(r)}),color:"primary"}),t&&(0,z.tZ)(be.Z,{size:"small",label:h?(0,z.tZ)(On,{characterKey:i.chars.LocationToCharacterKey(h)}):(0,z.tZ)(wn.Z,{}),color:"secondary",sx:{overflow:"visible",".MuiChip-label":{overflow:"visible"}}})]}),(0,z.tZ)(d.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"flex-end",alignItems:"flex-end"},children:l.hasRefinement&&(0,z.tZ)(be.Z,{size:"small",color:"info",label:(0,z.BX)("strong",{children:["R",c]})})})]}),(0,z.BX)(d.Z,{display:"flex",flexDirection:"column",sx:{p:1},children:[(0,z.tZ)(Vn,{node:o.get(xe.qH.weapon.main)}),(0,z.tZ)(Vn,{node:o.get(xe.qH.weapon.sub)})]})]})})})}function Vn({node:e}){return e.info.name?(0,z.tZ)(d.Z,{display:"flex",gap:1,alignContent:"center",children:(0,z.BX)(Y.Z,{sx:{flexGrow:1,display:"flex",gap:1},component:"span",children:[(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:e.info.name}),disableInteractive:!0,children:(0,z.tZ)("span",{children:e.info.icon})}),(0,z.tZ)("span",{children:(0,re.p)(e)})]})}):null}var Wn=n(85563),qn=n(85213);function Fn({artifacts:e,currentlyEquipped:t=!1}){const n=(0,f.useMemo)((()=>e.filter((e=>e)).reduce(((e,t)=>(e[t.setKey]?e[t.setKey].push(t.slotKey):e[t.setKey]=[t.slotKey],e)),{})),[e]);return(0,z.tZ)(z.HY,{children:Object.entries(n).sort((([e,t],[n,a])=>a.length-t.length)).map((([e,n])=>(0,z.tZ)(Hn,{setKey:e,currentlyEquipped:t,slotarr:n},e)))})}function Hn({setKey:e,currentlyEquipped:t=!1,slotarr:n}){var a;const i=(0,Mt.Sk)(e),r=n.length,l=Object.keys(i.setEffects).map((e=>parseInt(e))).filter((e=>e<=r));return(0,z.tZ)(d.Z,{children:(0,z.tZ)(qn.Z,{artifactSheet:i,numInSet:r,children:(0,z.tZ)(B.Z,{sx:{height:"100%"},color:t?"success":"primary",children:(0,z.BX)(Y.Z,{children:[n.map((e=>(0,z.tZ)(It.Z,{slotKey:e,iconProps:Ce.m},e)))," ",null!=(a=i.name)?a:"",l.map(((e,t)=>(0,z.tZ)(B.Z,{sx:{ml:.5},color:"success",children:e},""+e+t)))]})})})})}let Un,Yn,Jn=e=>e;function Qn({label:e,compareBuild:t,extraButtonsRight:n,extraButtonsLeft:a,disabled:i}){const{character:{key:r,equippedArtifacts:l}}=(0,f.useContext)(S.K),{buildSetting:{mainStatAssumptionLevel:s}}=Gt(r),{database:o}=(0,f.useContext)(E.t),c=(0,f.useContext)(X.R),{data:Z,oldData:p}=c,[g,b]=(0,f.useState)(void 0),v=(0,f.useCallback)((()=>b(void 0)),[b]),x=(0,f.useCallback)((()=>{if(!window.confirm("Do you want to equip this build to this character?"))return;const e=o.chars.get(r);if(!e)return;pe.Ex.forEach((t=>{const n=Z.get(xe.ri.art[t].id).value;if(n)o.arts.set(n,{location:(0,pe.V7)(r)});else{const n=e.equippedArtifacts[t];n&&o.arts.get(n)&&o.arts.set(n,{location:""})}}));const t=Z.get(xe.ri.weapon.id).value;t&&o.weapons.set(t,{location:(0,pe.V7)(r)})}),[r,Z,o]),w=(0,f.useMemo)((()=>{const e=Object.assign({},c);return t||(e.oldData=void 0),e}),[c,t]),C=(0,f.useMemo)((()=>Object.fromEntries(pe.Ex.map((e=>[e,Z.get(xe.ri.art[e].id).value])))),[Z]),k=(0,f.useMemo)((()=>C&&Object.values(C).map((e=>o.arts.get(e))).filter((e=>e))),[C,o.arts]),j=(0,f.useMemo)((()=>pe.Ex.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Dn,{showLocation:!0,slotKey:e,artifactId:C[e],mainStatAssumptionLevel:s,onClick:()=>{const t=l[e],n=C[e];b({oldId:t!==n?t:void 0,newId:n})}})},e)))),[b,l,s,C]);if(!p)return null;const P=pe.Ex.every((e=>C[e]===p.get(xe.ri.art[e].id).value))&&Z.get(xe.ri.weapon.id).value===p.get(xe.ri.weapon.id).value;return(0,z.tZ)(y.Z,{children:(0,z.BX)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:600}),children:[g&&(0,z.tZ)(ea,{newOld:g,mainStatAssumptionLevel:s,onClose:v}),(0,z.BX)(h.Z,{children:[(0,z.BX)(d.Z,{display:"flex",gap:1,sx:{pb:1},flexWrap:"wrap",children:[void 0!==e&&(0,z.tZ)(B.Z,{color:"info",children:(0,z.tZ)(Y.Z,{children:(0,z.BX)("strong",{children:[e,P?" (Equipped)":""]})})}),(0,z.tZ)(Fn,{artifacts:k,currentlyEquipped:P}),(0,z.tZ)(d.Z,{sx:{flexGrow:1,display:"flex",justifyContent:"flex-end"}}),a,(0,z.tZ)(m.Z,{size:"small",color:"success",onClick:x,disabled:i||P,startIcon:(0,z.tZ)(bn.Z,{}),children:"Equip Build"}),n]}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,sx:{pb:1},columns:{xs:2,sm:3,md:4,lg:6},children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Nn,{showLocation:!0,weaponId:Z.get(xe.ri.weapon.id).value})}),j]}),(0,z.tZ)(X.R.Provider,{value:w,children:(0,z.tZ)(Rn,{})})]})]})})}function ea({newOld:{newId:e,oldId:t},mainStatAssumptionLevel:n,onClose:a}){var i,r;const{database:l}=(0,f.useContext)(E.t),{character:{key:s}}=(0,f.useContext)(S.K),o=(0,f.useCallback)((()=>{window.confirm("Do you want to equip this artifact to this character?")&&(l.arts.set(e,{location:(0,pe.V7)(s)}),a())}),[e,l,s,a]),c=null!=(i=null==(r=l.arts.get(e))?void 0:r.location)?i:"";return(0,z.tZ)(ae.Z,{open:!!e,onClose:a,containerProps:{maxWidth:t?"md":"xs"},children:(0,z.tZ)(x.Z,{children:(0,z.BX)(h.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"stretch",gap:2},children:[t&&(0,z.tZ)(d.Z,{minWidth:320,children:(0,z.tZ)(Wn.Z,{artifactId:t,mainStatAssumptionLevel:n,canEquip:!0,editorProps:{disableSet:!0,disableSlot:!0},extraButtons:(0,z.tZ)(ta,{id:t})})}),t&&(0,z.tZ)(d.Z,{display:"flex",flexGrow:1}),t&&(0,z.tZ)(d.Z,{display:"flex",alignItems:"center",justifyContent:"center",children:(0,z.tZ)(m.Z,{onClick:o,sx:{display:"flex"},children:(0,z.tZ)(vn.Z,{sx:{fontSize:40}})})}),t&&(0,z.tZ)(d.Z,{display:"flex",flexGrow:1}),(0,z.BX)(d.Z,{minWidth:320,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(Wn.Z,{artifactId:e,mainStatAssumptionLevel:n,canEquip:!0,editorProps:{disableSet:!0,disableSlot:!0},extraButtons:(0,z.tZ)(ta,{id:e})}),c&&c!==(0,pe.V7)(s)&&(0,z.tZ)(na,{locationKey:c})]})]})})})}function ta({id:e}){const{t}=(0,g.$G)("page_character_optimize"),{character:{key:n}}=(0,f.useContext)(S.K),{buildSetting:{artExclusion:a},buildSettingDispatch:i}=Gt(n),r=a.includes(e),l=(0,f.useCallback)((()=>i({artExclusion:(0,Xt.nh)(a,e)})),[e,a,i]);return(0,z.tZ)(ut.Z,{title:(0,z.BX)(d.Z,{children:[(0,z.tZ)(Y.Z,{children:t(Un||(Un=Jn`excludeArt.excludeArtifactTip`))}),(0,z.tZ)(Y.Z,{children:(0,z.tZ)(te.Z,{color:r?"error":"success",children:t(r?"excludeArt.excluded":"excludeArt.included")})})]}),placement:"top",arrow:!0,children:(0,z.tZ)(m.Z,{onClick:l,color:r?"error":"success",size:"small",children:r?(0,z.tZ)(Pt.Z,{}):(0,z.tZ)(Et.Z,{})})})}function na({locationKey:e}){const{t}=(0,g.$G)("page_character_optimize"),{character:{key:n}}=(0,f.useContext)(S.K),{database:a}=(0,f.useContext)(E.t),i=(0,O.m)(a.chars.LocationToCharacterKey(e)),{buildSetting:{allowLocations:r},buildSettingDispatch:l}=Gt(n),s=!r.includes(e),o=(0,f.useCallback)((()=>l({allowLocations:(0,Xt.nh)(r,e)})),[e,r,l]);return(0,z.tZ)(m.Z,{onClick:o,color:s?"secondary":"success",size:"small",startIcon:s?(0,z.tZ)(yn.Z,{}):(0,z.tZ)(xn.Z,{}),children:(0,z.BX)("span",{children:[t(Yn||(Yn=Jn`excludeChar.allowEquip`))," ",(0,z.tZ)("strong",{children:i.name})]})})}var aa=n(68164),ia=n(66510),ra=n(61660),la=n(22443),sa=n(55484),oa=n(25556),ca=n(81224),da=n(3131),ua=n(47857),ha=n(55734),Za=n(63004),pa=n(36197),ma=n(62689);function fa(e){const{database:t}=(0,f.useContext)(E.t),[n,a]=(0,f.useState)((()=>t.buildResult.get(e)));(0,f.useEffect)((()=>a(t.buildResult.get(e))),[t,e]),(0,f.useEffect)((()=>t.buildResult.follow(e,((e,t,n)=>"update"===t&&a(n)))),[e,a,t]);return{buildResult:n,buildResultDispatch:(0,f.useCallback)((n=>e&&t.buildResult.set(e,n)),[e,t])}}var ga=n(85090);function ba({cx:e,cy:t,payload:n,selectedPoint:a,radiusSelected:i=6,radiusUnselected:r=3,colorSelected:l="red",colorUnselected:s,shape:o="circle"}){if(!e||!t||!n)return null;const c=a&&a.x===n.x&&a.y===n.y;return(0,z.tZ)("g",{className:"custom-dot","data-chart-x":e,"data-chart-y":t,"data-x-value":n.x,"data-y-value":n.y,"data-radius":c?r:i,children:c?(0,z.BX)(z.HY,{children:[(0,z.tZ)(va,{id:"customShapeSelected",shape:o,cx:e,cy:t,r:i/2,fill:l}),(0,z.tZ)(va,{id:"customShapeBorder",shape:o,cx:e,cy:t,r:i,fill:"none",stroke:l})]}):(0,z.tZ)(va,{id:"customShapeUnselected",shape:o,cx:e,cy:t,r,fill:s})})}function va({shape:e,id:t,cx:n,cy:a,r:i,fill:r,stroke:l}){switch(e){case"circle":return(0,z.tZ)("circle",{id:t,cx:n,cy:a,r:i,fill:r,stroke:l});case"square":return(0,z.tZ)("rect",{id:t,x:n-i,y:a-i,width:2*i,height:2*i,fill:r,stroke:l});case"diamond":return(0,z.tZ)("polygon",{id:t,points:`${n},${a+2.5*i} ${n+1.5*i},${a} ${n},${a-2.5*i} ${n-1.5*i},${a}`,fill:r,stroke:l})}}var xa=n(99118),ya=n(69777);const wa=["xLabel","xUnit","yLabel","yUnit","selectedPoint","setSelectedPoint","addBuildToList"];function Ca(e){let{xLabel:t,xUnit:n,yLabel:a,yUnit:i,selectedPoint:r,setSelectedPoint:l,addBuildToList:s}=e,o=(0,ke.Z)(e,wa);const{database:c}=(0,f.useContext)(E.t),{data:d}=(0,f.useContext)(X.R),{t:Z}=(0,g.$G)("page_character_optimize"),p=(0,f.useMemo)((()=>r&&r.artifactIds&&Object.fromEntries(r.artifactIds.map((e=>{const t=c.arts.get(e);return[null==t?void 0:t.slotKey,t]})).filter((e=>e)))),[c.arts,r]),b=(0,f.useCallback)((e=>{e.target.id.includes("customShape")||e.target.id.includes("chartContainer")||l(void 0)}),[l]),v=p&&pe.Ex.every((e=>{var t;return(null==(t=p[e])?void 0:t.id)===d.get(xe.qH.art[e].id).value})),y=(0,f.useMemo)((()=>void 0!==(null==r?void 0:r.generBuildNumber)&&`#${null==r?void 0:r.generBuildNumber}`),[r]),C=(0,f.useMemo)((()=>void 0!==(null==r?void 0:r.graphBuildNumber)&&(0,z.BX)(g.cC,{t:Z,i18nKey:"graphBuildLabel",count:null==r?void 0:r.graphBuildNumber,children:["Graph #",{count:(null==r?void 0:r.graphBuildNumber)+1}]})),[r,Z]);return o.active&&r?(0,z.tZ)(xa.Z,{onClickAway:b,children:(0,z.tZ)(x.Z,{sx:{minWidth:"400px",maxWidth:"400px"},onClick:e=>e.stopPropagation(),children:(0,z.tZ)(h.Z,{children:(0,z.BX)(de.Z,{gap:1,children:[(0,z.BX)(de.Z,{direction:"row",alignItems:"start",gap:1,children:[(0,z.BX)(de.Z,{spacing:.5,flexGrow:99,children:[v&&(0,z.tZ)(B.Z,{color:"info",children:(0,z.tZ)("strong",{children:Z("currentlyEquippedBuild")})}),y&&(0,z.tZ)(B.Z,{color:"info",children:y}),C&&(0,z.tZ)(B.Z,{color:"info",children:C}),(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{width:300,height:50}),children:(0,z.tZ)(Fn,{artifacts:Object.values(p),currentlyEquipped:v})})]}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1}),(0,z.tZ)(w.Z,{onClick:()=>l(void 0)})]}),(0,z.tZ)(ue.ZP,{container:!0,direction:"row",spacing:.75,columns:5,children:pe.Ex.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{width:75,height:75}),children:(0,z.tZ)(ya.Z,{artifactObj:p[e],slotKey:e})})},e)))}),(0,z.BX)(Y.Z,{children:[(0,z.tZ)("strong",{children:t}),": ",(0,ye.EC)("%"===n?r.x/100:r.x,n)]}),(0,z.BX)(Y.Z,{children:[(0,z.tZ)("strong",{children:a}),": ",(0,ye.EC)("%"===i?r.y/100:r.y,i)]}),(0,z.tZ)(ut.Z,{title:r.highlighted?Z("tcGraph.buildAlreadyInList"):"",placement:"top",children:(0,z.tZ)("span",{children:(0,z.tZ)(m.Z,{sx:{width:"100%"},disabled:void 0!==(null==r?void 0:r.graphBuildNumber),color:"info",onClick:()=>s(r.artifactIds),children:Z("addBuildToList")})})})]})})})}):null}class ka{constructor(e,t,n){this.x=void 0,this.trueY=void 0,this.artifactIds=void 0,this.min=void 0,this.current=void 0,this.highlighted=void 0,this.generBuildNumber=void 0,this.graphBuildNumber=void 0,this.x=e,this.trueY=t,this.artifactIds=n}get y(){return this.trueY||this.current||this.highlighted}set y(e){this.trueY=e}}let Ba,Sa,Xa,ja,Pa,Oa,Ea,Ka=e=>e;function Ma({plotBase:e,setPlotBase:t,disabled:n=!1,showTooltip:a=!1}){const{t:i}=(0,g.$G)(["page_character_optimize","ui"]),{data:r}=(0,f.useContext)(X.R),{chartData:l}=(0,f.useContext)(P),[s,o]=(0,f.useState)(!1),[c,d]=(0,f.useState)(!0),{graphBuilds:u}=(0,f.useContext)(P),{character:{key:Z}}=(0,f.useContext)(S.K),{buildResult:{builds:p}}=fa(Z),[b,v]=(0,f.useState)(-1/0),[w,C]=(0,f.useState)(1/0),k=(0,f.useCallback)(((e,t)=>{if("number"==typeof t)throw new TypeError;const[n,a]=t;v(n),C(a)}),[v,C]);(0,f.useEffect)((()=>{v(-1/0),C(1/0)}),[l]);const{displayData:B,downloadData:j,sliderMin:O,sliderMax:E}=(0,f.useMemo)((()=>{var e,t;if(!l)return{displayData:null,downloadData:null};let n=1/0,a=-1/0;const i=pe.Ex.map((e=>{var t;return null!=(t=null==r?void 0:r.get(xe.qH.art[e].id).value)?t:""})),s=l.data.map((({value:e,plot:t,artifactIds:r})=>{if(void 0===t)return null;t<n&&(n=t),t>a&&(a=t);const l=new ka(t,e,r),s=(0,Xt.O)(r,(e=>!0)),o=i.every((e=>s[e]));o&&(l.current=e,l.y=void 0,console.log(l));const c=null==u?void 0:u.findIndex((e=>e.every((e=>s[e]))));void 0!==c&&-1!==c&&(o&&console.log(l),void 0!==l.trueY&&(l.highlighted=e,l.y=void 0),l.graphBuildNumber=c+1,o&&console.log(l));const d=p.findIndex((e=>e.every((e=>s[e]))));return-1!==d&&(o&&console.log(l),void 0!==l.trueY&&(l.highlighted=e,l.y=void 0),l.generBuildNumber=d+1,o&&console.log(l)),l})).filter((e=>null!==e)).sort(((e,t)=>e.x-t.x)),o=[];for(const e of s){let t;for(;t=o.pop();)if(t.y>e.y){o.push(t);break}o.push(e)}(null==(e=o[0])?void 0:e.x)!==(null==(t=s[0])?void 0:t.x)&&(s[0].min=o[0].y),o.forEach((e=>{e.min=e.y}));const c={minimum:o.map((e=>[e.x,e.y])),allData:s.map((e=>[e.x,e.y]))};return{displayData:s.filter((e=>e&&e.x>=b&&e.x<=w)),downloadData:c,sliderMin:n,sliderMax:a}}),[l,p,r,u,b,w]),K=e&&(0,Xt.Hm)(null==r?void 0:r.getDisplay(),e),M=i(e&&(!K||K.isEmpty)?"page_character_optimize:targetSelector.invalidTarget":"page_character_optimize:targetSelector.selectGraphTarget");return(0,z.BX)(y.Z,{children:[(0,z.tZ)(h.Z,{children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(Y.Z,{children:i(Ba||(Ba=Ka`tcGraph.vs`))})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(ut.Z,{placement:"top",title:a?i("page_character_optimize:selectTargetFirst"):"",children:(0,z.tZ)("span",{children:(0,z.tZ)(ga.Z,{optimizationTarget:e,setTarget:e=>t(e),defaultText:M,disabled:n})})})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(ut.Z,{title:e?i("ui:reset"):"",placement:"top",children:(0,z.tZ)("span",{children:(0,z.tZ)(m.Z,{color:"error",onClick:()=>t(void 0),disabled:!e||n,children:(0,z.tZ)(me.Z,{})})})})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(pt.Z,{placement:"top",title:i("page_character_optimize:tcGraph.desc")})}),!!j&&(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(m.Z,{size:"small",startIcon:c?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:c?"success":"secondary",onClick:()=>d(!c),children:i(Sa||(Sa=Ka`tcGraph.showStatThr`))})}),!!j&&(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(m.Z,{size:"small",color:"info",startIcon:(0,z.tZ)(aa.Z,{}),onClick:()=>o(!s),children:i(Xa||(Xa=Ka`tcGraph.downloadData`))})})]})}),B&&B.length&&(0,z.tZ)(F.Z,{}),l&&B&&B.length&&(0,z.BX)(h.Z,{children:[(0,z.tZ)(ve.Z,{in:!!j&&s,children:(0,z.tZ)(x.Z,{sx:{mb:2},children:(0,z.BX)(h.Z,{children:[(0,z.tZ)(Y.Z,{children:"Min Data"}),(0,z.tZ)(ma.Z,{value:JSON.stringify(null==j?void 0:j.minimum)}),(0,z.tZ)(Y.Z,{children:"All Data"}),(0,z.tZ)(ma.Z,{value:JSON.stringify(null==j?void 0:j.allData)})]})})}),(0,z.tZ)(Ra,{displayData:B,plotNode:l.plotNode,valueNode:l.valueNode,showMin:c}),B.length>1&&(0,z.tZ)(ia.ZP,{marks:!0,value:[b,w],onChange:k,onChangeCommitted:k,min:O,max:E,step:(E-O)/20,valueLabelDisplay:"auto",valueLabelFormat:e=>{var t,n;return(0,ye.EC)("%"===(null==(t=l.plotNode.info)?void 0:t.unit)?e/100:e,null==(n=l.plotNode.info)?void 0:n.unit)},sx:{ml:"6%",width:"93%"}})]})]})}const Aa="#8884d8",Da="cyan",Ia="#46a046",Ta="#ff7300";function Ra({displayData:e,plotNode:t,valueNode:n,showMin:a}){var i,r,l,s;const{graphBuilds:o,setGraphBuilds:c}=(0,f.useContext)(P),{t:d}=(0,g.$G)("page_character_optimize"),[u,h]=(0,f.useState)(),Z=(0,f.useCallback)((e=>{c([...null!=o?o:[],e]),h(void 0)}),[c,o]),p=(0,f.useCallback)((t=>{t&&t.chartX&&t.chartY&&h(function(e,t,n,a){const i=Array.from(document.querySelectorAll(".custom-dot")).reduce(((n,a)=>{const{chartX:i,chartY:r}=n.dataset,l=Math.sqrt((e-i)**2+(t-r)**2),{chartX:s,chartY:o}=a.dataset;return l<=Math.sqrt((e-s)**2+(t-o)**2)?n:a})).dataset;return Math.sqrt((e-i.chartX)**2+(t-i.chartY)**2)<n?a.find((e=>e.x===+i.xValue&&e.y===+i.yValue)):void 0}(t.chartX,t.chartY,20,e))}),[h,e]),m=_a(t,d),b=_a(n,d);return(0,z.tZ)(ra.h,{width:"100%",height:600,children:(0,z.BX)(la.c,{id:"chartContainer",data:e,onClick:p,style:{cursor:"pointer"},children:[(0,z.tZ)(sa.q,{strokeDasharray:"3 3"}),(0,z.tZ)(oa.K,{dataKey:"x",scale:"linear",unit:null==(i=t.info)?void 0:i.unit,domain:["auto","auto"],tick:{fill:"white"},type:"number",tickFormatter:e=>e>1e4?e.toFixed():e.toFixed(1),label:(0,z.tZ)(ca._,{fill:"white",dy:10,children:m}),height:50}),(0,z.tZ)(da.B,{name:"DMG",domain:["auto","auto"],unit:null==(r=n.info)?void 0:r.unit,allowDecimals:!1,tick:{fill:"white"},type:"number",label:(0,z.tZ)(ca._,{fill:"white",angle:-90,dx:-40,children:b}),width:100}),(0,z.tZ)(ua.u,{content:(0,z.tZ)(Ca,{xLabel:m,xUnit:null==(l=t.info)?void 0:l.unit,yLabel:b,yUnit:null==(s=n.info)?void 0:s.unit,selectedPoint:u,setSelectedPoint:h,addBuildToList:Z}),trigger:"click",wrapperStyle:{pointerEvents:"auto",cursor:"auto"},cursor:!1}),(0,z.tZ)(ha.D,{payload:[...a?[{id:"min",value:d(ja||(ja=Ka`tcGraph.statReqThr`)),type:"line",color:Ta}]:[],{id:"trueY",value:d(Pa||(Pa=Ka`tcGraph.generatedBuilds`)),type:"circle",color:Aa},{id:"highlighted",value:d(Oa||(Oa=Ka`tcGraph.highlightedBuilds`)),type:"square",color:Da},{id:"current",value:d(Ea||(Ea=Ka`tcGraph.currentBuild`)),type:"diamond",color:Ia}]}),a&&(0,z.tZ)(Za.x,{dataKey:"min",stroke:Ta,type:"stepBefore",connectNulls:!0,strokeWidth:2,isAnimationActive:!1,dot:!1,activeDot:!1}),(0,z.tZ)(pa.b,{dataKey:"trueY",isAnimationActive:!1,shape:(0,z.tZ)(ba,{selectedPoint:u,colorUnselected:Aa})}),(0,z.tZ)(pa.b,{dataKey:"highlighted",isAnimationActive:!1,shape:(0,z.tZ)(ba,{shape:"square",selectedPoint:u,colorUnselected:Da})}),(0,z.tZ)(pa.b,{dataKey:"current",isAnimationActive:!1,shape:(0,z.tZ)(ba,{shape:"diamond",selectedPoint:u,colorUnselected:Ia})})]})})}function _a(e,t){var n,a,i,r,l,s,o;return"string"==typeof(null==(n=e.info)?void 0:n.name)?e.info.name:`${t(`${null==(a=e.info)||null==(i=a.name)?void 0:i.props.ns}:${null==(r=e.info)||null==(l=r.name)?void 0:l.props.key18}`)}${null!=(s=e.info)&&s.textSuffix?` ${null==(o=e.info)?void 0:o.textSuffix}`:""}`}var La=n(93553),Ga=n(19157),$a=n(71957),za=n(1661);let Na,Va,Wa,qa,Fa,Ha=e=>e;function Ua({disabled:e=!1}){const{t}=(0,g.$G)("page_character_optimize"),{character:{key:n}}=(0,f.useContext)(S.K),{buildSetting:{artExclusion:a},buildSettingDispatch:i}=Gt(n),[r,l,s]=(0,K.Z)(!1),o=a.length,[c,u,Z]=(0,K.Z)(!1),p=(0,f.useCallback)((e=>{i({artExclusion:[...a,e]})}),[i,a]),b=(0,f.useCallback)((e=>{i({artExclusion:a.filter((t=>t!==e))})}),[i,a]);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(ae.Z,{open:r,onClose:s,containerProps:{maxWidth:"xl"},children:(0,z.BX)(x.Z,{children:[(0,z.tZ)(h.Z,{children:(0,z.BX)(d.Z,{display:"flex",gap:1,alignItems:"center",children:[(0,z.tZ)(Y.Z,{variant:"h6",children:t(Na||(Na=Ha`excludeArt.title_exclude`))}),(0,z.tZ)(pt.Z,{title:(0,z.tZ)(Y.Z,{children:t(Va||(Va=Ha`excludeArt.title_tooltip`))})}),(0,z.tZ)(d.Z,{flexGrow:1}),(0,z.tZ)(w.Z,{onClick:s,size:"small"})]})}),(0,z.tZ)(F.Z,{}),(0,z.BX)(h.Z,{children:[(0,z.tZ)(Qa,{show:c,onClose:Z,onSelect:p,artExclusion:a}),(0,z.tZ)(m.Z,{fullWidth:!0,onClick:u,color:"info",sx:{mb:1},startIcon:(0,z.tZ)(La.Z,{}),children:t(Wa||(Wa=Ha`excludeArt.addExc`))}),!!o&&(0,z.tZ)(y.Z,{sx:{mb:1},children:(0,z.tZ)(Y.Z,{textAlign:"center",children:t(qa||(qa=Ha`excludeArt.deSelectExc`))})}),(0,z.tZ)(ue.ZP,{container:!0,columns:{xs:3,md:5,lg:6,xl:8},spacing:1,children:a.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Dn,{artifactId:e,slotKey:"flower",BGComponent:y.Z,onClick:()=>b(e),showLocation:!0})},e)))})]})]})}),(0,z.tZ)(m.Z,{fullWidth:!0,onClick:l,disabled:e,startIcon:(0,z.tZ)(Pt.Z,{}),color:"info",children:(0,z.BX)(d.Z,{sx:{display:"flex",gap:1},children:[(0,z.tZ)(d.Z,{children:t("excludeArt.title_exclude")}),(0,z.tZ)(B.Z,{children:(0,z.BX)(g.cC,{t,i18nKey:"excludeArt.excNum",count:o,children:["Excluded ",(0,z.tZ)("strong",{children:{count:o}})," artifacts"]})})]})})]})}const Ya={xs:6,sm:6,md:9,lg:12,xl:12},Ja=(e,t)=>Object.assign({},e,t);function Qa({onSelect:e,show:t,onClose:n,artExclusion:a}){const{t:i}=(0,g.$G)("page_character_optimize"),{database:r}=(0,f.useContext)(E.t),l=(0,f.useCallback)((t=>{e(t),n()}),[e,n]),[s,o]=(0,f.useReducer)(Ja,(0,$a.Af)()),[c,Z]=(0,xt.Z)();(0,f.useEffect)((()=>r.arts.followAny(Z)),[r,Z]);const p=(0,yt.Z)(),m=(0,f.useMemo)((()=>(0,$a.EM)()),[]),b=(0,f.useMemo)((()=>{const e=(0,za.C)(s,m);return c&&r.arts.values.filter(e).map((e=>e.id)).filter((e=>!a.includes(e))).slice(0,Ya[p])}),[c,r,m,s,p,a]);return(0,z.tZ)(ae.Z,{open:t,onClose:n,containerProps:{maxWidth:"xl"},children:(0,z.BX)(x.Z,{children:[(0,z.BX)(h.Z,{sx:{py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:i(Fa||(Fa=Ha`excludeArt.selExc`))}),(0,z.tZ)(w.Z,{onClick:n})]}),(0,z.tZ)(F.Z,{}),(0,z.BX)(h.Z,{children:[(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.tZ)(Ga.default,{filterOption:s,filterOptionDispatch:o,filteredIds:b})}),(0,z.tZ)(d.Z,{mt:1,children:(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:300}),children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:b.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Wn.Z,{artifactId:e,onClick:l})},e)))})})})]})]})})}var ei=n(16230),ti=n(51704);let ni,ai,ii,ri,li=e=>e;function si({disabled:e=!1,numArtsEquippedUsed:t}){const{t:n}=(0,g.$G)("page_character_optimize"),{character:{key:a}}=(0,f.useContext)(S.K),{buildSetting:{allowLocations:i},buildSettingDispatch:r}=Gt(a),{database:l}=(0,f.useContext)(E.t),[s,o,c]=(0,K.Z)(!1),[u,Z]=(0,xt.Z)(),p=(0,f.useDeferredValue)(u);(0,f.useEffect)((()=>l.charMeta.followAny((e=>Z()))),[Z,l]),(0,f.useEffect)((()=>l.chars.followAny((e=>Z()))),[Z,l]);const b=(0,f.useMemo)((()=>p&&Array.from(new Set(Object.entries(l.chars.data).filter((([e])=>e!==a)).sort((([e,t],[n,a])=>{const[i,r]=[-1,1],s=l.charMeta.get(e).favorite,o=l.charMeta.get(n).favorite;if(s&&!o)return i;if(o&&!s)return r;const c=Object.values(t.equippedArtifacts).filter((e=>e)).length,d=Object.values(a.equippedArtifacts).filter((e=>e)).length;return c>d?i:d>c?r:e.localeCompare(n)})).map((([e])=>(0,pe.V7)(e)))))),[p,a,l]),v=(0,f.useCallback)((()=>r({allowLocations:[...b]})),[r,b]),y=(0,f.useCallback)((()=>r({allowLocations:[]})),[r]),C=(0,f.useCallback)((e=>r({allowLocations:(0,Xt.nh)(i,e)})),[i,r]),k=b.length,X=i.length;return(0,z.BX)(d.Z,{display:"flex",gap:1,children:[(0,z.tZ)(ae.Z,{open:s,onClose:c,containerProps:{maxWidth:"xl"},children:(0,z.BX)(x.Z,{children:[(0,z.tZ)(h.Z,{children:(0,z.BX)(d.Z,{display:"flex",gap:1,children:[(0,z.tZ)(Y.Z,{variant:"h6",flexGrow:1,children:n(ni||(ni=li`excludeChar.title`))}),(0,z.tZ)(w.Z,{onClick:c,size:"small"})]})}),(0,z.tZ)(F.Z,{}),(0,z.BX)(h.Z,{children:[(0,z.BX)(d.Z,{pb:1,display:"flex",gap:1,flexWrap:"wrap",children:[(0,z.BX)(m.Z,{color:"success",sx:{flexGrow:1},onClick:v,children:[n(ai||(ai=li`excludeChar.modal.allow_all`)),(0,z.tZ)(B.Z,{sx:{ml:1},children:(0,z.tZ)("strong",{children:`${X}/${k}`})})]}),(0,z.BX)(m.Z,{color:"error",sx:{flexGrow:1},onClick:y,children:[n(ii||(ii=li`excludeChar.modal.disallow_All`)),(0,z.tZ)(B.Z,{sx:{ml:1},children:(0,z.tZ)("strong",{children:`${k-X}/${k}`})})]})]}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:6,sm:7,md:10,lg:12,xl:16},children:b.map(((e,t)=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(oi,{locKey:e,onClick:()=>C(e),selected:i.includes(e)})},e)))})]})]})}),(0,z.tZ)(m.Z,{sx:{flexGrow:1},color:"info",onClick:o,disabled:e,startIcon:(0,z.tZ)(ei.Z,{}),children:(0,z.BX)(d.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,z.tZ)("span",{children:n(ri||(ri=li`excludeChar.title`))}),(0,z.tZ)(B.Z,{sx:{whiteSpace:"normal"},children:(0,z.BX)(g.cC,{t:n,i18nKey:"excludeChar.usingNumTot",count:X,arts:t,children:["Using ",(0,z.tZ)("strong",{children:{arts:t}})," artifacts from ",(0,z.tZ)("strong",{children:{count:X}})," characters"]})})]})})]})}function oi({locKey:e,selected:t,onClick:n}){const{database:a}=(0,f.useContext)(E.t),i=a.chars.get(a.chars.LocationToCharacterKey(e));return(0,z.tZ)(Cn.Z,{onClick:n,sx:{},children:(0,z.BX)(y.Z,{sx:{opacity:t?void 0:.6,borderColor:t?"rgb(100,200,100)":"rgb(200,100,100)",borderWidth:"3px",borderStyle:"solid",borderRadius:"8px"},children:[(0,z.tZ)(ti.Z,{characterKey:a.chars.LocationToCharacterKey(e)}),(0,z.tZ)(d.Z,{fontSize:"0.85em",display:"flex",justifyContent:"space-between",p:.3,children:pe.Ex.map((e=>(0,z.tZ)(It.Z,{slotKey:e,iconProps:{fontSize:"inherit",sx:{opacity:null!=i&&i.equippedArtifacts[e]?void 0:.5}}},e)))})]})})}var ci=n(11716),di=n(92658),ui=n(56),hi=n(12777),Zi=n(10618),pi=n(40775);const mi=["sands","goblet","circlet"];function fi({disabled:e=!1,filteredArtIdMap:t}){const{t:n}=(0,g.$G)("artifact"),{character:{key:a}}=(0,f.useContext)(S.K),{buildSetting:{mainStatKeys:i},buildSettingDispatch:r}=Gt(a),{database:l}=(0,f.useContext)(E.t),{mainStatSlotTots:s,slotTots:o}=(0,f.useMemo)((()=>{const e={flowerMainStatTots:Xn.ZP.slotMainStats("flower"),plumeMainStatTots:Xn.ZP.slotMainStats("plume"),sandsMainStatTots:Xn.ZP.slotMainStats("sands"),gobletMainStatTots:Xn.ZP.slotMainStats("goblet"),circletMainStatTots:Xn.ZP.slotMainStats("circlet"),slotTots:mi},n=(0,pi.A)(e,(e=>Object.entries(l.arts.data).forEach((([n,a])=>{const{slotKey:i,mainStatKey:r}=a;mi.includes(i)&&(e.slotTots[i].total++,t[n]&&e.slotTots[i].current++),e[`${i}MainStatTots`][r].total++,t[n]&&e[`${i}MainStatTots`][r].current++}))));return{mainStatSlotTots:{flower:n.flowerMainStatTots,plume:n.plumeMainStatTots,sands:n.sandsMainStatTots,goblet:n.gobletMainStatTots,circlet:n.circletMainStatTots},slotTots:n.slotTots}}),[l,t]);return(0,z.BX)(d.Z,{display:"flex",flexDirection:"column",children:[(0,z.tZ)(F.Z,{}),(0,z.BX)(d.Z,{display:"flex",children:[(0,z.tZ)(h.Z,{sx:{flexGrow:1},children:(0,z.BX)(d.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:n("slotName.flower")}),children:(0,z.tZ)(ci.Z,{fontSize:"inherit"})}),(0,z.tZ)(d.Z,{flexGrow:1,children:(0,z.BX)(B.Z,{color:"info",children:[(0,z.tZ)(hi.Z,Object.assign({},Ce.m))," ",s.flower.hp]})})]})}),(0,z.tZ)(F.Z,{orientation:"vertical",flexItem:!0}),(0,z.tZ)(h.Z,{sx:{flexGrow:1},children:(0,z.BX)(d.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:n("slotName.plume")}),children:(0,z.tZ)(di.Z,{fontSize:"inherit"})}),(0,z.tZ)(d.Z,{flexGrow:1,children:(0,z.BX)(B.Z,{color:"info",children:[(0,z.tZ)(ui.Z,Object.assign({},Ce.m))," ",s.plume.atk]})})]})})]}),mi.map((t=>{const a=i[t],l=Xn.ZP.slotMainStats(t),c=(0,Zi.X)([...l]);return(0,z.BX)(d.Z,{children:[(0,z.tZ)(F.Z,{}),(0,z.BX)(h.Z,{sx:{pt:1,pb:1},children:[(0,z.BX)(d.Z,{sx:{display:"flex",gap:1,alignItems:"center",pb:1},children:[(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:n(`slotName.${t}`)}),children:(0,z.tZ)(d.Z,{lineHeight:0,children:(0,z.tZ)(It.Z,{slotKey:t,iconProps:{fontSize:"inherit"}})})}),(0,z.tZ)(d.Z,{flexGrow:1,children:(0,z.tZ)(B.Z,{color:"info",children:o[t]})})]}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:l.map(((n,l)=>{const o=pe.fR.find((e=>n.includes(e))),d=a.includes(n)?null!=o?o:"success":"secondary";return(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,xs:l<3&&"goblet"!==t||"goblet"===t?4:void 0,children:(0,z.tZ)(ut.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:(0,z.tZ)(Mn,{statKey:n})})}),disableInteractive:!0,children:(0,z.tZ)(m.Z,{fullWidth:!0,size:"small",color:d,sx:{height:"100%",pointerEvents:e?"none":void 0,cursor:e?"none":void 0},startIcon:(0,z.tZ)(we.C,{statKey:n}),onClick:()=>r({mainStatKeys:Object.assign({},i,{[t]:c(a,n)})}),children:s[t][n]})})},n)}))})]})]},t)}))]})}function gi({statFilters:e,setStatFilters:t,disabled:n=!1}){const a=(0,f.useCallback)(((n,a,i)=>{var r;const l=Object.assign({},e),s=JSON.stringify(a),o=a?[...e[s]]:void 0,c=JSON.stringify(n),d=[...null!=(r=e[c])?r:[]];void 0!==i&&o?d.push(o[i]):d.push({value:0,disabled:!1}),l[c]=d,void 0!==i&&o&&(o.splice(i,1),o.length?l[s]=o:delete l[s]),t(Object.assign({},l))}),[t,e]),i=(0,f.useCallback)(((n,a)=>{const i=Object.assign({},e),r=JSON.stringify(n),l=[...e[r]];l.splice(a,1),l.length?i[r]=l:delete i[r],t(Object.assign({},i))}),[t,e]),r=(0,f.useCallback)(((n,a,i)=>{const r=Object.assign({},e),l=JSON.stringify(n),s=[...e[l]];s[a]=Object.assign({},s[a],{value:i}),r[l]=s,t(Object.assign({},r))}),[t,e]),l=(0,f.useCallback)(((n,a,i)=>{const r=Object.assign({},e),l=JSON.stringify(n),s=[...e[l]];s[a]=Object.assign({},s[a],{disabled:i}),r[l]=s,t(Object.assign({},r))}),[t,e]);return(0,z.BX)(z.HY,{children:[Object.entries(e).flatMap((([e,t])=>null==t?void 0:t.map(((t,s)=>(0,z.tZ)(bi,{path:JSON.parse(e),setting:t,index:s,setTarget:a,delTarget:i,setValue:r,setDisabled:l,disabled:n},e+s))))),(0,z.tZ)(bi,{setTarget:a,delTarget:i,setValue:r,setDisabled:l,disabled:n})]})}function bi({path:e,setting:t,index:n,setTarget:a,delTarget:i,setValue:r,setDisabled:l,disabled:s}){var o;const{t:c}=(0,g.$G)("page_character_optimize"),{data:d}=(0,f.useContext)(X.R),u=(0,f.useCallback)((t=>e&&void 0!==n&&r(e,n,null!=t?t:0)),[r,e,n]),h={p:1,flexBasis:30,flexGrow:0,flexShrink:0},Z=(0,Xt.Hm)(d.getDisplay(),null!=e?e:[]),p="%"===(null==Z||null==(o=Z.info)?void 0:o.unit);return(0,z.BX)(Pe.Z,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&void 0!==n&&(0,z.tZ)(m.Z,{sx:h,color:t.disabled?"secondary":"success",onClick:()=>l(e,n,!t.disabled),disabled:s,children:t.disabled?(0,z.tZ)(ge.Z,{}):(0,z.tZ)(fe.Z,{})}),(0,z.tZ)(ga.Z,{showEmptyTargets:!0,optimizationTarget:e,setTarget:t=>a(t,e,n),defaultText:c("targetSelector.selectBuildTarget")}),(0,z.tZ)(Oe.CC,{sx:{flexBasis:150,flexGrow:1},children:(0,z.tZ)(Oe.ZP,{float:!0,disabled:!e||s,value:null==t?void 0:t.value,placeholder:"Stat Value",onChange:u,sx:{px:1},inputProps:{sx:{textAlign:"right"}},endAdornment:p?"%":void 0})}),!!e&&void 0!==n&&(0,z.tZ)(m.Z,{sx:h,color:"error",onClick:()=>i(e,n),disabled:s,children:(0,z.tZ)(it.Z,{fontSize:"small"})})]})}let vi,xi,yi=e=>e;function wi({disabled:e=!1}){const{t}=(0,g.$G)("page_character_optimize"),{character:{key:n}}=(0,f.useContext)(S.K),{buildSetting:{statFilters:a},buildSettingDispatch:i}=Gt(n),r=(0,f.useCallback)((e=>i({statFilters:e})),[i]);return(0,z.BX)(d.Z,{children:[(0,z.tZ)(y.Z,{children:(0,z.BX)(h.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[(0,z.tZ)(Y.Z,{children:t(vi||(vi=yi`constraintFilter.title`))}),(0,z.tZ)(pt.Z,{title:(0,z.tZ)(Y.Z,{children:t(xi||(xi=yi`constraintFilter.tooltip`))})})]})}),(0,z.tZ)(d.Z,{display:"flex",flexDirection:"column",gap:.5,children:(0,z.tZ)(gi,{statFilters:a,setStatFilters:r,disabled:e})})]})}let Ci,ki=e=>e;function Bi(){const{t:e}=(0,g.$G)("page_character_optimize");return(0,z.tZ)(he.Z,{severity:"error",variant:"filled",onClick:()=>window.location.reload(),sx:{"& .MuiAlert-message":{flexGrow:1,cursor:"pointer"}},children:e(Ci||(Ci=ki`workerLoadFailed`))})}var Si=n(69190);const Xi=(0,Lt.yY)((0,Xt.I8)({dyn:Object.assign({},xe.qH.art,xe.qH.artSet)})),ji={art:(0,Xt.O)([...Si.rW,...Si._m],(e=>Xi.dyn[e])),artSet:(0,Xt.xh)(xe.qH.artSet,((e,t)=>Xi.dyn[t]))};var Pi=n(47452),Oi=n(40580);function Ei(e){if(1===e.length)return e[0];const t=(e=e.flatMap((e=>"add"===e.operation?e.operands:e))).reduce(((e,t)=>"const"===t.operation?e+t.value:e),0);return 0===(e=e.filter((e=>"const"!==e.operation))).length?(0,Lt.a9)(t):0===t?1===e.length?e[0]:(0,Lt.Sm)(...e):(0,Lt.Sm)(...e,(0,Lt.a9)(t))}function Ki(e){if(1===e.length)return e[0];const t=(e=e.flatMap((e=>"mul"===e.operation?e.operands:e))).reduce(((e,t)=>"const"===t.operation?e*t.value:e),1);return 0===(e=e.filter((e=>"const"!==e.operation))).length?(0,Lt.a9)(t):1===t?(0,Lt.WV)(...e):(0,Lt.WV)(...e,(0,Lt.a9)(t))}function Mi(e,t){const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=n.length;for(let i=0;i<5;i++){let i="";for(let t=0;t<e;t++)i+=n.charAt(Math.floor(Math.random()*a));if(!t||!t.includes(i))return i}throw Error("Too many collisions in `makeid`")}function Ai({operation:e,operands:t}){return"const"===e||"read"===e||"threshold"===e||"add"===e&&t.every((e=>"const"===e.operation||"read"===e.operation||"threshold"===e.operation))}function Di(e,t){delete e.base[t],e.values.flower.forEach((e=>delete e.values[t])),e.values.plume.forEach((e=>delete e.values[t])),e.values.sands.forEach((e=>delete e.values[t])),e.values.goblet.forEach((e=>delete e.values[t])),e.values.circlet.forEach((e=>delete e.values[t]))}function Ii(e,t){const n=Object.keys(e.base),a={};function i(e,t){if(!Ai(e))throw Error("`distribute` only works on shallow node type.");if(1===t)return e;switch(e.operation){case"threshold":{const[n,a,i,r]=e.operands;if("read"===n.operation)return(0,Lt.Lj)(n,a,Ki([i,(0,Lt.a9)(t)]),Ki([r,(0,Lt.a9)(t)]),{source:n.path[1]});throw console.log(e),Error("branch is not read...?")}case"const":return(0,Lt.a9)(t*e.value);case"add":return(0,Lt.Sm)(...e.operands.map((e=>i(e,t))));case"read":{const i=Mi(5,[...n,...Object.keys(a)]);return a[i]={base:0,coeff:t,sumKeys:[e.path[1]]},(0,Lt.UF)(["dyn",i])}default:throw Error("`preprocessing::collapseAffine::distributeProd` only works on shallow node type")}}const r=(0,Oi.uW)(t,(e=>e),(e=>{switch(e.operation){case"mul":{let t=e.operands;if(t.some((e=>"mul"===e.operation))){const e=t.filter((e=>"mul"===e.operation)).flatMap((e=>[...e.operands])),n=t.filter((e=>"mul"!==e.operation));t=[...n,...e]}if(t.every(Ai)&&t.some((e=>"const"===e.operation))){const e=t.reduce(((e,t)=>"const"===t.operation?e*t.value:e),1),n=t.filter((e=>"const"!==e.operation));if(0===n.length)return(0,Lt.a9)(e);const a=i(n.pop(),e);return 0===n.length?a:(0,Lt.WV)(a,...n)}return e}case"add":{let t=e.operands;if(t.some((e=>"add"===e.operation))){const e=t.filter((e=>"add"===e.operation)).flatMap((e=>[...e.operands])),n=t.filter((e=>"add"!==e.operation));t=[...n,...e]}if(t.filter((e=>"const"===e.operation||"read"===e.operation)).length>1){const e=t.filter((e=>"const"!==e.operation&&"read"!==e.operation)),i=t.filter((e=>"const"===e.operation||"read"===e.operation)),r=Mi(5,[...n,...Object.keys(a)]),l=i.reduce(((e,t)=>"const"===t.operation?e+t.value:e),0),s=i.map((e=>"read"===e.operation?e.path[1]:void 0)).filter((e=>e));return a[r]={base:l,coeff:1,sumKeys:s},0===e.length?(0,Lt.UF)(["dyn",r]):(0,Lt.Sm)(...e,(0,Lt.UF)(["dyn",r]))}return e}default:return e}})),l=new Set(Object.keys(e.base)),s=Object.entries(a);for(;s.length>0;){const[t,{base:n,coeff:a,sumKeys:i}]=s.shift();if(!i.every((e=>l.has(e)))){s.push([t,{base:n,coeff:a,sumKeys:i}]);continue}const r=e=>a*i.reduce(((t,n)=>t+e[n]),0);e.base[t]=n+r(e.base),e.values.flower.forEach((e=>e.values[t]=r(e.values))),e.values.plume.forEach((e=>e.values[t]=r(e.values))),e.values.sands.forEach((e=>e.values[t]=r(e.values))),e.values.goblet.forEach((e=>e.values[t]=r(e.values))),e.values.circlet.forEach((e=>e.values[t]=r(e.values))),l.add(t)}const o=new Set(l);return(0,Oi.aD)(r,(e=>{}),(e=>{"read"===e.operation&&o.delete(e.path[1])})),o.forEach((t=>Di(e,t))),{arts:e,nodes:r}}function Ti(e,t){t=function(e,t){const n=Object.entries(t).filter((([,{min:e,max:t}])=>e===t)).map((([e])=>e));return(0,Oi.uW)(e,(e=>e),(e=>{switch(e.operation){case"add":return Ei(e.operands);case"mul":return Ki(e.operands);case"read":return n.includes(e.path[1])?(0,Lt.a9)(t[e.path[1]].min):e;case"threshold":{const[n,a,i,r]=e.operands;if("const"===n.operation&&"const"===a.operation)return n.value>=a.value?i:r;if("read"===n.operation&&"const"===a.operation){const l=t[n.path[1]];if(!l)return e;if(l.min>=a.value)return i;if(l.max<a.value)return r}return e}case"min":case"max":case"res":case"sum_frac":if(e.operands.every((e=>"const"===e.operation))){const t=vt.aj[e.operation](e.operands.map((e=>"const"===e.operation?e.value:NaN)));return(0,Lt.a9)(t)}return e;default:return e}}))}(t,(0,wt.LG)(e)),({arts:e,nodes:t}=Ii(e,t));const n=Object.keys(e.base),a=[e.base,...Object.values(e.values).flatMap((e=>e.map((e=>e.values))))],i=n.length,r=a.length,l=n.map((e=>a.map((t=>t[e])))),s=Array(i).fill(0).map((e=>Array(i).fill(0)));for(let e=0;e<i;e++)s[e][e]=1;const o=new Set;for(let e=0;e<r;e++){let t=-1;for(let n=0;n<i;n++)if(!o.has(n)&&Math.abs(l[n][e])>1e-8){t=n;break}if(t<0)continue;o.add(t);const n=t;for(let t=0;t<i;t++)if(!o.has(t)&&Math.abs(l[t][e])>1e-8){const a=l[t][e]/l[n][e];l[t]=l[t].map(((e,t)=>e-a*l[n][t])),s[t]=s[t].map(((e,t)=>e-a*s[n][t]))}if(o.size===i)break}if(o.size===i)return{arts:e,nodes:t};for(let a=0;a<i;a++)if(!o.has(a)){const i=s[a].map(((e,t)=>({w:t===a?0:-e,key:n[t]}))).filter((({w:e})=>Math.abs(e)>1e-8));if(i.some((({w:e})=>e<0)))continue;const r=Ei(i.map((({w:e,key:t})=>1===e?(0,Lt.UF)(["dyn",t]):(0,Lt.WV)(e,(0,Lt.UF)(["dyn",t])))));t=(0,Oi.uW)(t,(e=>e),(e=>"read"===e.operation&&e.path[1]===n[a]?r:e)),Di(e,n[a])}return{arts:e,nodes:t}}function Ri(e){const t=new Map,n=[];function a(e){const a=t.get(e);if(void 0!==a)return a;for(let a=0;a<n.length;a++)if((0,Lt.U$)(e,n[a]))return t.set(e,a),a;return n.push(e),t.set(e,n.length-1),n.length-1}let i=(0,Oi.Gd)(e,"_",((e,t,n)=>{const{operation:i}=e,r=e=>n(e,t);switch(i){case"add":return function(...e){return e.flat()}(...e.operands.map((e=>r(e))));case"mul":return function(...e){return(0,Xt.Og)(...e).map((e=>e.reduce(((e,t)=>(e.$k*=t.$k,e.terms.push(...t.terms),e)),{$k:1,terms:[]})))}(...e.operands.map((e=>r(e))));case"const":return[{$k:e.value,terms:[]}];default:return[{$k:1,terms:[a(e)]}]}}));return _i(i),i=Li(i),function(e,t=5){const n=e.atoms.map((e=>{const t={};if("threshold"===e.operation){const[n,a,,i]=e.operands;"read"===n.operation&&pe.Gt.includes(n.path[1])&&"const"===a.operation&&"const"===i.operation&&0===i.value&&(t[n.path[1]]=a.value)}return t}));return e.formulas=e.formulas.map((e=>e.filter((({terms:e})=>{const a=e.reduce(((e,t)=>(Object.entries(n[t]).forEach((([t,n])=>{var a;return e[t]=Math.max(n,null!=(a=e[t])?a:0)})),e)),{});return Object.values(a).reduce(((e,t)=>e+t),0)<=t})))),e}({formulas:i,atoms:n})}function _i(e){e.forEach((e=>{e.forEach((e=>e.terms.sort(((e,t)=>e-t)))),e.sort((({terms:e},{terms:t})=>{if(e.length!==t.length)return e.length-t.length;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return e[n]-t[n];return 0}))}))}function Li(e){return e.map((e=>{const t=[];let n;return e.forEach((({$k:e,terms:a})=>{n&&n.terms.length===a.length&&n.terms.every(((e,t)=>e===a[t]))?n.$k+=e:(n={$k:e,terms:a},t.push(n))})),t}))}var Gi=n(14613),$i=n(42652);function zi(e,t){const n=(0,Pi.IK)(t);return function(e,t){const n=(0,Gi.Zk)(e,t),{lower:a,upper:i,keys:r}=t,l=Object.fromEntries(r.map(((e,t)=>[e,{min:a[t],max:i[t]}])));return Ni(n,l).map((e=>({$c:e.$c,weights:r.map((t=>{var n;return null!=(n=e[t])?n:0}))})))}(e,Object.assign({},n,{keys:t.keys}))}function Ni(e,t){return e.map((e=>function(...e){const t={$c:0};for(const[a,i]of e)for(const[e,r]of Object.entries(i)){var n;t[e]=(null!=(n=t[e])?n:0)+a*r}return t}(...e.map((e=>{const n=e.terms.map((e=>t[e])),{w:a,$c:i}=function(e,t="upper"){if(0===e.length)return{w:[],$c:1,err:0};const n=e.length,a=e.map((({max:e})=>e)),i=a.reduce(((e,t)=>e*t),1);e=e.map((({min:e,max:t})=>({min:e/t,max:1})));const r=(0,Xt.Og)(...e.map((({min:e,max:t})=>[e,t]))).flatMap((e=>{const n=e.reduce(((e,t)=>e*t),1);let a;return"upper"===t?a=[[...e.map((e=>-e)),1,0,-n],[...e,-1,-1,n]]:"lower"===t?a=[[...e,-1,0,n],[...e.map((e=>-e)),1,-1,-n]]:(0,Xt.UT)(t),a})),l=[...e.map((e=>0)),0,1];try{const e=(0,$i.A)(l,r);return{w:e.slice(0,n).map(((e,t)=>e*i/a[t])),$c:-i*e[n],err:i*e[n+1]}}catch(t){throw console.log("ERROR on bounds",e),console.log("Possibly numerical instability issue."),console.log(t),t}}(n,e.$k>=0?"upper":"lower"),r={$c:i};return e.terms.forEach(((e,t)=>{var n;return r[e]=a[t]+(null!=(n=r[e])?n:0)})),[e.$k,r]})))))}class Vi extends kt{constructor(e,t,a){var i;super(Array(a).fill(NaN).map((e=>new Worker(new URL(n.p+n.u(64),n.b)))),["enumerate","split"],((e,t)=>{switch(e.resultType){case"interim":this.interim(e,t);break;case"finalize":this.finalizedResults.push(e);break;case"checkin":{this.commands.every((e=>0===e.length))&&t.postMessage({command:"share",splitsToAdd:a});const e=this.prio.get("enumerate"),n=Math.ceil(this.commands[e].length/a);(0,Xt.w6)(1,n).map((t=>this.commands[e].dequeue())).forEach((e=>{e.interrupt=!0,t.postMessage(e)})),t.postMessage({command:"resume"});break}}})),this.status=void 0,this.topN=void 0,this.buildValues=void 0,this.finalizedResults=[],this.initialProblem=void 0;const{topN:r}=e;this.status=t,this.topN=r,this.buildValues=Array(r).fill({w:void 0,val:-1/0});const{setupCommand:l,initialProblem:s}=this.preprocess(e);this.initialProblem=s,this.status.total=Object.values(null==(i=s.unionFilter[0])?void 0:i.filter).reduce(((e,t)=>e*t.length),1),this.notifiedBroadcast(l)}async solve(){return this.finalizedResults=[],await this.execute([{command:"split",maxIterateSize:4e4,subproblem:this.initialProblem}]),this.notifiedBroadcast({command:"finalize"}),await this.execute([]),this.finalizedResults}preprocess({plotBase:e,optimizationTarget:t,arts:n,topN:a,exclusion:i,constraints:r}){let l=[...(r=r.filter((e=>e.min>-1/0))).map((e=>e.value)),t];const s=[...r.map((e=>e.min)),-1/0];e&&(l.push(e),s.push(-1/0)),l=(0,wt.dk)(l,i),({nodes:l,arts:n}=(0,wt._B)(l,s,n,a,i,{reaffine:!0,pruneArtRange:!0,pruneNodeRange:!0,pruneOrder:!0})),l=(0,vt.tL)(l,{},(e=>!1)),l=function(e,t){return(0,Oi.uW)(e,(e=>e),(e=>{switch(e.operation){case"threshold":{const[n,a,i,r]=e.operands;if("read"===n.operation&&"const"===a.operation){const e=n.path[1];if(void 0===t[e])break;const l=t[e];if(2===a.value&&l.includes(2))return l.includes(4)?r:(0,Lt.Lj)(n,4,i,r);if(4===a.value&&l.includes(4))return r}return e}default:return e}return e}))}(l,i),l=function(e){return(0,Oi.uW)(e,(e=>e),(e=>{if("threshold"===e.operation){const[t,n,a,i]=e.operands;if("const"===t.operation&&"const"===n.operation)return t.value>=n.value?a:i;if("threshold"===t.operation&&"const"===n.operation){const[r,l,s,o]=t.operands;if("read"===r.operation&&"const"===l.operation&&"const"===s.operation&&"const"===o.operation){const t=s.value>=n.value?a:i,c=o.value>=n.value?a:i;return console.log("non-stacking buff",e,(0,Lt.Lj)(r,l,t,c)),(0,Lt.Lj)(r,l,t,c)}throw console.log("faulty node:",e),Error("Not Implemented: nested threshold must follow the form [read, const, const, const]")}if("const"!==a.operation||"const"!==i.operation){if("const"===i.operation&&0===i.value)return(0,Lt.WV)((0,Lt.Lj)(t,n,1,0),a);throw console.log("faulty node:",e),Error("Not Implemented: threshold() node with non-constant `pass` AND non-zero `fail`")}if("read"!==t.operation)throw console.log("faulty node:",e),Error("Not Implemented: threshold() node with non-read `branch`");return e}return e}))}(l),({nodes:l,arts:n}=Ti(n,l)),l=(0,vt.tL)(l,{},(e=>!1));const o=Ri(l),c=[s.length-1];e&&c.unshift(s.length-2);const d=(0,Xt.Uq)(Object.entries(i),(([e,t])=>"rainbow"===e?["uniqueKey",t.map((e=>e+1))]:[e,t.flatMap((e=>2===e?[2,3]:[4,5]))])),u=(0,Pi.s_)(n),h=zi(o,u);(0,Pi.uz)(u,h);const Z=(0,Xt.O)(pe.Ex,(e=>n.values[e].map(((e,t)=>t)))),p=Object.assign({filter:Z},(0,Pi.IK)(u));return{setupCommand:{command:"setup",arts:n,artsVec:u,targetIxs:c,topN:a,nodes:l,minimums:s,artSetExclusion:d},initialProblem:{cache:!0,depth:0,lin:h,targetIxs:c,formulas:o,unionFilter:[p],minimums:s,exclusion:d}}}interim(e,t){if(this.status.tested+=e.tested,this.status.failed+=e.failed,this.status.skipped+=e.skipped,e.buildValues){var n,a;const{topN:i}=this,r=null!=(n=this.buildValues[i-1].val)?n:-1/0;this.buildValues.push(...e.buildValues.map((e=>({w:t,val:e})))),this.buildValues.sort(((e,t)=>t.val-e.val)).splice(i);const l=null!=(a=this.buildValues[i-1].val)?a:-1/0;r!==l&&this.broadcast({command:"threshold",threshold:l})}}}let Wi,qi,Fi,Hi,Ui,Yi,Ji=e=>e;const Qi=new Audio("notification.mp3");function er(){var e,t;const{t:n}=(0,g.$G)("page_character_optimize"),{character:{key:a,compareData:i}}=(0,f.useContext)(S.K),{database:r}=(0,f.useContext)(E.t),{setChartData:s,graphBuilds:o,setGraphBuilds:c}=(0,f.useContext)(P),{gender:u}=(0,D.Z)(),[Z,p]=(0,f.useState)(!1),b=(0,f.useRef)(!1);(0,f.useEffect)((()=>{b.current=Z}),[Z]);const[x,w]=(0,f.useState)({type:"inactive",tested:0,failed:0,skipped:0,total:0}),k="inactive"!==x.type,[j,O]=(0,xt.Z)(),[{threads:K=gt.g},M]=(0,f.useState)(r.displayOptimize.get());(0,f.useEffect)((()=>r.displayOptimize.follow(((e,t)=>M(t)))),[r,M]);const T=K>gt.g?gt.g:K,R=(0,f.useCallback)((e=>r.displayOptimize.set({threads:e})),[r]),_=(0,A.Z)(a),L=(0,$.Z)();(0,f.useEffect)((()=>{w({type:"inactive",tested:0,failed:0,skipped:0,total:0})}),[a]);const G=(0,f.useMemo)((()=>!r.arts.values.length),[r]),{buildSetting:N,buildSettingDispatch:V}=Gt(a),{plotBase:W,optimizationTarget:q,mainStatAssumptionLevel:H,allowPartial:U,maxBuildsToShow:J,levelLow:Q,levelHigh:ee}=N,{buildResult:{builds:te,buildDate:ne},buildResultDispatch:ae}=fa(a),ie=(0,I.Z)(a,H),{characterSheet:re,target:le}=null!=(e=null==ie?void 0:ie[a])?e:{},se=q&&(0,Xt.Hm)(null==le?void 0:le.getDisplay(),q),oe=["xs","sm"].includes((0,yt.Z)()),[ce,de]=(0,f.useState)(!0);(0,f.useEffect)((()=>r.arts.followAny(O)),[O,r]);const Ze=(0,f.useDeferredValue)(j),me=(0,f.useDeferredValue)(N),{filteredArts:be,numEquippedUsed:ve}=(0,f.useMemo)((()=>{const{mainStatKeys:e,allowLocations:t,artExclusion:n,levelLow:i,levelHigh:l}=Ze&&me;let s=0;return{filteredArts:r.arts.values.filter((r=>{if(n.includes(r.id))return!1;if(r.level<i)return!1;if(r.level>l)return!1;const o=e[r.slotKey];if(null!=o&&o.length&&!o.includes(r.mainStatKey))return!1;const c=(0,pe.V7)(a);if(r.location&&r.location!==c){if(!t.includes(r.location))return!1;s++}return!0})),numEquippedUsed:s}}),[r,a,Ze,me]),xe=(0,f.useMemo)((()=>(0,Xt.O)(be.map((({id:e})=>e)),(e=>!0))),[be]),ye=(0,f.useMemo)((()=>{const{levelLow:e,levelHigh:t}=me;let n=0,a=0;return Object.entries(r.arts.data).forEach((([i,r])=>{r.level>=e&&r.level<=t&&(n++,xe[i]&&a++)})),`${a}/${n}`}),[me,xe,r]),we=(0,f.useRef)(!0);(0,f.useEffect)((()=>{const e=()=>we.current=!0,t=()=>we.current=!1;return window.addEventListener("focus",e),window.addEventListener("blur",t),()=>{window.removeEventListener("focus",e),window.removeEventListener("blur",t)}}),[we]);const Ce=(0,f.useRef)((()=>{}));(0,f.useEffect)((()=>()=>Ce.current()),[]);const[ke,Be]=(0,f.useState)(!1),Se=(0,f.useCallback)((async()=>{var e,t,i;const{artSetExclusion:l,plotBase:o,statFilters:c,optimizationTarget:d,mainStatAssumptionLevel:h,allowPartial:Z,maxBuildsToShow:p}=N;if(!a||!d)return;const m=function(e,t,n){const a={base:{},values:{flower:[],plume:[],goblet:[],circlet:[],sands:[]}},i=new Set;for(const n of e){const e=Xn.ZP.mainStatValue(n.mainStatKey,n.rarity,Math.max(Math.min(t,4*n.rarity),n.level)),r={id:n.id,set:n.setKey,values:Object.assign({[n.setKey]:1,[n.mainStatKey]:n.mainStatKey.endsWith("_")?e/100:e},Object.fromEntries(n.substats.map((e=>[e.key,e.key.endsWith("_")?e.accurateValue/100:e.accurateValue]))))};delete r.values[""],a.values[n.slotKey].push(r),Object.keys(r.values).forEach((e=>i.add(e)))}if(a.base=(0,Xt.O)([...i],(e=>0)),n)for(const e of Object.values(a.values))e.push({id:"",values:{}});return a}(be,h,Z),f=(0,I.V)(r,a,h,[]);if(!f)return;const g=null==(e=(0,bt.Qo)(f.teamData,u,a)[a])?void 0:e.target.data[0];if(!g)return;Object.assign(g,(0,bt.b3)([g,ji]));const v=(0,Xt.Hm)(null!=(t=g.display)?t:{},d);if(!v)return;const x=v,y=Object.entries(c).flatMap((([e,t])=>t.filter((e=>!e.disabled)).map((t=>{var n,a;const i=(0,Xt.Hm)(null!=(n=g.display)?n:{},JSON.parse(e));return{value:i,minimum:"%"===(null==(a=i.info)?void 0:a.unit)?t.value/100:t.value}})))).filter((e=>e.value&&e.minimum>-1/0));s(void 0);const C=new Promise((e=>Ce.current=e));Be(!1);const k=[...y.map((e=>e.value)),v],B=[...y.map((e=>e.minimum)),-1/0],S=o&&(0,Xt.Hm)(null!=(i=g.display)?i:{},o);S&&(k.push(S),B.push(-1/0));const X=(0,vt.tL)(k,g,(({path:[e]})=>"dyn"!==e)),j=S?X.pop():void 0,P={arts:m,optimizationTarget:X.pop(),exclusion:l,constraints:X.map(((e,t)=>({value:e,min:B[t]}))),topN:p,plotBase:j},O={tested:0,failed:0,skipped:0,total:0,startTime:performance.now()},E=setInterval((()=>w(Object.assign({type:"active"},O))),100),K=new Error;try{const e=ce?new Vi(P,O,T):new St(P,O,T);C.then((()=>e.cancel(K)));const t=await e.solve();if(e.cancel(),Ce.current=()=>{},S){var M,A;const e=(0,wt.s7)(t.map((e=>e.plotData)));let n=Object.values(e);"%"===(null==(M=x.info)?void 0:M.unit)&&(n=n.map((({value:e,plot:t,artifactIds:n})=>({value:100*e,plot:t,artifactIds:n})))),"%"===(null==(A=S.info)?void 0:A.unit)&&(n=n.map((({value:e,plot:t,artifactIds:n})=>({value:e,plot:100*(null!=t?t:0),artifactIds:n})))),s({valueNode:x,plotNode:S,data:n})}const a=(0,wt.he)(t.map((e=>e.builds)),p);0,ae({builds:a.map((e=>e.artifactIds)),buildDate:Date.now()}),setTimeout((()=>{t&&b.current&&(Qi.play(),we.current||setTimeout((()=>window.alert(n(Wi||(Wi=Ji`buildCompleted`)))),1))}),100)}catch(e){e!==K&&(console.log("Failed to load worker"),console.log(e),Be(!0)),Ce.current(),O.tested=0,O.failed=0,O.skipped=0,O.total=0}finally{clearInterval(E),w(Object.assign({type:"inactive"},O,{finishTime:performance.now()}))}}),[N,a,be,r,u,s,ce,T,ae,n]),Xe=null!=(t=null==re?void 0:re.name)?t:"Character Name",je=(0,f.useCallback)((e=>{V({plotBase:e}),s(void 0)}),[V,s]),Oe=(0,f.useMemo)((()=>le&&ie&&{data:le,teamData:ie}),[le,ie]),Ee=(0,z.tZ)(ga.Z,{optimizationTarget:q,setTarget:e=>V({optimizationTarget:e}),disabled:!!k}),Ke=(0,f.useCallback)((e=>(0,z.BX)(g.cC,{t:n,i18nKey:"graphBuildLabel",count:e+1,children:["Graph #",{count:e+1}]})),[n]),Me=(0,f.useCallback)((e=>`#${e+1}`),[]);return(0,z.BX)(d.Z,{display:"flex",flexDirection:"column",gap:1,children:[G&&(0,z.tZ)(he.Z,{severity:"warning",variant:"filled",children:(0,z.BX)(g.cC,{t:n,i18nKey:"noArtis",children:["Oops! It looks like you haven't added any artifacts to GO yet! You should go to the ",(0,z.tZ)(st.Z,{component:v.rU,to:"/artifacts",children:"Artifacts"})," page and add some!"]})}),Oe&&(0,z.BX)(X.R.Provider,{value:Oe,children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:(0,z.tZ)(d.Z,{children:(0,z.tZ)(ht.Z,{characterKey:a,onClickTeammate:L})})}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:4,display:"flex",flexDirection:"column",gap:1,children:[(0,z.BX)(y.Z,{children:[(0,z.tZ)(h.Z,{children:(0,z.BX)(d.Z,{display:"flex",alignItems:"center",gap:1,children:[(0,z.tZ)(un,{mainStatAssumptionLevel:H,setmainStatAssumptionLevel:e=>V({mainStatAssumptionLevel:e}),disabled:k}),(0,z.tZ)(pt.Z,{title:(0,z.BX)(d.Z,{children:[(0,z.tZ)(Y.Z,{variant:"h6",children:n(qi||(qi=Ji`mainStat.levelAssTooltip.title`))}),(0,z.tZ)(Y.Z,{children:n(Fi||(Fi=Ji`mainStat.levelAssTooltip.desc`))})]})})]})}),(0,z.tZ)(fi,{disabled:k,filteredArtIdMap:xe})]}),(0,z.tZ)(hn,{})]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:5,display:"flex",flexDirection:"column",gap:1,children:[(0,z.BX)(y.Z,{children:[(0,z.BX)(h.Z,{children:[n(Hi||(Hi=Ji`levelFilter`))," ",(0,z.tZ)(B.Z,{color:"info",children:ye})]}),(0,z.tZ)(dt.Z,{levelLow:Q,levelHigh:ee,setLow:e=>V({levelLow:e}),setHigh:e=>V({levelHigh:e}),setBoth:(e,t)=>V({levelLow:e,levelHigh:t}),disabled:k})]}),(0,z.tZ)(ln,{disabled:k}),(0,z.tZ)(Ua,{disabled:k}),(0,z.tZ)(m.Z,{fullWidth:!0,startIcon:U?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:U?"success":"secondary",onClick:()=>V({allowPartial:!U}),disabled:k,children:n(Ui||(Ui=Ji`allowPartial`))}),(0,z.tZ)(si,{disabled:k,numArtsEquippedUsed:ve}),(0,z.tZ)(wi,{disabled:k}),(0,z.tZ)(y.Z,{style:{backgroundColor:"red"},children:(0,z.tZ)(h.Z,{style:{backgroundColor:"red"},children:(0,z.tZ)(m.Z,{startIcon:ce?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:ce?"success":"secondary",onClick:()=>de(!ce),children:"Use Unstable Solver (Id appreciate bug reports)"})})})]})]}),oe&&Ee,(0,z.BX)(Pe.Z,{children:[!oe&&Ee,(0,z.BX)(Zt.Z,{disabled:k||!a,title:(0,z.BX)(g.cC,{t:n,i18nKey:"build",count:J,children:[{count:J}," Builds"]}),children:[(0,z.tZ)(ot.Z,{children:(0,z.tZ)(Y.Z,{variant:"caption",color:"info.main",children:n("buildDropdownDesc")})}),(0,z.tZ)(F.Z,{}),jt.s.map((e=>(0,z.tZ)(ot.Z,{onClick:()=>V({maxBuildsToShow:e}),children:(0,z.BX)(g.cC,{t:n,i18nKey:"build",count:e,children:[{count:e}," Builds"]})},e)))]}),(0,z.BX)(Zt.Z,{disabled:k||!a,sx:{borderRadius:"4px 0px 0px 4px"},title:(0,z.BX)(g.cC,{t:n,i18nKey:"thread",count:T,children:[{count:T}," Threads"]}),children:[(0,z.tZ)(ot.Z,{children:(0,z.tZ)(Y.Z,{variant:"caption",color:"info.main",children:n("threadDropdownDesc")})}),(0,z.tZ)(F.Z,{}),(0,Xt.w6)(1,gt.g).reverse().map((e=>(0,z.tZ)(ot.Z,{onClick:()=>R(e),children:(0,z.BX)(g.cC,{t:n,i18nKey:"thread",count:e,children:[{count:e}," Threads"]})},e)))]}),(0,z.tZ)(ut.Z,{placement:"top",title:n(Yi||(Yi=Ji`notifyTooltip`)),children:(0,z.tZ)(m.Z,{sx:{borderRadius:0},color:"warning",onClick:()=>p((e=>!e)),children:Z?(0,z.tZ)(rt.Z,{}):(0,z.tZ)(lt.Z,{})})}),(0,z.tZ)(ut.Z,{placement:"top",title:q?"":n("selectTargetFirst"),children:(0,z.tZ)("span",{children:(0,z.tZ)(m.Z,{disabled:!a||!q||!se||se.isEmpty,color:k?"error":"success",onClick:k?()=>Ce.current():Se,startIcon:k?(0,z.tZ)(at.Z,{}):(0,z.tZ)(l.Z,{}),sx:{borderRadius:"0px 4px 4px 0px"},children:n(k?"generateButton.cancel":"generateButton.generateBuilds")})})})]}),ke&&(0,z.tZ)(Bi,{}),!!a&&(0,z.tZ)(gn,{status:x,characterName:Xe,maxBuildsToShow:J}),(0,z.tZ)(d.Z,{children:(0,z.tZ)(Ma,{disabled:k||!q,plotBase:W,setPlotBase:je,showTooltip:!q})}),(0,z.tZ)(y.Z,{children:(0,z.BX)(h.Z,{children:[(0,z.BX)(d.Z,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:te?(0,z.BX)("span",{children:["Showing ",(0,z.tZ)("strong",{children:te.length+(o?o.length:0)})," build generated for ",Xe,". ",!!ne&&(0,z.BX)("span",{children:["Build generated on: ",(0,z.tZ)("strong",{children:new Date(ne).toLocaleString()})]})]}):(0,z.tZ)("span",{children:"Select a character to generate builds."})}),(0,z.tZ)(m.Z,{disabled:!te.length,color:"error",onClick:()=>{c(void 0),ae({builds:[],buildDate:0})},children:"Clear Builds"})]}),(0,z.BX)(ue.ZP,{container:!0,display:"flex",spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(C.Hn,{size:"small"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(C.oX,{size:"small"})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.BX)(mt.Z,{exclusive:!0,value:i,onChange:(e,t)=>_({compareData:t}),size:"small",children:[(0,z.tZ)(ct.Z,{value:!1,disabled:!i,children:"Show new builds"}),(0,z.tZ)(ct.Z,{value:!0,disabled:i,children:"Compare vs. equipped"})]})})]})]})}),(0,z.BX)(ft.Provider,{value:q,children:[o&&(0,z.tZ)(tr,{builds:o,characterKey:a,data:le,compareData:i,disabled:!!k,getLabel:Ke,setBuilds:c}),(0,z.tZ)(tr,{builds:te,characterKey:a,data:le,compareData:i,disabled:!!k,getLabel:Me})]})]})]})}function tr({builds:e,setBuilds:t,characterKey:n,data:a,compareData:i,disabled:r,getLabel:l}){const s=(0,f.useCallback)((n=>{if(t){const a=[...e];a.splice(n,1),t(a)}}),[e,t]);return(0,f.useMemo)((()=>(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:600}),children:null==e?void 0:e.map(((e,o)=>n&&a&&(0,z.tZ)(ar,{characterKey:n,build:e,oldData:a,children:(0,z.tZ)(nr,{index:o,label:l(o),build:e,compareData:i,disabled:r,deleteBuild:t?s:void 0})},o+e.join())))})),[e,n,a,i,r,l,s,t])}function nr({index:e,label:t,build:n,compareData:a,disabled:i,deleteBuild:r}){const{t:l}=(0,g.$G)("page_character_optimize"),o=(0,b.TH)(),c=(0,b.s0)(),d=(0,f.useCallback)((()=>{const e=o.pathname.split("/");e.pop(),c(`${e.join("/")}/theorycraft`,{state:{build:n}})}),[c,n,o.pathname]);return(0,z.tZ)(Qn,{label:t,compareBuild:a,disabled:i,extraButtonsLeft:(0,z.BX)(z.HY,{children:[(0,z.tZ)(m.Z,{color:"info",size:"small",startIcon:(0,z.tZ)(s.Z,{}),onClick:d,children:l("theorycraftButton")}),r&&(0,z.tZ)(m.Z,{color:"error",size:"small",startIcon:(0,z.tZ)(it.Z,{}),onClick:()=>r(e),children:l("removeBuildButton")})]})})}function ar({children:e,characterKey:t,build:n,oldData:a}){const{database:i}=(0,f.useContext)(E.t),{buildSetting:{mainStatAssumptionLevel:r}}=Gt(t),[l,s]=(0,xt.Z)();(0,f.useEffect)((()=>i.arts.followAny((e=>n.includes(e)&&s()))),[i,n,s]);const o=(0,f.useMemo)((()=>l&&n.map((e=>i.arts.get(e))).filter((e=>e))),[l,n,i]),c=(0,I.Z)(t,r,o),d=(0,f.useMemo)((()=>{const e=null==c?void 0:c[t];if(e)return{data:e.target,teamData:c,oldData:a}}),[c,a,t]);return d?(0,z.tZ)(X.R.Provider,{value:d,children:e}):null}const ir=n.p+"15731a768398a57e.png",rr=n.p+"0fed6a3afab0c533.jpg",lr=n.p+"61a5640f751600e1.png",sr=n.p+"ce51de36a8e43a46.jpg",or=n.p+"8d39035d9f8614cd.jpg",cr=n.p+"03950cac18f6da00.jpg",dr=n.p+"bff1d02a7fef0ed9.jpg",ur=n.p+"c23c84fd28ada02c.jpg",hr=n.p+"62bb1380c1e57b84.jpg",Zr=n.p+"f86213b0746bd99d.jpg",pr=n.p+"afffd1f2dc02443e.jpg",mr=n.p+"cdb521f6a838e658.jpg",fr=n.p+"ce3a69ee38d58729.jpg",gr=n.p+"b0362ff4125a96d8.jpg",br=n.p+"dff0cc8f4764d2f3.png",vr=n.p+"2befecc0c8c94a76.jpg",xr=n.p+"5026e1c4ba0cb717.png",yr=n.p+"b27e5b74d0c7c191.jpg",wr=n.p+"894754f456931c37.jpg",Cr=n.p+"830426ef046d7898.png",kr=n.p+"56e9a3ed2b3be54e.jpg",Br=n.p+"6ed95b88664afc8e.jpg",Sr=n.p+"756ca7526e578133.jpg",Xr=n.p+"045cbd1ba67661b8.jpg",jr=n.p+"344da155ff4c5613.png",Pr=n.p+"7db731763e0df4dc.png",Or=n.p+"7f982d3ef2ddf9d9.png",Er=n.p+"2eb0ba92488c98b7.jpg",Kr=n.p+"260308d190782c6f.jpg",Mr=n.p+"bfaa8d9850b1f2ec.jpg",Ar=n.p+"7b83f3d4ce23cd76.jpg",Dr=n.p+"b27d8af3c869a1a0.jpeg",Ir=n.p+"5837a1c676f3b4d7.jpg",Tr=n.p+"02739935c8cfb7bb.jpg",Rr=n.p+"039230426b6241f2.jpeg",_r=n.p+"5397f2a3bbb43d1b.jpg",Lr=n.p+"9290b22752cf79dc.jpg",Gr=n.p+"42e700d9b6d504d4.jpg",$r=n.p+"17e62e2453f554a2.jpg",zr=n.p+"8f0d15486e1be7ba.png",Nr=n.p+"7116f607f2362463.jpg",Vr=n.p+"00dcb0e6012dac62.png",Wr=n.p+"ab2ebc668cf83833.jpg",qr=n.p+"6c8e2c7a860a418d.png",Fr=n.p+"088c2740c3fe8bf8.jpg",Hr=n.p+"ce1932b7ece6c6df.png",Ur=n.p+"564bdccbb6ac20f9.jpg",Yr=n.p+"bb8785c8713ea800.png",Jr=n.p+"251b9f48307a4f3e.jpg",Qr=n.p+"71221c1c02aa0661.jpg",el=n.p+"3cfba9c31ee32640.jpg",tl=n.p+"1a9914f68115ede0.jpg",nl=n.p+"f3a9d7d3de0a0130.jpg",al=n.p+"3b87be8b38a43f4e.jpg",il=n.p+"1b6e0a76cd1eccb5.jpg",rl=n.p+"c156614a2e2fed0b.jpg",ll=n.p+"34a60135c4d82e74.png",sl=n.p+"67678cb6b96761c8.png",ol=n.p+"6478b1dbbf4f06c4.jpg",cl=n.p+"67298f967451eb85.jpg",dl=n.p+"438d1ff1bb2ea9e1.png",ul=n.p+"ea43f4d145785ce6.jpg",hl=n.p+"717bda16cbde243f.png",Zl={Albedo:ir,Alhaitham:rr,Aloy:lr,Amber:sr,AratakiItto:or,Barbara:cr,Beidou:dr,Bennett:ur,Candace:hr,Chongyun:Zr,Collei:pr,Cyno:mr,Dehya:fr,Diluc:gr,Diona:br,Dori:vr,Eula:xr,Faruzan:yr,Fischl:wr,Ganyu:Cr,Gorou:kr,HuTao:Br,Jean:Sr,KaedeharaKazuha:Or,Kaeya:Xr,KamisatoAyaka:jr,KamisatoAyato:Pr,Keqing:Er,Klee:Kr,KujouSara:Mr,KukiShinobu:Ar,Layla:Dr,Lisa:Ir,Mona:Tr,Nahida:Rr,Nilou:_r,Ningguang:Lr,Noelle:Gr,Qiqi:$r,RaidenShogun:zr,Razor:Nr,Rosaria:Vr,SangonomiyaKokomi:Wr,Sayu:qr,Shenhe:Fr,ShikanoinHeizou:Hr,Sucrose:Ur,Tartaglia:Yr,Thoma:Jr,Tighnari:Qr,TravelerF:n.p+"36f4033351c727ee.jpg",TravelerM:n.p+"19ab4b10d5dc0e38.jpg",Venti:el,Wanderer:tl,Xiangling:nl,Xiao:al,Xingqiu:il,Xinyan:rl,YaeMiko:ll,Yanfei:sl,Yaoyao:ol,Yelan:cl,Yoimiya:dl,YunJin:ul,Zhongli:hl};function pl(e,t){var n,a;switch(e){case"TravelerAnemo":case"TravelerDendro":case"TravelerElectro":case"TravelerGeo":return null!=(n=Zl[`Traveler${t}`])?n:"";default:return null!=(a=Zl[e])?a:""}}var ml=n(16068),fl=n(66147),gl=n(63303),bl=n(71765),vl=n(21626),xl=n(32560),yl=n(85469),wl=n(49810),Cl=n(86432),kl=n(23883),Bl=n(12121),Sl=n(45220),Xl=n(3694),jl=n(29687);let Pl,Ol=e=>e;function El({artId:e,weaponId:t}){const{t:n}=(0,g.$G)("page_character"),[a,i,r]=(0,K.Z)(!1);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(ae.Z,{open:a,onClose:r,containerProps:{maxWidth:"xl"},children:(0,z.tZ)(Kl,{artId:e,weaponId:t,onHide:r})}),(0,z.tZ)(kl.Z,{title:(0,z.tZ)(Y.Z,{children:n(Pl||(Pl=Ol`tabEquip.compare`))}),placement:"top",arrow:!0,children:(0,z.tZ)(m.Z,{color:"info",size:"small",onClick:i,children:(0,z.tZ)(jl.Z,{})})})]})}function Kl({artId:e,weaponId:t,onHide:n}){const{database:a}=(0,f.useContext)(E.t),{character:{key:i,equippedArtifacts:r}}=(0,f.useContext)(S.K),{buildSetting:{mainStatAssumptionLevel:l}}=Gt(i),{data:s}=(0,f.useContext)(X.R),o=(0,f.useMemo)((()=>{const t=a.arts.get(null!=e?e:""),n=(0,Xt.xh)(r,((e,n)=>n===(null==t?void 0:t.slotKey)?t:a.arts.get(e)));return Object.values(n).filter((e=>e))}),[a,r,e]),c=(0,I.Z)(i,l,o,t?a.weapons.get(t):void 0),d=(0,f.useMemo)((()=>c&&{data:c[i].target,teamData:c,oldData:s}),[i,c,s]);return(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:600}),children:d&&(0,z.tZ)(X.R.Provider,{value:d,children:(0,z.tZ)(Qn,{compareBuild:!0,extraButtonsLeft:(0,z.BX)(z.HY,{children:[(0,z.tZ)(C.Hn,{size:"small"}),(0,z.tZ)(C.oX,{size:"small"})]}),extraButtonsRight:(0,z.tZ)(m.Z,{size:"small",color:"error",onClick:n,children:(0,z.tZ)(at.Z,{})})})})})}let Ml,Al=e=>e;const Dl={xs:6,sm:6,md:9,lg:12,xl:12},Il=(0,f.lazy)((()=>Promise.resolve().then(n.bind(n,19157))));function Tl({onChangeId:e,slotKey:t,show:n,onClose:a}){const{t:i}=(0,g.$G)("page_character"),{database:r}=(0,f.useContext)(E.t),l=(0,f.useCallback)((t=>{e(t),a()}),[e,a]),s=(0,f.useCallback)(((e,n)=>Object.assign({},e,n,{slotKeys:[t]})),[t]),[o,c]=(0,f.useReducer)(s,Object.assign({},(0,$a.Af)(),{slotKeys:[t]})),[Z,p]=(0,xt.Z)();(0,f.useEffect)((()=>r.arts.followAny(p)),[r,p]);const m=(0,yt.Z)(),b=(0,f.useMemo)((()=>(0,$a.EM)()),[]),v=(0,f.useMemo)((()=>{const e=(0,za.C)(o,b);return Z&&r.arts.values.filter(e).map((e=>e.id)).slice(0,Dl[m])}),[Z,r,b,o,m]);return(0,z.tZ)(ae.Z,{open:n,onClose:a,containerProps:{maxWidth:"xl"},children:(0,z.BX)(x.Z,{children:[(0,z.BX)(h.Z,{sx:{py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.BX)(Y.Z,{variant:"h6",children:[t?(0,z.tZ)(ne.Z,{src:Sn.Z.slot[t]}):null," ",i(Ml||(Ml=Al`tabEquip.swapArt`))]}),(0,z.tZ)(w.Z,{onClick:a})]}),(0,z.tZ)(F.Z,{}),(0,z.BX)(h.Z,{children:[(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.tZ)(Il,{filterOption:o,filterOptionDispatch:c,filteredIds:v,disableSlotFilter:!0})}),(0,z.tZ)(d.Z,{mt:1,children:(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:300}),children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:v.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Wn.Z,{artifactId:e,extraButtons:(0,z.tZ)(El,{artId:e}),onClick:l})},e)))})})})]})]})})}var Rl=n(92252),_l=n(13780),Ll=n(89431),Gl=n(15878),$l=n(77712),zl=n(64120);let Nl,Vl=e=>e;const Wl=(0,Zi.X)([...pe.U1]);function ql({onChangeId:e,weaponTypeKey:t,show:n,onClose:a}){const{t:i}=(0,g.$G)(["page_character","page_weapon","weaponNames_gen"]),{database:r}=(0,f.useContext)(E.t),[l,s]=(0,f.useState)(!1),o=(0,f.useCallback)((t=>{e(t),a()}),[e,a]),[c,u]=(0,f.useState)(""),Z=(0,f.useCallback)((e=>{u(r.weapons.new((0,zl.xg)(e)))}),[r,u]),p=(0,f.useCallback)((()=>u("")),[]),[b,v]=(0,xt.Z)();(0,f.useEffect)((()=>r.weapons.followAny(v)),[v,r]);const[y,C]=(0,f.useState)([5,4,3]),[k,B]=(0,f.useState)(""),S=(0,f.useDeferredValue)(k),X=(0,f.useMemo)((()=>{var e,n;return null!=(e=b&&r.weapons.values.filter((0,za.C)({weaponType:t,rarity:y,name:S},(0,$l.Xg)())).sort((0,za.e)(null!=(n=$l.gd.level)?n:[],!1,(0,$l.Sn)())).map((e=>e.id)))?e:[]}),[b,r,y,t,S]);return(0,z.tZ)(ae.Z,{open:n,onClose:a,children:(0,z.BX)(x.Z,{children:[(0,z.tZ)(f.Suspense,{fallback:!1,children:(0,z.tZ)(Ll.default,{show:l,onHide:()=>s(!1),onSelect:Z,weaponTypeFilter:t})}),(0,z.tZ)(f.Suspense,{fallback:!1,children:(0,z.tZ)(Gl.default,{weaponId:c,footer:!0,onClose:p})}),(0,z.tZ)(h.Z,{sx:{py:1},children:(0,z.BX)(ue.ZP,{container:!0,children:[(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.BX)(Y.Z,{variant:"h6",children:[t?(0,z.tZ)(ne.Z,{src:Sn.Z.weaponTypes[t]}):null," ",i(Nl||(Nl=Vl`page_character:tabEquip.swapWeapon`))]})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(w.Z,{onClick:a})})]})}),(0,z.tZ)(F.Z,{}),(0,z.BX)(h.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(mt.Z,{sx:{height:"100%"},value:y,size:"small",children:pe.U1.map((e=>(0,z.tZ)(ct.Z,{value:e,onClick:()=>C(Wl(y,e)),children:(0,z.BX)(d.Z,{display:"flex",children:[(0,z.tZ)("strong",{children:e}),(0,z.tZ)(Kt.Z,{})]})},e)))})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(_l.Z,{autoFocus:!0,size:"small",value:k,onChange:e=>B(e.target.value),label:i("page_weapon:weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),(0,z.tZ)(m.Z,{fullWidth:!0,onClick:()=>s(!0),color:"info",startIcon:(0,z.tZ)(Rl.Z,{}),children:i("page_weapon:addWeapon")}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:X.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:6,sm:6,md:4,lg:3,children:(0,z.tZ)(Xl.Z,{weaponId:e,onClick:o,extraButtons:(0,z.tZ)(El,{weaponId:e})})},e)))})]})]})})}let Fl,Hl,Ul,Yl,Jl,Ql,es,ts=e=>e;const ns=(0,f.lazy)((()=>Promise.resolve().then(n.bind(n,15878))));function as(){var e;const{character:{equippedWeapon:t,key:n},characterSheet:a}=(0,f.useContext)(S.K),{teamData:i,data:r}=(0,f.useContext)(X.R),l=null==(e=i[n])?void 0:e.weaponSheet,[s,o]=(0,f.useState)(""),c=(0,f.useCallback)((()=>o(t)),[t]),u=(0,f.useCallback)((()=>o("")),[]);(0,f.useEffect)((()=>{s&&s!==t&&o(t)}),[s,t]);const h=(0,kn.Z)(),Z=(0,Cl.Z)(h.breakpoints.up("lg")),p=(0,f.useMemo)((()=>l&&l.document.length>0&&(0,z.tZ)(y.Z,{children:(0,z.tZ)(d.Z,{p:1,children:(0,z.tZ)(At.Z,{sections:l.document})})})),[l]),{rvFilter:m}=(0,xl.Z)(n),g=(0,f.useDeferredValue)(m),b=(0,f.useMemo)((()=>new Set(g)),[g]);return(0,z.BX)(d.Z,{children:[(0,z.tZ)(f.Suspense,{fallback:!1,children:(0,z.tZ)(ns,{weaponId:s,footer:!0,onClose:u,extraButtons:(0,z.tZ)(ls,{weaponTypeKey:a.weaponTypeKey})})}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[Z&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:3,xl:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[p&&p,(0,z.tZ)(os,{})]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:9,xl:9,container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,sm:6,md:4,display:"flex",flexDirection:"column",gap:1,children:(0,z.tZ)(Xl.Z,{weaponId:t,onEdit:c,canEquip:!0,extraButtons:(0,z.tZ)(rs,{weaponTypeKey:a.weaponTypeKey})})}),pe.Ex.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:12,sm:6,md:4,children:r.get(xe.ri.art[e].id).value?(0,z.tZ)(Wn.Z,{artifactId:r.get(xe.ri.art[e].id).value,effFilter:b,extraButtons:(0,z.tZ)(ss,{slotKey:e}),editorProps:{},canEquip:!0}):(0,z.tZ)(is,{slotKey:e})},e)))]}),!Z&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,xl:3,container:!0,spacing:1,children:[p&&(0,z.tZ)(ue.ZP,{item:!0,xs:12,md:6,lg:4,children:p}),(0,z.tZ)(ue.ZP,{item:!0,xs:12,md:6,lg:4,sx:{display:"flex",flexDirection:"column",gap:1},children:(0,z.tZ)(os,{})})]})]})]})}function is({slotKey:e}){const{character:{key:t}}=(0,f.useContext)(S.K),{database:n}=(0,f.useContext)(E.t),[a,i,r]=(0,K.Z)(),{t:l}=(0,g.$G)("artifact");return(0,z.BX)(y.Z,{sx:{height:"100%",width:"100%",minHeight:300,display:"flex",flexDirection:"column"},children:[(0,z.tZ)(h.Z,{children:(0,z.BX)(Y.Z,{children:[(0,z.tZ)(It.Z,{iconProps:Ce.m,slotKey:e})," ",l(`slotName.${e}`)]})}),(0,z.tZ)(F.Z,{}),(0,z.BX)(d.Z,{sx:{flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,z.tZ)(Tl,{slotKey:e,show:a,onClose:r,onChangeId:e=>n.arts.set(e,{location:(0,R.V7)(t)})}),(0,z.tZ)(m.Z,{onClick:i,color:"info",sx:{borderRadius:"1em"},children:(0,z.tZ)(yl.Z,{sx:{height:100,width:100}})})]})]})}function rs({weaponTypeKey:e}){const{t}=(0,g.$G)("page_character"),{character:{key:n}}=(0,f.useContext)(S.K),{database:a}=(0,f.useContext)(E.t),[i,r,l]=(0,K.Z)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(kl.Z,{title:(0,z.tZ)(Y.Z,{children:t(Fl||(Fl=ts`tabEquip.swapWeapon`))}),placement:"top",arrow:!0,children:(0,z.tZ)(m.Z,{color:"info",size:"small",onClick:r,children:(0,z.tZ)(yl.Z,{})})}),(0,z.tZ)(ql,{weaponTypeKey:e,onChangeId:e=>a.weapons.set(e,{location:(0,R.V7)(n)}),show:i,onClose:l})]})}function ls({weaponTypeKey:e}){const{t}=(0,g.$G)("page_character"),{character:{key:n}}=(0,f.useContext)(S.K),{database:a}=(0,f.useContext)(E.t),[i,r,l]=(0,K.Z)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(m.Z,{color:"info",onClick:r,startIcon:(0,z.tZ)(yl.Z,{}),children:t(Hl||(Hl=ts`tabEquip.swapWeapon`))}),(0,z.tZ)(ql,{weaponTypeKey:e,onChangeId:e=>a.weapons.set(e,{location:(0,R.V7)(n)}),show:i,onClose:l})]})}function ss({slotKey:e}){const{t}=(0,g.$G)("page_character"),{character:{key:n}}=(0,f.useContext)(S.K),{database:a}=(0,f.useContext)(E.t),[i,r,l]=(0,K.Z)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(kl.Z,{title:(0,z.tZ)(Y.Z,{children:t(Ul||(Ul=ts`tabEquip.swapArt`))}),placement:"top",arrow:!0,children:(0,z.tZ)(m.Z,{color:"info",size:"small",onClick:r,children:(0,z.tZ)(yl.Z,{})})}),(0,z.tZ)(Tl,{slotKey:e,show:i,onClose:l,onChangeId:e=>a.arts.set(e,{location:(0,R.V7)(n)})})]})}function os(){const{t:e}=(0,g.$G)(["page_character","artifact"]),{database:t}=(0,f.useContext)(E.t),{character:n,character:{key:a,equippedArtifacts:i}}=(0,f.useContext)(S.K),{data:r}=(0,f.useContext)(X.R),l=(0,f.useMemo)((()=>!!Object.values(i).filter((e=>e)).length),[i]),s=(0,f.useCallback)((()=>{n&&window.confirm("Do you want to move all currently equipped artifacts to inventory?")&&Object.values(i).forEach((e=>t.arts.set(e,{location:""})))}),[n,t,i]),o=(0,f.useMemo)((()=>(0,Mt.ND)(r)),[r]),{rvFilter:c}=(0,xl.Z)(a),u=(0,f.useCallback)((e=>t.charMeta.set(a,{rvFilter:e})),[t,a]),[Z,p,b]=(0,K.Z)(),v=(0,f.useDeferredValue)(c),{rvField:w,rvmField:C}=(0,f.useMemo)((()=>{const{currentEfficiency:n,currentEfficiency_:a,maxEfficiency:r,maxEfficiency_:l}=Object.values(i).reduce(((e,n)=>{const a=t.arts.get(n);if(a){const{currentEfficiency:t,maxEfficiency:n}=Xn.ZP.getArtifactEfficiency(a,new Set(v)),{currentEfficiency:i,maxEfficiency:r}=Xn.ZP.getArtifactEfficiency(a,new Set(Si._m));e.currentEfficiency=e.currentEfficiency+t,e.maxEfficiency=e.maxEfficiency+n,e.currentEfficiency_=e.currentEfficiency_+i,e.maxEfficiency_=e.maxEfficiency_+r}return e}),{currentEfficiency:0,currentEfficiency_:0,maxEfficiency:0,maxEfficiency_:0});return{rvField:{text:e(Yl||(Yl=ts`artifact:editor.curSubEff`)),value:n-a?(0,z.BX)("span",{children:[(0,z.tZ)(Sl.Z,{value:n,max:4500,valid:!0})," / ",(0,z.tZ)(Sl.Z,{value:a,max:4500,valid:!0})]}):(0,z.tZ)(Sl.Z,{value:n,max:4500,valid:!0})},rvmField:{text:e(Jl||(Jl=ts`artifact:editor.maxSubEff`)),canShow:()=>!!(a-l),value:r-l?(0,z.BX)("span",{children:[(0,z.tZ)(Sl.Z,{value:r,max:4500,valid:!0})," / ",(0,z.tZ)(Sl.Z,{value:l,max:4500,valid:!0})]}):(0,z.tZ)(Sl.Z,{value:r,max:4500,valid:!0})}}}),[e,v,i,t]);return(0,z.BX)(y.Z,{children:[l&&(0,z.tZ)(m.Z,{color:"error",onClick:s,fullWidth:!0,sx:{borderBottomRightRadius:0,borderBottomLeftRadius:0},children:e(Ql||(Ql=ts`tabEquip.unequipArts`))}),(0,z.tZ)(d.Z,{p:1,children:(0,z.BX)(de.Z,{spacing:1,children:[(0,z.BX)(x.Z,{children:[(0,z.tZ)(m.Z,{fullWidth:!0,color:"info",startIcon:(0,z.tZ)(wl.Z,{}),sx:{borderBottomLeftRadius:0,borderBottomRightRadius:0},onClick:p,children:"RV Filter"}),(0,z.tZ)(ae.Z,{open:Z,onClose:b,children:(0,z.tZ)(x.Z,{children:(0,z.BX)(h.Z,{children:[(0,z.tZ)(Y.Z,{textAlign:"center",gutterBottom:!0,variant:"h6",children:e(es||(es=ts`artifact:efficiencyFilter.title`))}),(0,z.tZ)(Bl.Z,{selectedKeys:c,onChange:u})]})})}),(0,z.BX)(Le.lD,{children:[(0,z.tZ)(Le.ms,{field:w,component:Ze.ZP}),(null==C||null==C.canShow?void 0:C.canShow(r))&&(0,z.tZ)(Le.ms,{field:C,component:Ze.ZP})]})]}),o&&Object.entries(o).flatMap((([e,t])=>t.map((t=>(0,z.tZ)(x.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:(0,z.tZ)(Dt,{setKey:e,setNumKey:t},e+t)},e+t)))))]})})]})}function cs(){const e=(0,f.useRef)(),t=(0,f.useCallback)((()=>{var t;return null==e||null==(t=e.current)||null==t.scrollIntoView?void 0:t.scrollIntoView({behavior:"smooth"})}),[e]);return(0,z.BX)(de.Z,{spacing:1,children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,z.tZ)(ue.ZP,{item:!0,xs:8,sm:5,md:4,lg:2.3,children:(0,z.tZ)(us,{})}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:7,md:8,lg:9.7,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(ds,{onClick:t}),(0,z.tZ)(y.Z,{sx:{flexGrow:1,p:1},children:(0,z.tZ)(Rn,{})})]})]}),(0,z.tZ)(d.Z,{ref:e,children:(0,z.tZ)(as,{})})]})}function ds({onClick:e}){const{character:{equippedWeapon:t}}=(0,f.useContext)(S.K),{data:n}=(0,f.useContext)(X.R);return(0,z.BX)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,sm:2,md:3,lg:6,xl:6},children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Nn,{weaponId:t,BGComponent:y.Z,onClick:e})}),pe.Ex.map((t=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Dn,{artifactId:n.get(xe.ri.art[t].id).value,slotKey:t,BGComponent:y.Z,onClick:e})},t)))]})}function us(){var e;const{database:t}=(0,f.useContext)(E.t),{characterSheet:n,character:{key:a,team:i}}=(0,f.useContext)(S.K),{gender:r}=(0,D.Z)(),{data:l}=(0,f.useContext)(X.R),s=(0,A.Z)(a),o=(0,b.s0)(),c=l.get(xe.ri.charEle).value,u=n.weaponTypeKey,h=l.get(xe.ri.lvl).value,Z=l.get(xe.ri.asc).value,p=l.get(xe.ri.constellation).value,m={auto:l.get(xe.ri.total.auto).value,skill:l.get(xe.ri.total.skill).value,burst:l.get(xe.ri.total.burst).value},g={auto:l.get(xe.ri.total.autoBoost).value,skill:l.get(xe.ri.total.skillBoost).value,burst:l.get(xe.ri.total.burstBoost).value},{favorite:v}=(0,xl.Z)(a);return(0,z.BX)(y.Z,{sx:{height:"100%"},children:[(0,z.BX)(d.Z,{sx:{position:"relative"},children:[(0,z.BX)(d.Z,{sx:{position:"absolute",width:"100%",height:"100%"},children:[(0,z.tZ)(Y.Z,{variant:"h6",sx:{position:"absolute",width:"100%",left:"50%",bottom:0,transform:"translate(-50%, -50%)",opacity:.75,textAlign:"center"},children:(0,z.tZ)(bl.q,{stars:n.rarity,colored:!0})}),(0,z.tZ)(d.Z,{sx:{position:"absolute",left:"50%",bottom:"7%",transform:"translate(-50%, -50%)",opacity:.85,width:"100%",display:"flex",justifyContent:"center",px:1},children:(0,z.tZ)(be.Z,{color:c,sx:{height:"auto"},label:(0,z.BX)(Y.Z,{variant:"h6",sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,z.tZ)(we.Z,{ele:c}),(0,z.tZ)(d.Z,{sx:{whiteSpace:"normal",textAlign:"center"},children:n.name}),(0,z.tZ)(ne.Z,{src:null==(e=Sn.Z.weaponTypes)?void 0:e[u]})]})})}),(0,z.tZ)(d.Z,{sx:{position:"absolute",left:0,top:0},children:(0,z.tZ)(Se.Z,{sx:{p:1},color:"error",onClick:()=>t.charMeta.set(a,{favorite:!v}),children:v?(0,z.tZ)(ml.Z,{}):(0,z.tZ)(fl.Z,{})})}),(0,z.tZ)(Y.Z,{sx:{p:1,position:"absolute",right:0,top:0,opacity:.8},children:(0,z.tZ)(B.Z,{children:(0,vl.wQ)(h,Z)})})]}),(0,z.tZ)(d.Z,{src:pl(a,r),component:"img",width:"100%",height:"auto"})]}),(0,z.BX)(d.Z,{children:[(0,z.tZ)(Cn.Z,{sx:{p:1},onClick:()=>o("talent"),children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,mt:-1,children:["auto","skill","burst"].map((e=>{var t;return(0,z.tZ)(ue.ZP,{item:!0,xs:4,children:(0,z.tZ)(gl.Z,{badgeContent:m[e],color:g[e]?"info":"secondary",overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},sx:{width:"100%",height:"100%","& > .MuiBadge-badge":{fontSize:"1.25em",padding:".25em .4em",borderRadius:".5em",lineHeight:1,height:"1.25em"}},children:(0,z.tZ)(d.Z,{component:"img",src:null==(t=n.getTalentOfKey(e))?void 0:t.img,width:"100%",height:"auto"})})},e)}))})}),(0,z.tZ)(Y.Z,{sx:{textAlign:"center",mt:1},variant:"h6",children:n.constellationName}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:(0,Xt.w6)(1,6).map((e=>{var t;return(0,z.tZ)(ue.ZP,{item:!0,xs:4,children:(0,z.tZ)(Cn.Z,{onClick:()=>s({constellation:e===p?e-1:e}),children:(0,z.tZ)(d.Z,{component:"img",src:null==(t=n.getTalentOfKey(`constellation${e}`))?void 0:t.img,sx:Object.assign({},p>=e?{}:{filter:"brightness(50%)"}),width:"100%",height:"auto"})})},e)}))}),(0,z.tZ)(Cn.Z,{sx:{p:1},onClick:()=>o("teambuffs"),children:(0,z.tZ)(ue.ZP,{container:!0,columns:3,spacing:1,children:(0,Xt.w6)(0,2).map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,height:"100%",children:i[e]?(0,z.tZ)(ti.Z,{characterKey:i[e]}):(0,z.tZ)(ti.D,{index:e})},e)))})})]})]})}const hs={xs:12,sm:6,md:4};function Zs(){const{character:e,characterSheet:t}=(0,f.useContext)(S.K),{data:n}=(0,f.useContext)(X.R),a=(0,A.Z)(e.key),i=n.get(xe.ri.asc).value,r=n.get(xe.ri.constellation).value,l=(0,kn.Z)(),s=(0,Cl.Z)(l.breakpoints.up("lg")),o=(0,f.useMemo)((()=>(0,Xt.w6)(1,6).map((e=>(0,z.tZ)(fs,{talentKey:`constellation${e}`,subtitle:`Constellation Lv. ${e}`,onClickTitle:()=>a({constellation:e===r?e-1:e})})))),[r,a]);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(ps,{}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[s&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(y.Z,{children:(0,z.tZ)(h.Z,{children:(0,z.BX)(Y.Z,{variant:"h6",sx:{textAlign:"center"},children:["Constellation Lv. ",r]})})}),o.map(((e,t)=>(0,z.tZ)(d.Z,{sx:{opacity:r>=t+1?1:.5},children:e},t)))]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:[[["auto","Normal/Charged Attack"],["skill","Elemental Skill"],["burst","Elemental Burst"]].map((([e,t])=>(0,z.tZ)(ue.ZP,Object.assign({item:!0},hs,{children:(0,z.tZ)(fs,{talentKey:e,subtitle:t})}),e))),!!t.getTalentOfKey("sprint")&&(0,z.tZ)(ue.ZP,Object.assign({item:!0},hs,{children:(0,z.tZ)(fs,{talentKey:"sprint",subtitle:"Alternative Sprint"})})),!!t.getTalentOfKey("passive")&&(0,z.tZ)(ue.ZP,Object.assign({item:!0},hs,{children:(0,z.tZ)(fs,{talentKey:"passive",subtitle:"Passive"})})),[["passive1","Unlocked at Ascension 1",1],["passive2","Unlocked at Ascension 4",4],["passive3","Unlocked by Default",0]].map((([e,n,a])=>{const r=i>=a;return t.getTalentOfKey(e)?(0,z.tZ)(ue.ZP,Object.assign({item:!0,style:{opacity:r?1:.5}},hs,{children:(0,z.tZ)(fs,{talentKey:e,subtitle:n})}),e):null}))]}),!s&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)(y.Z,{children:(0,z.tZ)(h.Z,{children:(0,z.BX)(Y.Z,{variant:"h6",sx:{textAlign:"center"},children:["Constellation Lv. ",r]})})})}),o.map(((e,t)=>(0,z.tZ)(ue.ZP,Object.assign({item:!0,sx:{opacity:r>=t+1?1:.5}},hs,{children:e}),t)))]})]})]})}function ps(){const{data:e}=(0,f.useContext)(X.R),t=e.getDisplay().reaction;return(0,z.tZ)(y.Z,{children:(0,z.tZ)(h.Z,{children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:Object.entries(t).filter((([e,t])=>!t.isEmpty)).map((([e,t])=>(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(x.Z,{children:(0,z.tZ)(h.Z,{sx:{p:1,"&:last-child":{pb:1}},children:(0,z.tZ)(Le.JW,{node:t})})})},e)))})})})}const ms=[1,1,2,4,6,8,10];function fs({talentKey:e,subtitle:t,onClickTitle:n}){const{character:{talent:a},characterSheet:i,characterDispatch:r}=(0,f.useContext)(S.K),{data:l}=(0,f.useContext)(X.R),s=(0,f.useCallback)((e=>(0,z.tZ)(Cn.Z,{onClick:n,children:e})),[n]),o=(0,f.useCallback)(((e,t)=>r({talent:Object.assign({},a,{[e]:t})})),[a,r]);let c=null;if(e in a){const t=l.get(xe.ri.total[`${e}Boost`]).value,n=l.get(xe.ri.total[e]).value,i=l.get(xe.ri.asc).value;c=(0,z.tZ)(Zt.Z,{fullWidth:!0,title:`Talent Lv. ${n}`,color:t?"info":"primary",sx:{borderRadius:0},children:(0,Xt.w6)(1,ms[i]).map((n=>(0,z.BX)(ot.Z,{selected:a[e]===n,disabled:a[e]===n,onClick:()=>o(e,n),children:["Talent Lv. ",n+t]},n)))})}const u=i.getTalentOfKey(e);return(0,z.BX)(y.Z,{sx:{height:"100%"},children:[c,(0,z.BX)(h.Z,{children:[(0,z.tZ)(En.Z,{condition:!!n,wrapper:s,children:(0,z.BX)(ue.ZP,{container:!0,sx:{flexWrap:"nowrap"},children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(d.Z,{component:"img",src:null==u?void 0:u.img,sx:{width:60,height:"auto"}})}),(0,z.BX)(ue.ZP,{item:!0,flexGrow:1,sx:{pl:1},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:null==u?void 0:u.name}),(0,z.tZ)(Y.Z,{variant:"subtitle1",children:t})]})]})}),null!=u&&u.sections?(0,z.tZ)(At.Z,{sections:u.sections,hideDesc:!0,hideHeader:t=>{var n;const a=null==(n=t.header)?void 0:n.action;if(a&&"string"!=typeof a){return a.props.children.props.key18.includes(e)}return!1}}):null]})]})}var gs=n(88819),bs=n(86482),vs=n(43210);let xs,ys=e=>e;function ws(){return(0,z.tZ)(d.Z,{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch",children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.BX)(ue.ZP,{item:!0,xs:12,md:6,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(Cs,{}),(0,z.tZ)(ks,{})]}),(0,Xt.w6)(0,2).map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:12,md:6,lg:3,children:(0,z.tZ)(Bs,{index:e})},e)))]})})}function Cs(){var e,t,n;const{data:a,oldData:i}=(0,f.useContext)(X.R),r=a.getTeamBuff(),l=[];return Object.entries(null!=(e=r.total)?e:{}).forEach((([e,t])=>!t.isEmpty&&0!==t.value&&l.push([["total",e],t]))),Object.entries(null!=(t=r.premod)?t:{}).forEach((([e,t])=>!t.isEmpty&&0!==t.value&&l.push([["premod",e],t]))),Object.entries(null!=(n=r.enemy)?n:{}).forEach((([e,t])=>!t.isEmpty&&"number"==typeof t.value&&0!==t.value&&l.push([["enemy",e],t]))),l.length?(0,z.BX)(y.Z,{children:[(0,z.tZ)(h.Z,{children:(0,z.tZ)(Y.Z,{children:"Team Buffs"})}),(0,z.tZ)(F.Z,{}),(0,z.tZ)(h.Z,{children:(0,z.tZ)(ue.ZP,{container:!0,children:l.map((([e,t])=>{var n;return t&&(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)(Le.JW,{node:t,oldValue:null==(n=(0,Xt.Hm)(null==i?void 0:i.getTeamBuff(),e))?void 0:n.value})},JSON.stringify(t.info))}))})})]}):null}function ks(){const{t:e}=(0,g.$G)("page_character"),{data:t}=(0,f.useContext)(X.R),{character:{team:n}}=(0,f.useContext)(S.K),a=n.reduce(((e,t)=>e+(t?1:0)),1);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(y.Z,{children:(0,z.tZ)(q.Z,{title:(0,z.BX)("span",{children:[e("tabTeambuff.team_reso")," ",(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:a>=4?"success":"warning",children:["(",a,"/4)"]})})," ",(0,z.tZ)(pt.L,{title:(0,z.tZ)(Y.Z,{children:e(xs||(xs=ys`tabTeambuff.resonance_tip`))})})]}),titleTypographyProps:{variant:"subtitle2"}})}),vs.J.map(((e,n)=>(0,z.BX)(y.Z,{sx:{opacity:e.canShow(t)?1:.5},children:[(0,z.tZ)(q.Z,{title:(0,z.BX)("span",{children:[e.name," ",(0,z.tZ)(pt.L,{title:(0,z.tZ)(Y.Z,{children:e.desc})})]}),action:e.icon,titleTypographyProps:{variant:"subtitle2"}}),e.canShow(t)&&(0,z.tZ)(F.Z,{}),e.canShow(t)&&(0,z.tZ)(h.Z,{children:(0,z.tZ)(At.Z,{sections:e.sections,teamBuffOnly:!0,hideDesc:!0})})]},n)))]})}function Bs({index:e}){const{teamData:t}=(0,f.useContext)(X.R),{t:n}=(0,g.$G)("page_character"),{character:a,character:{key:i},characterDispatch:r}=(0,f.useContext)(S.K),l=a.team[e],s=(0,f.useMemo)((()=>[i,...a.team].filter(((t,n)=>n-1!==e))),[a.team,i,e]),o=(0,$.Z)(),c=(0,f.useCallback)((t=>r({type:"team",index:e,charKey:t})),[e,r]),d=t[l],u=(0,f.useMemo)((()=>{var e;return d&&{character:Object.assign({},d.character,{conditional:null!=(e=a.teamConditional[l])?e:{}}),characterSheet:d.characterSheet,characterDispatch:e=>{if(!l)return;if(!("conditional"in e))return;const{conditional:t}=e;t&&r({type:"teamConditional",teamMateKey:l,conditional:t})}}}),[a,l,d,r]),h=(0,f.useMemo)((()=>d&&{data:d.target,teamData:t}),[d,t]);return(0,z.BX)(y.Z,{sx:{overflow:"visible"},children:[(0,z.tZ)(Ps,{characterKey:l,team:s,setChar:c,label:n("teammate",{count:e+1})}),l&&u&&(0,z.tZ)(S.K.Provider,{value:u,children:h&&(0,z.tZ)(X.R.Provider,{value:h,children:(0,z.tZ)(ht.Z,{characterKey:l,onClickHeader:o,artifactChildren:(0,z.tZ)(S.K.Provider,{value:u,children:(0,z.tZ)(X.R.Provider,{value:h,children:(0,z.tZ)(Ss,{})})}),weaponChildren:(0,z.tZ)(S.K.Provider,{value:u,children:(0,z.tZ)(X.R.Provider,{value:h,children:(0,z.tZ)(Xs,{})})}),characterChildren:(0,z.tZ)(S.K.Provider,{value:u,children:(0,z.tZ)(X.R.Provider,{value:h,children:(0,z.tZ)(js,{})})}),isTeammateCard:!0})})})]})}function Ss(){const{data:e}=(0,f.useContext)(X.R),t=(0,f.useMemo)((()=>Object.entries((0,Mt.ND)(e)).flatMap((([e,t])=>t.flatMap((t=>{var n;return null!=(n=(0,Mt.Sk)(e).setEffectDocument(t))?n:[]}))))),[e]);return t?(0,z.tZ)(At.Z,{sections:t,teamBuffOnly:!0}):null}function Xs(){const{character:{key:e}}=(0,f.useContext)(S.K),{teamData:t}=(0,f.useContext)(X.R),n=t[e].weaponSheet;return n.document?(0,z.tZ)(At.Z,{sections:n.document,teamBuffOnly:!0}):null}function js(){const{character:{key:e}}=(0,f.useContext)(S.K),{teamData:t}=(0,f.useContext)(X.R),n=t[e].characterSheet,a=Object.values(n.talent).flatMap((e=>e.sections));return a?(0,z.tZ)(At.Z,{sections:a,teamBuffOnly:!0}):null}function Ps({characterKey:e,team:t,label:n,setChar:a,autoCompleteProps:i={}}){const{t:r}=(0,g.$G)(["charNames_gen","page_character","sheet_gen"]),{database:l}=(0,f.useContext)(E.t),{gender:s}=(0,D.Z)(),o=(0,f.useCallback)((e=>{var t;return e.startsWith("Traveler")?`${r(`charNames_gen:${(0,R.LP)(e,s)}`)} (${r(`sheet_gen:element.${null==(t=(0,O.m)(e,s))?void 0:t.elementKey}`)})`:r(`charNames_gen:${e}`)}),[r,s]),c=(0,f.useCallback)((e=>e?(0,z.tZ)(G.Z,{src:(0,L.Li)(e,"iconSide",s),sx:{pr:1}}):(0,z.tZ)(gs.Z,{})),[s]),d=(0,f.useCallback)((e=>l.charMeta.get(e).favorite),[l]),h=(0,f.useCallback)((({key:n})=>t.filter((t=>t&&t!==e)).includes(n)||n.startsWith("Traveler")&&t.some(((e,t)=>e.startsWith("Traveler")))),[t,e]),Z=(0,f.useMemo)((()=>l.chars.keys.map((e=>({key:e,label:o(e),favorite:d(e)}))).sort(((e,t)=>e.favorite&&!t.favorite?-1:!e.favorite&&t.favorite?1:e.label.localeCompare(t.label)))),[o,d,l]);return(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"text",width:100}),children:(0,z.tZ)(bs._,Object.assign({size:"small",label:n,options:Z,valueKey:e,onChange:e=>a(null!=e?e:""),getOptionDisabled:h,toImg:c},i))})}var Os=n(71076),Es=n(97183),Ks=n(31114),Ms=n(17206),As=n(14520),Ds=n(69278);let Is,Ts=e=>e;function Rs(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const _s=f.lazy((()=>Promise.resolve().then(n.bind(n,89431))));function Ls(){var e,t;const{database:n}=(0,f.useContext)(E.t),{data:a}=(0,f.useContext)(X.R),{character:i,character:{key:r,compareData:l},characterSheet:s,characterDispatch:o}=(0,f.useContext)(S.K),c=function(e,t){const{database:n}=(0,f.useContext)(E.t),[a,i]=(0,f.useState)((()=>n.charTCs.getWithInit(e,t)));return(0,f.useEffect)((()=>i(n.charTCs.getWithInit(e,t))),[n,e,t]),(0,f.useEffect)((()=>e?n.charTCs.follow(e,((e,t,n)=>"update"===t&&i(n))):void 0),[e,i,n]),a}(r,(0,zl.mT)(s.weaponTypeKey)),h=(0,f.useCallback)((e=>n.charTCs.set(r,e)),[r,n]),Z=(0,f.useCallback)((()=>{h((0,Ds.O)((0,zl.mT)(s.weaponTypeKey)))}),[h,s]),p=(0,f.useCallback)((e=>{h(Object.assign({},c,{weapon:Object.assign({},c.weapon,e)}))}),[h,c]),g=(0,f.useCallback)(((e,t)=>{const n=(0,Ds.O)(e.key);n.artifact.substats.type=c.artifact.substats.type,n.weapon.level=e.level,n.weapon.ascension=e.ascension,n.weapon.refinement=e.refinement;const a={};t.forEach((e=>{var t;if(!e)return;const{slotKey:i,setKey:r,substats:l,mainStatKey:s,level:o,rarity:c}=e;n.artifact.slots[i].level=o,n.artifact.slots[i].statKey=s,n.artifact.slots[i].rarity=c,a[r]=(null!=(t=a[r])?t:0)+1,l.forEach((e=>{var t;e.key&&(n.artifact.substats.stats[e.key]=(null!=(t=n.artifact.substats.stats[e.key])?t:0)+e.accurateValue)}))})),n.artifact.sets=Object.fromEntries(Object.entries(a).map((([e,t])=>[e,3===t?2:5===t?4:1!==t||e.startsWith("PrayersFor")?t:0])).filter((([e,t])=>t))),h(n)}),[c,h]),v=(0,b.TH)(),{build:x}=null!=(e=v.state)?e:{build:void 0};(0,f.useEffect)((()=>{if(!x)return;const e=n.weapons.get(i.equippedWeapon);g(e,x.map((e=>n.arts.get(e))))}),[x,n]);const w=(0,f.useCallback)((()=>{const e=n.weapons.get(i.equippedWeapon);g(e,Object.values(i.equippedArtifacts).map((e=>n.arts.get(e))).filter((e=>e)))}),[n,i.equippedArtifacts,i.equippedWeapon,g]),C=(0,f.useMemo)((()=>Object.assign({},c.weapon,{location:"",lock:!1,id:""})),[c]),k=(0,f.useCallback)((e=>{const t=(0,Xt.I8)(c);t.artifact=e,h(t)}),[c,h]),B=(0,f.useCallback)((e=>{const t=(0,Xt.I8)(c);t.artifact.substats.type=e,h(t)}),[c,h]),j=(0,f.useCallback)((e=>{const t=(0,Xt.I8)(c);t.artifact.substats.stats=e,h(t)}),[c,h]),P=(0,f.useDeferredValue)(c),O=(0,f.useMemo)((()=>{const e=Object.assign({},P.artifact.substats.stats);return Object.values(P.artifact.slots).forEach((({statKey:t,rarity:n,level:a})=>{var i;return e[t]=(null!=(i=e[t])?i:0)+Xn.ZP.mainStatValue(t,n,a)})),{art:(0,Xt.xh)(e,((e,t)=>t.endsWith("_")?(0,Lt.aQ)(e/100):(0,Lt.a9)(e))),artSet:(0,Xt.xh)(P.artifact.sets,(e=>(0,Lt.a9)(e)))}}),[P]),K=(0,f.useMemo)((()=>({id:"",location:"",key:c.weapon.key,level:c.weapon.level,ascension:c.weapon.ascension,refinement:c.weapon.refinement,lock:!1})),[c]),M=(0,I.Z)(r,0,O,K),{target:A}=null!=(t=null==M?void 0:M[r])?t:{},D=(0,f.useMemo)((()=>{if(M&&A)return{data:A,teamData:M}}),[A,M]),T=(0,f.useMemo)((()=>{if(D)return Object.assign({},D,{oldData:l?a:void 0})}),[D,l,a]);return(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(y.Z,{children:(0,z.BX)(d.Z,{sx:{display:"flex",gap:1,p:1},children:[(0,z.BX)(d.Z,{sx:{flexGrow:1,display:"flex",gap:1},children:[(0,z.tZ)(m.Z,{color:"info",onClick:w,startIcon:(0,z.tZ)(Os.Z,{}),children:"Copy from equipped"}),(0,z.tZ)(m.Z,{color:"error",onClick:Z,startIcon:(0,z.tZ)(Es.Z,{}),children:"Reset"})]}),(0,z.BX)(mt.Z,{exclusive:!0,value:l,onChange:(e,t)=>o({compareData:t}),size:"small",children:[(0,z.tZ)(ct.Z,{value:!1,disabled:!l,children:"Show TC stats"}),(0,z.tZ)(ct.Z,{value:!0,disabled:l,children:"Compare vs. equipped"})]})]})}),D?(0,z.tZ)(X.R.Provider,{value:D,children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,z.BX)(ue.ZP,{item:!0,sx:{flexGrow:-1},children:[(0,z.tZ)(Gs,{weapon:C,setWeapon:p,weaponTypeKey:s.weaponTypeKey}),(0,z.tZ)($s,{artifactData:c.artifact,setArtifactData:k})]}),(0,z.tZ)(ue.ZP,{item:!0,sx:{flexGrow:1},children:(0,z.tZ)(Ws,{substats:c.artifact.substats.stats,setSubstats:j,substatsType:c.artifact.substats.type,setSubstatsType:B,mainStatKeys:Object.values(c.artifact.slots).map((e=>e.statKey))})})]})}):(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:500}),(0,z.tZ)(y.Z,{sx:{flexGrow:1,p:1},children:T?(0,z.tZ)(X.R.Provider,{value:T,children:(0,z.tZ)(Rn,{})}):(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:500})})]})}function Gs({weapon:e,setWeapon:t,weaponTypeKey:n}){const{key:a,level:i=0,refinement:r=1,ascension:l=0}=e,s=(0,Ln.ub)(a),[o,c,u]=(0,K.Z)(),{data:h}=(0,f.useContext)(X.R),Z=(0,f.useMemo)((()=>e&&(0,bt.mP)([s.data,(0,bt.v0)(e)])),[s,e]);return(0,z.BX)(y.Z,{sx:{p:1,mb:1},children:[(0,z.tZ)(_s,{ascension:l,show:o,onHide:u,onSelect:e=>t({key:e}),weaponTypeFilter:n}),(0,z.BX)(d.Z,{display:"flex",flexDirection:"column",gap:1,children:[(0,z.BX)(d.Z,{display:"flex",gap:1,children:[(0,z.tZ)(d.Z,{className:`grad-${s.rarity}star`,component:"img",src:(0,L.Aq)(e.key,l>=2),sx:{flexshrink:1,flexBasis:0,maxWidth:"30%",borderRadius:1}}),(0,z.BX)(de.Z,{spacing:1,flexGrow:1,children:[(0,z.tZ)(m.Z,{fullWidth:!0,color:"info",sx:{flexGrow:1},onClick:c,children:(0,z.tZ)(d.Z,{sx:{maxWidth:"10em"},children:null==s?void 0:s.name})}),s.hasRefinement&&(0,z.tZ)(As.Z,{refinement:r,setRefinement:e=>t({refinement:e})})]})]}),(0,z.tZ)(k.Z,{level:i,ascension:l,setBoth:t,useLow:!s.hasRefinement}),(0,z.BX)(x.Z,{children:[(0,z.tZ)(q.Z,{title:"Main Stats",titleTypographyProps:{variant:"subtitle2"}}),(0,z.tZ)(F.Z,{}),Z&&(0,z.tZ)(Le.lD,{children:[xe.ri.weapon.main,xe.ri.weapon.sub,xe.ri.weapon.sub2].map(((e,t)=>{const n=Z.get(e);return n.isEmpty||!n.value?null:(0,z.tZ)(Le.JW,{node:n,component:Ze.ZP},JSON.stringify(n.info))}))})]}),h&&(null==s?void 0:s.document)&&(0,z.tZ)(At.Z,{sections:s.document})]})]})}function $s({artifactData:e,setArtifactData:t}){const n=(0,f.useCallback)((n=>a=>{const i=(0,Xt.I8)(e);i.slots[n]=a,t(i)}),[e,t]),a=(0,f.useCallback)((n=>{const a=(0,Xt.I8)(e);a.sets=n,t(a)}),[e,t]);return(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(y.Z,{sx:{p:1},children:(0,z.tZ)(de.Z,{spacing:1,children:pe.Ex.map((t=>(0,z.tZ)(zs,{slotKey:t,slot:e.slots[t],setSlot:n(t)},t)))})}),(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.tZ)(Ns,{artSet:e.sets,setArtSet:a})})]})}function zs({slotKey:e,slot:t,setSlot:n}){var a;const{level:i,statKey:r,rarity:l}=t,s=Xn.ZP.slotMainStats(e),o=(0,f.useCallback)((e=>{n(Object.assign({},t,e))}),[t,n]),c=(0,f.useCallback)((e=>{var t;const n=null!=(t=Xn.P4[e])?t:0;o(i>n?{rarity:e,level:n}:{rarity:e})}),[i,o]);return(0,z.BX)(d.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.tZ)(It.Z,{slotKey:e}),(0,z.tZ)(x.Z,{sx:{height:"100%",minWidth:"5em",flexGrow:1,display:"flex"},children:1===s.length?(0,z.BX)(d.Z,{p:1,justifyContent:"center",alignItems:"center",width:"100%",display:"flex",gap:1,children:[(0,z.tZ)(we.C,{statKey:s[0],iconProps:Ce.m})," ",ye.ZP.getStr(s[0])]}):(0,z.tZ)(Zt.Z,{sx:{px:0},fullWidth:!0,title:(0,z.tZ)(Kn,{statKey:r}),color:null!=(a=ye.ZP.getVariant(r))?a:"success",children:s.map((e=>(0,z.tZ)(ot.Z,{disabled:r===e,onClick:()=>o({statKey:e}),children:(0,z.tZ)(Mn,{statKey:e})},e)))})}),(0,z.tZ)(Zt.Z,{sx:{px:0},title:(0,z.BX)(d.Z,{sx:{display:"flex",alignItems:"center"},children:[l," ",(0,z.tZ)(Kt.Z,{fontSize:"inherit"})]}),children:[5,4,3].map((e=>(0,z.tZ)(ot.Z,{disabled:l===e,onClick:()=>c(e),children:(0,z.BX)(d.Z,{sx:{display:"flex",alignItems:"center"},children:[e," ",(0,z.tZ)(Kt.Z,{fontSize:"inherit"})]})},e)))}),(0,z.tZ)(Oe.ZP,{startAdornment:"+",value:i,color:Xn.ZP.levelVariant(i),onChange:e=>void 0!==e&&o({level:e}),sx:{borderRadius:1,pl:1,my:0,height:"100%"},inputProps:{sx:{pl:.5,width:"2em"},max:20,min:0}}),(0,z.tZ)(x.Z,{sx:{height:"100%",minWidth:"4em"},children:(0,z.tZ)(d.Z,{p:1,textAlign:"center",children:`${(0,ye.qs)(Xn.ZP.mainStatValue(r,l,i),ye.ZP.unit(r))}${ye.ZP.unit(r)}`})})]})}function Ns({artSet:e,setArtSet:t}){const n=(0,f.useCallback)((n=>{n&&t(Object.assign({},e,{[n]:parseInt(Object.keys((0,Mt.Sk)(n).setEffects)[0])}))}),[e,t]),a=(0,f.useCallback)((n=>a=>t(Object.assign({},e,{[n]:a}))),[e,t]),i=(0,f.useCallback)((n=>()=>{const a=(0,ke.Z)(e,[n].map(Rs));t(Object.assign({},a))}),[e,t]),r=5-Object.values(e).reduce(((e,t)=>e+t),0);return(0,z.BX)(de.Z,{spacing:1,sx:{flexGrow:1},children:[Object.entries(e).map((([e,t])=>(0,z.tZ)(Vs,{setKey:e,value:t,setValue:a(e),deleteValue:i(e),remaining:r},e))),(0,z.tZ)(y.Z,{sx:{flexGrow:1,overflow:"visible"},children:(0,z.tZ)(Ms.Z,{artSetKey:"",setArtSetKey:n,label:"New Artifact Set",getOptionDisabled:({key:t})=>Object.keys(e).includes(t)||!t||Object.keys((0,Mt.Sk)(t).setEffects).every((e=>parseInt(e)>r))})})]})}function Vs({setKey:e,value:t,setValue:n,deleteValue:a,remaining:i}){const r=(0,Mt.Sk)(e),l=(0,f.useMemo)((()=>t<4?[]:Object.keys(r.setEffects).filter((e=>{var t;return null==(t=r.setEffects[e])?void 0:t.document.some((e=>"states"in e))}))),[r,t]);return(0,z.BX)(y.Z,{children:[(0,z.BX)(d.Z,{display:"flex",children:[(0,z.tZ)(qn.Z,{artifactSheet:r,numInSet:t,children:(0,z.BX)(d.Z,{flexGrow:1,p:1,display:"flex",gap:1,alignItems:"center",children:[(0,z.tZ)(ne.Z,{size:2,src:(0,Rt.jU)(e)}),(0,z.tZ)(d.Z,{children:r.setName}),(0,z.tZ)(Ks.Z,{})]})}),(0,z.BX)(Pe.Z,{children:[(0,z.tZ)(Zt.Z,{size:"small",title:(0,z.BX)(d.Z,{whiteSpace:"nowrap",children:[t,"-set"]}),children:Object.keys(r.setEffects).map((e=>parseInt(e))).map((e=>(0,z.BX)(ot.Z,{disabled:t===e||e>i+t,onClick:()=>n(e),children:[e,"-set"]},e)))}),(0,z.tZ)(m.Z,{color:"error",size:"small",onClick:a,children:(0,z.tZ)(it.Z,{})})]})]}),!!l.length&&(0,z.tZ)(de.Z,{spacing:1,sx:{p:1},children:l.map((t=>(0,z.tZ)(Dt,{setKey:e,setNumKey:parseInt(t),hideHeader:!0,conditionalsOnly:!0},t)))})]})}function Ws({substats:e,setSubstats:t,substatsType:n,setSubstatsType:a,mainStatKeys:i}){const r=(0,f.useCallback)((n=>a=>t(Object.assign({},e,{[n]:a}))),[e,t]),{t:l}=(0,g.$G)("page_character"),s=100*Object.entries(e).reduce(((e,[t,n])=>e+n/Xn.ZP.substatValue(t)),0),o=Object.entries(e).reduce(((e,[t,a])=>e+a/Xn.ZP.substatValue(t,void 0,n)),0);return(0,z.BX)(y.Z,{sx:{p:1,height:"100%"},children:[(0,z.BX)(d.Z,{sx:{mb:1,display:"flex",gap:1},children:[(0,z.tZ)(Zt.Z,{fullWidth:!0,title:l(`tabTheorycraft.substatType.${n}`),children:R.Q7.map((e=>(0,z.tZ)(ot.Z,{disabled:n===e,onClick:()=>a(e),children:l(`tabTheorycraft.substatType.${e}`)},e)))}),(0,z.tZ)(ut.Z,{title:(0,z.tZ)(Y.Z,{children:l(Is||(Is=Ts`tabTheorycraft.maxTotalRolls`))}),placement:"top",children:(0,z.BX)(x.Z,{sx:{textAlign:"center",py:.5,px:1,minWidth:"15em",whiteSpace:"nowrap",display:"flex",gap:2,justifyContent:"flex-end",alignItems:"center"},children:[(0,z.BX)(te.Z,{color:o>45?"warning":void 0,children:["Rolls: ",(0,z.tZ)("strong",{children:o.toFixed(0)})]}),(0,z.BX)(te.Z,{color:o>45?"warning":void 0,children:["RV: ",(0,z.BX)("strong",{children:[s.toFixed(1),"%"]})]})]})})]}),(0,z.tZ)(de.Z,{spacing:1,children:Object.entries(e).map((([e,t])=>(0,z.tZ)(qs,{statKey:e,value:t,setValue:r(e),substatsType:n,mainStatKeys:i},e)))})]})}function qs({statKey:e,value:t,setValue:n,substatsType:a,mainStatKeys:i}){const{t:r}=(0,g.$G)("page_character"),l=Xn.ZP.substatValue(e,5,a),[s,o]=(0,f.useState)((()=>t/l));(0,f.useEffect)((()=>o(t/l)),[t,l]);const c=ye.ZP.unit(e),u=s*l,h=s*l/Xn.ZP.substatValue(e)*100,Z=i.reduce(((t,n)=>t+(n===e?1:0)),0),p=6*(5-Z),m=s-1e-4>p,b=(0,f.useCallback)((e=>n(e*l)),[n,l]);return(0,z.BX)(de.Z,{spacing:.5,children:[(0,z.BX)(d.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.BX)(x.Z,{sx:{p:.5,minWidth:"11em",flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center"},children:[(0,z.tZ)(we.C,{statKey:e,iconProps:{fontSize:"inherit"}}),ye.ZP.getStr(e),ye.ZP.unit(e)]}),(0,z.tZ)(ut.Z,{title:(0,z.tZ)(Y.Z,{children:r(Z?"tabTheorycraft.maxRollsMain":"tabTheorycraft.maxRolls",{value:p})}),placement:"top",children:(0,z.tZ)(x.Z,{sx:{textAlign:"center",p:.5,minWidth:"8em"},children:(0,z.BX)(te.Z,{color:m?"warning":void 0,children:["RV: ",(0,z.BX)("strong",{children:[h.toFixed(1),"%"]})]})})})]}),(0,z.BX)(d.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.tZ)(Oe.ZP,{color:u?"success":"primary",float:"%"===ye.ZP.unit(e),endAdornment:ye.ZP.unit(e)||(0,z.tZ)(d.Z,{width:"1em",component:"span"}),value:parseFloat(u.toFixed(2)),onChange:e=>void 0!==e&&n(e),sx:{borderRadius:1,px:1,height:"100%",width:"6em"},inputProps:{sx:{textAlign:"right"},min:0}}),(0,z.tZ)(x.Z,{sx:{px:2,flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center",overflow:"visible"},children:(0,z.tZ)(ia.ZP,{size:"small",value:s,max:p,min:0,step:1,marks:!0,valueLabelDisplay:"auto",onChange:(e,t)=>o(t),onChangeCommitted:(e,t)=>b(t)})}),(0,z.tZ)(Oe.ZP,{color:t?m?"warning":"success":"primary",float:!0,startAdornment:(0,z.BX)(d.Z,{sx:{whiteSpace:"nowrap",width:"7em",display:"flex",justifyContent:"space-between"},children:[(0,z.BX)("span",{children:[(0,ye.qs)(l,c),c]}),(0,z.tZ)("span",{children:"x"})]}),value:parseFloat(s.toFixed(2)),onChange:e=>void 0!==e&&n(e*l),sx:{borderRadius:1,px:1,my:0,height:"100%",width:"7em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1}})]})]})}var Fs=n(1856),Hs=n(5896);const Us=[[1],[1,1,1,1],[1,2,3,4,3,2,1],[1,3,6,10,12,12,10,6,3,1],[1,4,10,20,31,40,44,40,31,20,10,4,1],[1,5,15,35,65,101,135,155,155,135,101,65,35,15,5,1]];function Ys(e,t){for(var n;e>=Us.length;){const e=Us.length,t=[];for(let n=0,s=e-1;n<=3*e;n++){var a,i,r,l;const e=null!=(a=Us[s][n-3])?a:0,o=null!=(i=Us[s][n-2])?i:0,c=null!=(r=Us[s][n-1])?r:0,d=null!=(l=Us[s][n])?l:0;t[n]=e+o+c+d}Us.push(t)}return null!=(n=Us[e][t])?n:0}function Js(e){let t=1;e<0&&(t=-1);const n=1/(1+.3275911*(e=Math.abs(e)));return t*(1-((((1.061405429*n-1.453152027)*n+1.421413741)*n-.284496736)*n+.254829592)*n*Math.exp(-e*e))}function Qs(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=1),n<=0?0:Math.exp(-(t-e)*(t-e)/n/2)/Math.sqrt(2*Math.PI*n)}const eo=[270/1024,80/1024,0,12/256,8/256,120/1024,0,60/1024,4/256,60/1024,4/256,30/1024,24/256,.15625,1/64,1/64,24/256,1/64,12/256,0,6/256,2/16,6/256,0,81/256,.0625,0,27/64,12/64,0,1/16,1/16,12/64,1/16,6/64,3/4,.5,243/1024,.03125,0,108/256,.125,0,9/64,6/64,.1875,0,24/256,3/64,5/1024,3/64,5/1024,0,405/1024,80/1024,0,54/256,90/1024,40/1024,0,1/256,1/256,40/1024,1/256,20/1024,9/16,.25,0,1/4,1/4,0,1/4,27/64,8/64,0,6/16,.25,10/1024,0,10/1024,2/16,0,0,0,15/1024,10/1024,1/1024,1/1024,0,1/1024],to=[35,64,70,21,33,45,12,0,53,76,48,86];function no(e,t){const n=e.reduce(((e,t)=>e+t));if(e.length>4||n>t)return 0;if(4===e.length&&n!==t)return 0;3===e.length&&(e=[...e,t-n]),e.sort().reverse();let a=13*t+e.length-14+16*e[0];e.length>1&&(a+=4*e[1]);const i=a%12,r=Math.trunc(a/12);return eo[i+to[r]]}function ao(e,t){if(0!==e)for(let n=e;n>=0;n--)for(let a=e-n;a>=0;a--)for(let i=e-n-a;i>=0;i--){const r=e-n-a-i;t([n,a,i,r],no([n,a,i,r],e))}else t([0,0,0,0],1)}function io(e,t,n){if(t<1e-5)return e>n?{p:1,upAvg:e-n}:{p:0,upAvg:0};const a=(n-e)/Math.sqrt(t),i=(1-Js(a/Math.sqrt(2)))/2;if(a>5){const e=1/a,n=e*e;return{p:i,upAvg:Math.sqrt(t)*e*(1-2*n*(1-n*(5+37*n)))}}const r=Math.exp(-a*a/2)/Math.sqrt(2*Math.PI);return{p:i,upAvg:e-n+Math.sqrt(t)*r/i}}const ro={hp:6,atk:6,def:6,hp_:4,atk_:4,def_:4,eleMas:4,enerRech_:4,critRate_:3,critDMG_:3},lo=Object.values(ro).reduce(((e,t)=>e+t));function so(e,t){if(t.includes(e))return 0;const n=lo-t.reduce(((e,t)=>{var n;return e+(null!=(n=ro[t])?n:0)}),0);return ro[e]/n}function oo(e,t,n=!1,a=!1){const i=Object.assign({},e.curBuild);i[t.slot]=t;const r=function(e){const t={};return Object.values(e).forEach((e=>{e&&Object.entries(e.values).forEach((([e,n])=>{var a;return t[e]=(null!=(a=t[e])?a:0)+n}))})),t}(i),l=Object.assign({},r),s=e=>e.endsWith("_")?Xn.ZP.substatValue(e,t.rarity)/1e3:Xn.ZP.substatValue(e,t.rarity)/10,o=Xn.ZP.rollsRemaining(t.level,t.rarity)-(4-t.subs.length);if(4===t.subs.length&&(a=!1),a){const i=Object.keys(t.values).filter((e=>!t.subs.includes(e))).filter((e=>!pe.Gt.includes(e)));if(1!==i.length)throw Error("Failed to extract artifact main stat");const c=i[0],d=Si._m.filter((e=>!t.subs.includes(e)&&e!==c)),u=d.map((i=>{const l=[...t.subs,i],d={rollsLeft:o,subs:l,calc4th:a,stats:r,thresholds:e.thresholds,objectiveEval:t=>e.evalFn(t).map((({v:e,grads:t})=>({v:e,ks:l.map((e=>t[Si._m.indexOf(e)]*s(e)))}))),scale:s},u=n?uo(d):co(d);return Object.assign({},u,{p2:so(i,[...t.subs,c])})})),h=u.reduce(((e,{prob:t,p2:n})=>e+t*n),0),Z=h<1e-6?0:u.reduce(((e,{prob:t,p2:n,upAvg:a})=>e+t*n*a),0)/h,p=u.reduce(((e,{p2:t,distr:n})=>(e.lower=Math.min(e.lower,n.lower),e.upper=Math.max(e.upper,n.upper),e.gmm.push(...n.gmm.map((({phi:e,cp:n,mu:a,sig2:i})=>({phi:t*e,cp:n,mu:a,sig2:i})))),e)),{gmm:[],lower:1/0,upper:-1/0});return{id:t.id,subs:t.subs,fourthsubOpts:d.map((e=>({sub:e,subprob:so(e,[...t.subs,c])}))),rollsLeft:o,statsBase:l,prob:h,upAvg:Z,distr:p,evalFn:e.evalFn,skippableDerivs:e.skippableDerivs,thresholds:e.thresholds,evalMode:n?"slow":"fast"}}{const i={rollsLeft:o,subs:t.subs,calc4th:a,stats:r,thresholds:e.thresholds,objectiveEval:n=>e.evalFn(n).map((({v:e,grads:n})=>({v:e,ks:t.subs.map((e=>n[Si._m.indexOf(e)]*s(e)))}))),scale:s},c=n?uo(i):co(i);return Object.assign({id:t.id,subs:t.subs,rollsLeft:o,statsBase:l},c,{evalFn:e.evalFn,skippableDerivs:e.skippableDerivs,thresholds:e.thresholds,evalMode:n?"slow":"fast"})}}function co({rollsLeft:e,subs:t,stats:n,thresholds:a,calc4th:i,scale:r,objectiveEval:l}){const s=Object.assign({},n);t.forEach(((t,n)=>{var a;const l=i&&3===n?1:0;s[t]=(null!=(a=s[t])?a:0)+8.5*(e/4+l)*r(t)}));const o=e,c=l(s);let d=1,u=-1,h={gmm:[],lower:c[0].v,upper:c[0].v};for(let e=0;e<c.length;e++){const{v:t,ks:n}=c[e],r=n.reduce(((e,t)=>e+t)),l=t,s=(147/8*n.reduce(((e,t)=>e+t*t),0)-289/64*r*r)*o+(i?5/4*n[3]*n[3]:0),{p:Z,upAvg:p}=io(l,s,a[e]);0===e&&(u=p,h={gmm:[{phi:1,mu:l,sig2:s,cp:1}],lower:l-4*Math.sqrt(s),upper:l+4*Math.sqrt(s)}),d=Math.min(Z,d)}return{prob:d,upAvg:u,distr:h}}function uo({rollsLeft:e,stats:t,subs:n,thresholds:a,calc4th:i,scale:r,objectiveEval:l}){const s={gmm:[],lower:a[0],upper:a[0]},o=[];ao(e,((e,c)=>{const d=Object.assign({},t);i&&(e[3]+=1),n.forEach(((t,n)=>{var a;d[t]=(null!=(a=d[t])?a:0)+8.5*e[n]*r(t)}));const u=l(d),h=u.map((e=>e.v)),Z=u.map((t=>u.map((n=>t.ks.reduce(((a,i,r)=>a+t.ks[r]*n.ks[r]*e[r]),0))))),p=function(e,t,n){let a=1,i=1;for(let r=0;r<e.length;++r){if(t[r][r]<1e-5){if(e[r]<n[r])return{p:0,upAvg:0,cp:0};continue}const l=(1-Js((n[r]-e[r])/Math.sqrt(t[r][r])/Math.sqrt(2)))/2;a*=l,0!==r&&(i*=l)}const{upAvg:r}=io(e[0],t[0][0],n[0]);return{p:a,upAvg:r,cp:i}}(h,Z,a);o.push(Object.assign({l:c},p)),s.gmm.push({phi:c,mu:h[0],sig2:Z[0][0],cp:p.cp}),s.lower=Math.min(s.lower,h[0]-4*Math.sqrt(Z[0][0])),s.upper=Math.max(s.upper,h[0]+4*Math.sqrt(Z[0][0]))}));let c=0,d=0;return o.forEach((({l:e,p:t,upAvg:n,cp:a})=>{c+=e*t*a,d+=e*t*a*n})),c<1e-10?{prob:0,upAvg:0,distr:s}:(d/=c,{prob:c,upAvg:d,distr:s})}function ho(e,t,n){let a=!0;return(0,Oi.aD)([e],(e=>{}),(e=>{const{operation:i}=e;if("read"===i){if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error(`Unsupported [${i}] node in zero_deriv`);t(e)===n&&(a=!1)}})),a}function Zo(e,t,n){const{operation:a}=e;switch(a){case"read":if("number"!==e.type||e.accu&&"add"!==e.accu)throw new Error(`Unsupported [${a}] node in d/dx`);return t(e)===n?(0,Lt.a9)(1):(0,Lt.a9)(0);case"const":return(0,Lt.a9)(0);case"res":if(!ho(e,t,n))throw new Error(`[${a}] node takes only constant inputs. ${e}`);return(0,Lt.a9)(0);case"add":return(0,Lt.Sm)(...e.operands.map((e=>Zo(e,t,n))));case"mul":{const a=e.operands.map(((a,i)=>(0,Lt.WV)(Zo(a,t,n),...e.operands.filter(((e,t)=>t!==i)))));return(0,Lt.Sm)(...a)}case"sum_frac":{const a=e.operands[0],i=Zo(a,t,n),r=(0,Lt.Sm)(...e.operands.slice(1)),l=Zo(r,t,n),s=(0,Lt.WV)((0,Lt.Sm)(...e.operands),(0,Lt.Sm)(...e.operands)),o=(0,Lt.Sm)((0,Lt.WV)(r,i),(0,Lt.WV)(-1,a,l));return(0,Lt.F9)(o,(0,Lt.Sm)((0,Lt.WV)(-1,o),s))}case"min":case"max":if(1===e.operands.length)return Zo(e.operands[0],t,n);if(2===e.operands.length){const[i,r]=e.operands;if("min"===a)return(0,Lt.Lj)(i,r,Zo(r,t,n),Zo(i,t,n));if("max"===a)return(0,Lt.Lj)(i,r,Zo(i,t,n),Zo(r,t,n));(0,Xt.UT)(a);break}if("min"===a)return Zo((0,Lt.VV)(e.operands[0],(0,Lt.VV)(...e.operands.slice(1))),t,n);if("max"===a)return Zo((0,Lt.Fp)(e.operands[0],(0,Lt.Fp)(...e.operands.slice(1))),t,n);(0,Xt.UT)(a);break;case"threshold":{const[i,r,l,s]=e.operands;if(!ho(i,t,n)||!ho(r,t,n))throw new Error(`[${a}] node must branch on constant inputs. ${e}`);return(0,Lt.Lj)(i,r,Zo(l,t,n),Zo(s,t,n))}default:(0,Xt.UT)(a)}}function po(e,t,n,a={}){const i=[];e.forEach((e=>{i.push(e,...Si._m.map((t=>Zo(e,(e=>e.path[1]),t))))}));let r=(0,vt.tL)(i,a,(({path:[e]})=>"dyn"!==e));r=(0,vt.tL)(r,a,(({path:[e]})=>"dyn"!==e));const l=(0,vt.I3)(r,{},(e=>e.path[1]),1),s=function(e){const t={};return Object.values(e).forEach((e=>{e&&Object.entries(e.values).forEach((([e,n])=>{var a;return t[e]=(null!=(a=t[e])?a:0)+n}))})),t}(n),o=l([{id:"",values:s}])[0],c=Si._m.map((t=>e.every((e=>ho(e,(e=>e.path[1]),t)))));return{formulas:e,thresholds:[o,...t],curBuild:n,evalFn:t=>{const n=l([{id:"",values:t}]);return e.map(((e,t)=>{const a=t*(1+Si._m.length);return{v:n[a],grads:Si._m.map(((e,t)=>n[a+1+t]))}}))},skippableDerivs:c}}function mo(e,t){void 0===t&&(t=e.level);const n=Xn.ZP.mainStatValue(e.mainStatKey,e.rarity,t),a={id:e.id,slot:e.slotKey,level:e.level,rarity:e.rarity,values:Object.assign({[e.setKey]:1,[e.mainStatKey]:e.mainStatKey.endsWith("_")?n/100:n},Object.fromEntries(e.substats.map((e=>[e.key,e.key.endsWith("_")?e.accurateValue/100:e.accurateValue])))),subs:e.substats.reduce(((e,t)=>(""!==t.key&&e.push(t.key),e)),[])};return delete a.values[""],a}function fo(e,t){if(t.prob>1e-5||e.prob>1e-5)return t.prob*t.upAvg-e.prob*e.upAvg;const n=e.distr.gmm.reduce(((e,{phi:t,mu:n})=>e+t*n),0);return t.distr.gmm.reduce(((e,{phi:t,mu:n})=>e+t*n),0)-n}var go=n(81073),bo=n(30840),vo=n(15045);const xo=50;function yo({upgradeOpt:e,objMin:t,objMax:n}){const[a,i]=(0,f.useState)(!1),{database:r}=(0,f.useContext)(E.t),l=r.arts.get(e.id);if(!l)throw new Error(`artifact ${e.id} not found.`);const s=e.thresholds.length>1,o=l.slotKey,{data:c}=(0,f.useContext)(X.R),u=(0,f.useMemo)((()=>pe.Ex.map((e=>{var t;return[e,r.arts.get(null!=(t=c.get(xe.ri.art[e].id).value)?t:"")]}))),[c,r]),Z=t=>e.distr.gmm.reduce(((e,{phi:n,cp:a,mu:i,sig2:r})=>e+a*n*Qs(t,i,r)),0),p=e.thresholds,g=p[0],b=(0,f.useCallback)((e=>100*(e-g)/g),[g]),v=t,x=n;let w=0;const C=function(e=0,t=1,n=50){const a=[],i=(t-e)/n;for(let t=0;t<n;++t)a.push(e+t*i);return a}(v,x,500).map((t=>{const n=(a=t,e.distr.gmm.reduce(((e,{phi:t,mu:n,sig2:i})=>e+t*Qs(a,n,i)),0));var a;return w=Math.max(w,n),{x:b(t),est:n,estCons:Z(t)}}));0===w&&(w=xo/(x-v));const k={},B={};e.distr.gmm.forEach((({phi:e,mu:t,sig2:n,cp:a})=>{var i,r;n<=0&&(k[t]=(null!=(i=k[t])?i:0)+e,B[t]=(null!=(r=B[t])?r:0)+e*a)})),Object.entries(k).forEach((([e,t])=>C.push({x:b(parseFloat(e)),est:t*xo/(x-v),estCons:B[e]*xo/(x-v)}))),C.sort(((e,t)=>e.x-t.x));const S=(g-v)/(x-v),[j,P]=(0,f.useState)([]),[O,K]=(0,f.useState)(-1),[M,A]=(0,f.useState)(-1);if((0,f.useEffect)((()=>{if(!a)return;const t=function({statsBase:e,rollsLeft:t,subs:n,skippableDerivs:a,fourthsubOpts:i,evalFn:r}){const l=e=>e.endsWith("_")?Xn.ZP.substatValue(e,5)/1e3:Xn.ZP.substatValue(e,5)/10,s=e,o=[];return ao(t,((e,t)=>{i&&(e[3]+=1),((...e)=>e.reduce(((e,t)=>e.flatMap((e=>t.map((t=>[e,t].flat())))))))(...e.map(((e,t)=>{if(i&&3===t)return(0,Xt.w6)(7*e,10*e);const r=n[t];return r&&!a[Si._m.indexOf(r)]?(0,Xt.w6)(7*e,10*e):[NaN]}))).forEach((a=>{const c=Object.assign({},s);let d=1;for(let t=0;t<3;t++){var u;if(isNaN(a[t]))continue;const i=n[t],r=a[t],s=e[t];c[i]=(null!=(u=c[i])?u:0)+r*l(i);const o=4**-s*Ys(s,r-7*s);d*=o}if(void 0===i){if(!isNaN(a[3])){var h;const t=n[3],i=a[3],r=e[3];c[t]=(null!=(h=c[t])?h:0)+i*l(t);const s=4**-r*Ys(r,i-7*r);d*=s}o.push({v:r(c).map((e=>e.v)),p:t*d})}else i.forEach((({sub:n,subprob:i})=>{var s;const u=Object.assign({},c),h=n,Z=a[3],p=e[3];u[h]=(null!=(s=u[h])?s:0)+Z*l(h);const m=4**-p*Ys(p,Z-7*p)*i,f=d*m;o.push({v:r(u).map((e=>e.v)),p:t*f})}))}))})),o}(e);let n=0,i=0;const r=new Array(xo).fill(0),l=new Array(xo).fill(0),s=(x-v)/xo;t.forEach((({p:e,v:t})=>{const a=Math.min(Math.trunc((t[0]-v)/s),49);r[a]+=e,t.every(((e,t)=>0===t||e>p[t]))&&(l[a]+=e,t[0]>g&&(n+=e,i+=e*(t[0]-g)))})),n>0&&(i/=n);const o=r.map(((e,t)=>({x:b(v+t*s),exact:e/s,exactCons:l[t]/s})));K(n),A(i),P(o)}),[a,x,v,g,p,e,b]),0===j.length){const e=(x-v)/xo;for(let t=0;t<xo;t++)j.push({x:b(v+t*e),exact:0,exactCons:0})}const D=O>=0?O:e.prob,I=M>=0?M:e.upAvg,T=C.concat(j);return(0,z.tZ)(y.Z,{children:(0,z.BX)(h.Z,{children:[(0,z.tZ)(ra.h,{width:"100%",aspect:2.5,children:(0,z.BX)(la.c,{data:T,margin:{top:5,right:30,left:20,bottom:20},children:[(0,z.tZ)(oa.K,{dataKey:"x",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:e=>`${e<=0?"":"+"}${e}%`,children:(0,z.tZ)(ca._,{value:"Relative Damage Potential",position:"insideBottom",style:{fill:"#eaebed"},offset:-10})}),(0,z.tZ)(da.B,{type:"number",domain:[0,w],tick:!1,children:(0,z.tZ)(ca._,{value:"Probability",position:"insideLeft",angle:-90,style:{fill:"#eaebed"}})}),(0,z.tZ)(ha.D,{verticalAlign:"top",height:36}),(0,z.tZ)("defs",{children:(0,z.BX)("linearGradient",{id:`splitOpacity${e.id}`,x1:"0",y1:"0",x2:S,y2:"0",children:[(0,z.tZ)("stop",{offset:1,stopColor:"orange",stopOpacity:0}),(0,z.tZ)("stop",{offset:0,stopColor:"orange",stopOpacity:1})]})}),(0,z.tZ)(Za.x,{dataKey:"dne",stroke:"red",name:"Current Damage"}),s&&!a&&(0,z.tZ)(go.u,{type:"monotone",dataKey:"est",stroke:"grey",dot:!1,fill:"grey",legendType:"none",tooltipType:"none",opacity:.5,activeDot:!1}),s&&a&&(0,z.tZ)(go.u,{type:"stepAfter",dataKey:"exact",dot:!1,legendType:"none",tooltipType:"none",opacity:.7,activeDot:!1,fill:"grey",stroke:"grey"}),(0,z.tZ)(go.u,{type:"monotone",dataKey:"estCons",stroke:"orange",dot:!1,fill:`url(#splitOpacity${e.id})`,opacity:.5,name:"Estimated Distribution",activeDot:!1}),a&&(0,z.tZ)(go.u,{type:"stepAfter",dataKey:"exactCons",dot:!1,opacity:.7,name:`Exact${s?" Constrained":""} Distribution (Histogram)`,activeDot:!1}),(0,z.tZ)(bo.d,{x:b(g),stroke:"red",strokeDasharray:"3 3",name:"Current Damage"}),(0,z.tZ)(vo.q,{x:b(g+I),y:(Z(g+I)||w)/2,shape:(0,z.tZ)("circle",{radius:1,opacity:.5})}),(0,z.tZ)(ua.u,{content:(0,z.tZ)((({active:e,payload:t,label:n})=>e?(0,z.BX)("div",{className:"custom-tooltip",children:[(0,z.tZ)("p",{className:"label"}),(0,z.BX)("p",{className:"desc",children:["prob. upgrade",O>=0?"":" (est.)",": ",(100*D).toFixed(1),"%"]}),(0,z.BX)("p",{className:"desc",children:["average increase",M>=0?"":" (est.)",": ",I<=0?"":"+",(100*I/g).toFixed(1),"%"]})]}):null),{}),cursor:!1})]})},e.id),(0,z.tZ)(ue.ZP,{direction:"row",container:!0,spacing:.75,columns:12,children:u.map((([t,n])=>t!==o?(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(ya.Z,{slotKey:t,artifactObj:n})},`${t}_${e.id}`):(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(m.Z,{variant:"contained",style:{height:"100%",width:"100%"},onClick:()=>i(!0),startIcon:(0,z.tZ)(d.Z,{sx:{position:"absolute",width:"70%",height:"70%",left:"50%",top:"50%",transform:"translate(-50%, -50%)",opacity:.7},component:"img",src:Sn.Z.slot[t]}),sx:{minWidth:0}})},`${t}_${e.id}`)))}),(0,z.tZ)("br",{}),(0,z.tZ)("span",{children:"Click above to calculate Exact upgrade distribution"}),(0,z.tZ)("br",{})]})})}function wo(){var e;const{character:t,character:{key:n}}=(0,f.useContext)(S.K),{database:a}=(0,f.useContext)(E.t),{gender:i}=(0,D.Z)(),r=((0,A.Z)(n),(0,$.Z)()),l=(0,f.useMemo)((()=>!a.arts.values.length),[a]),{buildSetting:s,buildSettingDispatch:o}=Gt(n),{optimizationTarget:c,levelLow:Z,levelHigh:p}=s,g=(0,I.Z)(n),{characterSheet:b,target:w}=null!=(e=null==g?void 0:g[n])?e:{},[k,B]=(["xs","sm"].includes((0,yt.Z)()),(0,xt.Z)()),[{threads:j=gt.g},P]=(0,f.useState)(a.displayOptimize.get());(0,f.useEffect)((()=>a.displayOptimize.follow(((e,t)=>P(t)))),[a,P]);const O=(0,f.useDeferredValue)(k),K=(0,f.useDeferredValue)(s),{filteredArts:M,numEquippedUsed:T}=(0,f.useMemo)((()=>{const{mainStatKeys:e,allowLocations:t,artExclusion:i,levelLow:r,levelHigh:l}=O&&K;let s=0;return{filteredArts:a.arts.values.filter((a=>{if(i.includes(a.id))return!1;if(a.level<r)return!1;if(a.level>l)return!1;const o=e[a.slotKey];if(null!=o&&o.length&&!o.includes(a.mainStatKey))return!1;const c=(0,pe.V7)(n);if(a.location&&a.location!==c){if(!t.includes(a.location))return!1;s++}return!0})),numEquippedUsed:s}}),[a,n,O,K]),_=(0,f.useMemo)((()=>(0,Xt.O)(M.map((({id:e})=>e)),(e=>!0))),[M]),[L,G]=(0,f.useState)(void 0),[N,V]=(0,f.useState)(!0),[W,q]=(0,f.useState)(!0),[F,H]=(0,f.useState)(!1),U=(0,f.useCallback)((({query:e,arts:t},n,i)=>{const r=a.arts.values.filter((e=>5===e.rarity)).map((e=>mo(e,20))),l={};r.forEach((e=>l[e.id]=e));const s=t.slice(0,n),o=t.slice(n);let c=0;const d=Math.min(i-n+5,o.length);do{for(;c<d;c++){const t=l[o[c].id];t&&(o[c]=oo(e,t,!0,W))}for(o.sort(fo),c=0;c<d&&"fast"!==o[c].evalMode;c++);}while(c<d);return{query:e,arts:[...s,...o]}}),[a,W]),[Y,J]=(0,f.useState)(0),Q=(0,f.useRef)(null),{artifactsToShow:ee,numPages:te,currentPageIndex:ne,minObj0:ae,maxObj0:ie}=(0,f.useMemo)((()=>{if(!L)return{artifactsToShow:[],numPages:0,toShow:0,minObj0:0,maxObj0:0};const e=Math.ceil(L.arts.length/5),t=(0,Xt.uZ)(Y,0,e-1),n=L.arts.slice(5*t,5*(t+1)),a=n.length>0?n[0].thresholds[0]:0;return{artifactsToShow:n,numPages:e,currentPageIndex:t,minObj0:n.reduce(((e,t)=>Math.min(t.distr.lower,e)),a),maxObj0:n.reduce(((e,t)=>Math.max(t.distr.upper,e)),a)}}),[L,5,Y]),re=(0,f.useCallback)(((e,t)=>{var n;if(!L)return;null==(n=Q.current)||n.scrollIntoView({behavior:"smooth"});const a=U(L,5*(ne+1),5*t);G(a),J(t-1)}),[J,G,Q,ne,5,L,U]),le=(0,f.useCallback)((async()=>{var e,t,r,l;const{statFilters:o,optimizationTarget:c,mainStatKeys:d,levelLow:u,levelHigh:h,artSetExclusion:Z}=s;if(!n||!c)return;const p=await(0,I.V)(a,n,0,[]);if(!p)return;const m=null==(e=(0,bt.Qo)(p.teamData,i,n)[n])?void 0:e.target.data[0];if(!m)return;Object.assign(m,(0,bt.b3)([m,ji]));const f=(0,Xt.Hm)(null!=(t=m.display)?t:{},c);if(!f)return;G(void 0),J(0);const g=Object.entries(o).flatMap((([e,t])=>t.filter((e=>!e.disabled)).map((t=>{var n,a;const i=(0,Xt.Hm)(null!=(n=m.display)?n:{},JSON.parse(e));return{value:i,minimum:"%"===(null==(a=i.info)?void 0:a.unit)?t.value/100:t.value}})))),b=null!=(r=null==(l=a.chars.get(n))?void 0:l.equippedArtifacts)?r:{},v=(0,Xt.O)(R.eV,(e=>{var t;const n=a.arts.get(null!=(t=b[e])?t:"");return n?mo(n):void 0})),x=(0,Xt.O)(R.eV,(e=>{var t,n;const i=a.arts.get(null!=(t=b[e])?t:"");return null!=(n=null==i?void 0:i.setKey)?n:""}));const y=a.arts.values.filter((e=>5===e.rarity)).filter((function(e){const t=Object.assign({},x);t[e.slotKey]=e.setKey;const n={};if(R.eV.forEach((e=>{var a;return n[t[e]]=(null!=(a=n[t[e]])?a:0)+1})),!Object.entries(n).every((([e,t])=>{if(!Z[e])return!0;switch(t){case 0:case 1:return!0;case 2:case 3:return!Z[e].includes(2);case 4:case 5:return!Z[e].includes(4);default:throw Error("error in respectSex: num > 5")}})))return!1;if(!Z.rainbow)return!0;switch(Object.values(n).reduce(((e,t)=>e+t%2),0)){case 0:case 1:return!0;case 2:case 3:return!Z.rainbow.includes(2);case 4:case 5:return!Z.rainbow.includes(4);default:throw Error("error in respectSex: nRainbow > 5")}})).filter((e=>N||20!==e.level)).filter((e=>{var t,n;return!F||!(null!=(t=d[e.slotKey])&&t.length)||(null==(n=d[e.slotKey])?void 0:n.includes(e.mainStatKey))})).filter((e=>!F||u<=e.level&&e.level<=h)).map((e=>mo(e,20))),C={};y.forEach((e=>C[e.id]=e));const k=[f,...g.map((e=>e.value))],B=po((0,vt.tL)(k,m,(({path:[e]})=>"dyn"!==e)),g.map((e=>e.minimum)),v,w);let S=y.map((e=>oo(B,e,!1,W)));S=S.sort(((e,t)=>t.prob*t.upAvg-e.prob*e.upAvg));let X={query:B,arts:S};X=U(X,0,5),G(X),console.log("result",X)}),[s,n,a,i,w,U,N,F,W]),se=(0,f.useMemo)((()=>w&&g&&{data:w,teamData:g}),[w,g]);return(0,z.BX)(d.Z,{display:"flex",flexDirection:"column",gap:1,children:[l&&(0,z.BX)(he.Z,{severity:"warning",variant:"filled",children:[" Opps! It looks like you haven't added any artifacts to GO yet! You should go to the ",(0,z.tZ)(st.Z,{component:v.rU,to:"/artifact",children:"Artifacts"})," page and add some!"]}),se&&(0,z.tZ)(X.R.Provider,{value:se,children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(d.Z,{children:(0,z.tZ)(ht.Z,{characterKey:n,onClickTeammate:r})}),(0,z.tZ)(hn,{})]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:9,display:"flex",flexDirection:"column",gap:1,children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.BX)(ue.ZP,{item:!0,lg:4,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(y.Z,{children:(0,z.BX)(h.Z,{children:[(0,z.tZ)("span",{children:"Optimization Target: "}),(0,z.tZ)(ga.Z,{optimizationTarget:c,setTarget:e=>o({optimizationTarget:e}),disabled:!1})]})}),(0,z.tZ)(y.Z,{children:(0,z.tZ)(h.Z,{children:(0,z.tZ)(wi,{disabled:!1})})}),F&&(0,z.BX)(y.Z,{children:[(0,z.tZ)(h.Z,{sx:{py:1},children:"Artifact Level Filter"}),(0,z.tZ)(dt.Z,{levelLow:Z,levelHigh:p,setLow:e=>o({levelLow:e}),setHigh:e=>o({levelHigh:e}),setBoth:(e,t)=>o({levelLow:e,levelHigh:t}),disabled:!1}),(0,z.tZ)(h.Z,{children:(0,z.tZ)(fi,{disabled:!1,filteredArtIdMap:_})})]})]}),(0,z.BX)(ue.ZP,{item:!0,lg:8,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(y.Z,{children:(0,z.tZ)(h.Z,{children:(0,z.tZ)(ln,{disabled:!1})})}),(0,z.tZ)(y.Z,{children:(0,z.tZ)(h.Z,{children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(m.Z,{startIcon:N?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:N?"success":"secondary",onClick:()=>V(!N),children:"show lvl 20"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(m.Z,{startIcon:W?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:W?"success":"secondary",onClick:()=>q(!W),children:"compute 4th sub"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(m.Z,{startIcon:F?(0,z.tZ)(fe.Z,{}):(0,z.tZ)(ge.Z,{}),color:F?"success":"secondary",onClick:()=>H(!F),children:"enable filters"})})]})})})]})]}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,lg:12,children:(0,z.tZ)(y.Z,{style:{backgroundColor:"red"},children:(0,z.tZ)(h.Z,{style:{backgroundColor:"red"},children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,style:{backgroundColor:"red"},children:[(0,z.tZ)(ue.ZP,{item:!0,style:{backgroundColor:"red"},children:(0,z.tZ)(m.Z,{disabled:!n||!c||!(0,Xt.Hm)(null==w?void 0:w.getDisplay(),c),color:n?"success":"warning",onClick:le,startIcon:(0,z.tZ)(Fs.Z,{}),children:"Calc Upgrade Priority"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(C.Hn,{size:"small"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(C.oX,{size:"small"})})]})})})}),te>1&&(0,z.tZ)(x.Z,{children:(0,z.tZ)(h.Z,{children:(0,z.BX)(ue.ZP,{container:!0,children:[(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(Hs.Z,{count:te,page:ne+1,onChange:re})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(Co,{numShowing:ee.length,total:null==L?void 0:L.arts.length})})]})})}),(0,z.tZ)(ue.ZP,{item:!0,lg:12,spacing:1,children:(0,z.BX)(ue.ZP,{container:!0,display:"flex",flexDirection:"column",gap:1,children:[l&&(0,z.BX)(he.Z,{severity:"info",variant:"filled",children:["Looks like you haven't added any artifacts yet. If you want, there are ",(0,z.tZ)(st.Z,{color:"warning.main",component:v.rU,to:"/scanner",children:"automatic scanners"})," that can speed up the import process!"]}),(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",sx:{width:"100%",height:600,minHeight:5e3}}),children:ee.map((e=>(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:5,sm:4,md:4,lg:3,xl:3,children:(0,z.tZ)(Wn.Z,{artifactId:e.id,editorProps:{}})}),(0,z.tZ)(ue.ZP,{item:!0,xs:7,sm:8,md:8,lg:9,xl:9,children:(0,z.tZ)(yo,{upgradeOpt:e,objMax:ie,objMin:ae})})]},e.id+"asdfsf")))})]})}),te>1&&(0,z.tZ)(x.Z,{children:(0,z.tZ)(h.Z,{children:(0,z.BX)(ue.ZP,{container:!0,children:[(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(Hs.Z,{count:te,page:ne+1,onChange:re})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(Co,{numShowing:ee.length,total:null==L?void 0:L.arts.length})})]})})})]})]})]})})]})}function Co({numShowing:e,total:t}){return(0,z.tZ)(Y.Z,{color:"text.secondary",children:(0,z.BX)(g.cC,{i18nKey:"showingNum",count:e,value:t,children:["Showing ",{count:e}," out of ",{value:t}," Artifacts"]})})}var ko=n(62173);function Bo(){const{character:e}=(0,f.useContext)(S.K),{key:t}=e,n=(0,$.Z)();if(!t.startsWith("Traveler"))return null;const a=pe.UB.find((e=>t.toLowerCase().includes(e)));return a?(0,z.tZ)(Zt.Z,{color:a,title:(0,z.tZ)("strong",{children:(0,ko.el)(`element.${a}`)}),children:R.DZ.map((e=>(0,z.tZ)(ot.Z,{selected:a===e,disabled:a===e,onClick:()=>n((0,R.rq)(t,e)),children:(0,z.tZ)("strong",{children:(0,z.tZ)(te.Z,{color:e,children:(0,ko.el)(`element.${e}`)})})},e)))}):null}var So=n(2247),Xo=n(96608);function jo(){const{t:e}=(0,g.$G)("ui"),{database:t}=(0,f.useContext)(E.t),{character:n}=(0,f.useContext)(S.K),{key:a}=n,{gender:i}=(0,D.Z)(),r=(0,f.useCallback)((()=>t.dbMeta.set({gender:"F"===i?"M":"F"})),[i,t]);return a.startsWith("Traveler")?(0,z.BX)(m.Z,{onClick:r,startIcon:"F"===i?(0,z.tZ)(So.Z,{}):(0,z.tZ)(Xo.Z,{}),children:[(0,z.tZ)("strong",{children:e(`gender.${i}`)}),"  "]}):null}let Po,Oo=e=>e;function Eo(){const e=(0,b.s0)(),{database:t}=(0,f.useContext)(E.t),n=(0,f.useCallback)((()=>e("/characters")),[e]),{characterKey:a}=(0,b.UO)();return!t.chars.keys.includes(a)?(0,z.tZ)(b.Fg,{to:"/characters"}):(0,z.tZ)(d.Z,{my:1,display:"flex",flexDirection:"column",gap:1,children:(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:1e3}),children:a&&(0,z.tZ)(Ko,{characterKey:a,onClose:n})})})}function Ko({characterKey:e,onClose:t}){var n,a,i;const r=(0,M.Z)(e),{gender:l}=(0,D.Z)(),s=(0,O.m)(e,l),o=(0,I.Z)(e),{target:c}=null!=(n=null==o?void 0:o[e])?n:{},{params:{tab:Z="overview"}}=null!=(a=(0,b.bS)({path:"/characters/:charKey/:tab",end:!1}))?a:{params:{tab:"overview"}},{t:p}=(0,g.$G)(["charNames_gen","page_character"]);(0,T.Z)((0,f.useMemo)((()=>`${p(`charNames_gen:${(0,R.LP)(e,l)}`)} - ${p(`page_character:tabs.${Z}`)}`),[p,e,l,Z]));const m=(0,A.Z)(null!=(i=null==r?void 0:r.key)?i:""),v=(0,f.useMemo)((()=>{if(o&&c)return{data:c,teamData:o,oldData:void 0}}),[c,o]),B=(0,f.useMemo)((()=>{if(r&&s)return{character:r,characterSheet:s,characterDispatch:m}}),[r,s,m]),[E,K]=(0,f.useState)(void 0),[L,G]=(0,f.useState)(),$=(0,f.useMemo)((()=>({chartData:E,setChartData:K,graphBuilds:L,setGraphBuilds:G})),[E,L]);return(0,f.useEffect)((()=>{K(void 0),G(void 0)}),[e]),(0,z.tZ)(x.Z,{children:v&&B&&$?(0,z.tZ)(S.K.Provider,{value:B,children:(0,z.tZ)(X.R.Provider,{value:v,children:(0,z.tZ)(P.Provider,{value:$,children:(0,z.tZ)(j.B,{children:(0,z.BX)(h.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.BX)(d.Z,{display:"flex",children:[(0,z.BX)(d.Z,{display:"flex",gap:1,flexWrap:"wrap",flexGrow:1,children:[(0,z.tZ)(V,{}),(0,z.tZ)(Bo,{}),(0,z.tZ)(jo,{}),(0,z.tZ)(Do,{}),(0,z.tZ)(_.J,{}),(0,z.tZ)(Io,{})]}),!!t&&(0,z.tZ)(w.Z,{onClick:t})]}),(0,z.BX)(d.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[r&&(0,z.tZ)(k.Z,{level:r.level,ascension:r.ascension,setBoth:m}),(0,z.tZ)(C.Hn,{size:"small"}),(0,z.tZ)(C.pg,{}),(0,z.tZ)(C.oX,{size:"small"})]}),(0,z.tZ)(y.Z,{children:(0,z.tZ)(Ao,{tab:Z})}),(0,z.tZ)(Mo,{}),(0,z.tZ)(y.Z,{children:(0,z.tZ)(Ao,{tab:Z})})]})})})})}):(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:1e3})})}function Mo(){return(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:500}),children:(0,z.BX)(b.Z5,{children:[(0,z.tZ)(b.AW,{index:!0,element:(0,z.tZ)(cs,{})}),(0,z.tZ)(b.AW,{path:"/talent",element:(0,z.tZ)(Zs,{})}),(0,z.tZ)(b.AW,{path:"/teambuffs",element:(0,z.tZ)(ws,{})}),(0,z.tZ)(b.AW,{path:"/optimize",element:(0,z.tZ)(er,{})}),(0,z.tZ)(b.AW,{path:"/theorycraft",element:(0,z.tZ)(Ls,{})}),(0,z.tZ)(b.AW,{path:"/upopt",element:(0,z.tZ)(wo,{})})]})})}function Ao({tab:e}){const{t}=(0,g.$G)("page_character");return(0,z.BX)(Z.Z,{value:e,variant:"scrollable",allowScrollButtonsMobile:!0,sx:{"& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"}},children:[(0,z.tZ)(p.Z,{sx:{minWidth:"15%"},value:"overview",label:t("tabs.overview"),icon:(0,z.tZ)(a.Z,{}),component:v.rU,to:""}),(0,z.tZ)(p.Z,{sx:{minWidth:"15%"},value:"talent",label:t("tabs.talent"),icon:(0,z.tZ)(i.Z,{}),component:v.rU,to:"talent"}),(0,z.tZ)(p.Z,{sx:{minWidth:"15%"},value:"teambuffs",label:t("tabs.teambuffs"),icon:(0,z.tZ)(r.Z,{}),component:v.rU,to:"teambuffs"}),(0,z.tZ)(p.Z,{sx:{minWidth:"15%"},value:"optimize",label:t("tabs.optimize"),icon:(0,z.tZ)(l.Z,{}),component:v.rU,to:"optimize"}),(0,z.tZ)(p.Z,{sx:{minWidth:"15%"},value:"theorycraft",label:t("tabs.theorycraft"),icon:(0,z.tZ)(s.Z,{}),component:v.rU,to:"theorycraft"}),(0,z.tZ)(p.Z,{sx:{minWidth:"15%"},value:"upopt",label:t("tabs.upgradeopt"),icon:(0,z.tZ)(s.Z,{}),component:v.rU,to:"upopt"})]})}function Do(){const{t:e}=(0,g.$G)("page_character"),[t,n,a]=(0,K.Z)(),{character:{bonusStats:i}}=(0,f.useContext)(S.K),r=Object.keys(i).length;return(0,z.BX)(z.HY,{children:[(0,z.BX)(m.Z,{color:"info",startIcon:(0,z.tZ)(o.Z,{}),onClick:n,children:[e(Po||(Po=Oo`addStats.title`)),!!r&&(0,z.tZ)(B.Z,{sx:{ml:1},color:"success",children:r})]}),(0,z.tZ)(Ve,{open:t,onClose:a})]})}function Io(){const{onModalOpen:e}=(0,f.useContext)(j.M);return(0,z.BX)(z.HY,{children:[(0,z.BX)(m.Z,{color:"info",startIcon:(0,z.tZ)(c.Z,{}),onClick:e,children:["Formulas ","&"," Calcs"]}),(0,z.tZ)(le,{})]})}},79924:(e,t,n)=>{n.d(t,{LG:()=>f,_B:()=>o,dk:()=>c,he:()=>v,s7:()=>x,sk:()=>g});var a=n(40580),i=n(30597),r=n(97797),l=n(36893),s=n(41015);function o(e,t,n,a,i,r){let l=r;const s={pruneNodeRange:!0},o={pruneNodeRange:!0},c={reaffine:!0},p={pruneOrder:!0,pruneArtRange:!0,pruneNodeRange:!0};let m=0;for(;Object.values(l).some((e=>e))&&m++<20;){if(l.pruneOrder){delete l.pruneOrder;const e=u(n,a,i);n!==e&&(n=e,l=Object.assign({},l,s))}if(l.pruneArtRange){delete l.pruneArtRange;const a=h(e,n,t);n!==a&&(n=a,l=Object.assign({},l,o))}if(l.pruneNodeRange){delete l.pruneNodeRange;const t=Z(e,n);e!==t&&(e=t,l=Object.assign({},l,c))}if(l.reaffine){delete l.reaffine;const{nodes:t,arts:a}=d(e,n);e===t&&n===a||(e=t,n=a,l=Object.assign({},l,p))}}return{nodes:e,arts:n}}function c(e,t){const n={};for(const[e,a]of Object.entries(t))a.includes(4)&&(n[e]=a.includes(2)?1:3);return(0,a.uW)(e,(e=>e),(e=>{if("threshold"!==e.operation)return e;const[a,i,l,s]=e.operands;if("read"===a.operation&&"const"===i.operation){const e=a.path[a.path.length-1],o=i.value;if(e in n){if(n[e]<o)return s;if(2===o&&t[e].includes(2))return(0,r.Lj)(a,4,l,s)}}return e}))}function d(e,t,n=!1){const o=new Set,c=new Set;function d(e,t){t?o.add(e):e.operands.forEach((e=>o.has(e)&&c.add(e)))}const u=new Set;if((0,a.aD)(e,(e=>{}),(e=>{const{operation:t}=e;switch(t){case"read":u.add(e.path[1]),d(e,!0);break;case"add":d(e,e.operands.every((e=>o.has(e))));break;case"mul":{const t=e.operands.filter((e=>"const"!==e.operation));d(e,0===t.length||1===t.length&&o.has(t[0]));break}case"const":d(e,!0);break;case"res":case"threshold":case"sum_frac":case"max":case"min":d(e,!1);break;default:(0,s.UT)(t)}})),[...c].every((({operation:e})=>"read"===e||"const"===e))&&Object.keys(t.base).length===u.size)return{nodes:e,arts:t};let h=-1;function Z(){for(;u.has(""+ ++h););return`${h}`}e.forEach((e=>o.has(e)&&c.add(e)));const p=[...c].filter((e=>"const"!==e.operation)),m=new Map(p.map((e=>[e,n||"read"!==e.operation||"dyn"!==e.path[0]?Object.assign({},(0,r.UF)(["dyn",`${Z()}`]),{accu:"add"}):e])));function f(e){const t=(0,i.CG)([...m.keys()],{dyn:(0,s.xh)(e,(e=>(0,r.a9)(e)))},(e=>!0));return Object.fromEntries([...m.values()].map(((e,n)=>[e.path[1],t[n].value])))}const g={nodes:e=(0,a.uW)(e,(e=>{var t;return null!=(t=m.get(e))?t:e}),(e=>e)),arts:{base:f(t.base),values:(0,s.O)(l.eV,(e=>t.values[e].map((({id:e,set:t,values:n})=>({id:e,set:t,values:f(n)})))))}},b=Object.entries(f({}));for(const e of Object.values(g.arts.values))for(const{values:t}of e)for(const[e,n]of b)t[e]-=n;return g}function u(e,t,n){var a;let i=!1;const r=!(null!=(a=n.rainbow)&&a.length),o=Object.keys(e.base),c=new Set(Object.entries(n).filter((([e,t])=>t.length)).map((([e])=>e))),d=new Set(Object.entries(n).filter((([e,t])=>t.includes(2)&&!t.includes(4))).map((([e])=>e))),u=(0,s.O)(l.eV,(n=>{const a=e.values[n],l=a.filter((e=>{let n=0;return a.every((a=>{const i=o.every((t=>{var n,i;return(null!=(n=a.values[t])?n:0)>=(null!=(i=e.values[t])?i:0)})),l=o.some((t=>{var n,i;return(null!=(n=a.values[t])?n:0)>(null!=(i=e.values[t])?i:0)})),s=i&&(l||a.id>e.id),u=r&&!c.has(a.set)&&!d.has(e.set)||e.set===a.set;return s&&u&&n++,n<t}))}));return l.length!==a.length&&(i=!0),l}));return i?{base:e.base,values:u}:e}function h(e,t,n){const a=Object.fromEntries(Object.entries(t.base).map((([e,t])=>[e,{min:t,max:t}]))),i={arts:t};for(;;){const t=(0,s.O)(l.eV,(e=>m(i.arts.values[e]))),r=(0,s.O)(l.eV,(e=>p(Object.entries(t).map((t=>t[0]===e?a:t[1])).filter((e=>e)))));let o=!1;const c=(0,s.O)(l.eV,(t=>{const a=i.arts.values[t].filter((a=>{const i=p([m([a]),r[t]]),l=g(e,i);return e.every(((e,t)=>{var a;return l.get(e).max>=(null!=(a=n[t])?a:-1/0)}))}));return a.length!==i.arts.values[t].length&&(o=!0),a}));if(!o)break;i.arts={base:i.arts.base,values:c}}return i.arts}function Z(e,t){const n=g(e,p([Object.fromEntries(Object.entries(t.base).map((([e,t])=>[e,{min:t,max:t}]))),...Object.values(t.values).map((e=>m(e)))]));return(0,a.uW)(e,(e=>{{const{min:t,max:a}=n.get(e);if(t===a)return(0,r.a9)(t)}const{operation:t}=e,a=e.operands.map((e=>n.get(e)));switch(t){case"threshold":{const[t,n,i,l]=a;if(t.min>=n.max)return e.operands[2];if(t.max<n.min)return e.operands[3];if(i.max===i.min&&l.max===l.min&&i.min===l.min&&isFinite(i.min))return(0,r.a9)(i.max);break}case"min":{const t=e.operands.filter(((e,t)=>{const n=a[t];return a.every(((e,t)=>n.min<=e.max))}));if(t.length<a.length)return(0,r.VV)(...t);break}case"max":{const t=e.operands.filter(((e,t)=>{const n=a[t];return a.every((e=>n.max>=e.min))}));if(t.length<a.length)return(0,r.Fp)(...t);break}}return e}),(e=>e))}function p(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,n])=>{t[e]?(t[e].min+=n.min,t[e].max+=n.max):t[e]=Object.assign({},n)}))})),t}function m(e){const t={};return e.length&&(Object.keys(e[0].values).filter((t=>e.every((e=>e.values[t])))).forEach((n=>t[n]={min:e[0].values[n],max:e[0].values[n]})),e.forEach((({values:e})=>{for(const[n,a]of Object.entries(e))t[n]?(t[n].max<a&&(t[n].max=a),t[n].min>a&&(t[n].min=a)):t[n]={min:0,max:a}}))),t}function f(e){return p([Object.fromEntries(Object.entries(e.base).map((([e,t])=>[e,{min:t,max:t}]))),...Object.values(e.values).map((e=>m(e)))])}function g(e,t){const n=new Map;return(0,a.aD)(e,(e=>{}),(e=>{var a;const{operation:r}=e,l=e.operands.map((e=>n.get(e)));let o;switch(r){case"read":if("dyn"!==e.path[0])throw new Error(`Found non-dyn path ${e.path} while computing range`);o=null!=(a=t[e.path[1]])?a:{min:0,max:0};break;case"const":o=b([e.value]);break;case"add":case"min":case"max":o={min:i.aj[r](l.map((e=>e.min))),max:i.aj[r](l.map((e=>e.max)))};break;case"res":o={min:i.aj[r]([l[0].max]),max:i.aj[r]([l[0].min])};break;case"mul":o=l.reduce(((e,t)=>b([e.min*t.min,e.min*t.max,e.max*t.min,e.max*t.max])));break;case"threshold":o=l[0].min>=l[1].max?l[2]:l[0].max<l[1].min?l[3]:b([],[l[2],l[3]]);break;case"sum_frac":{const[e,t]=l,n={min:e.min+t.min,max:e.max+t.max};o=n.min<=0&&n.max>=0?e.min<=0&&e.max>=0?{min:NaN,max:NaN}:{min:-1/0,max:1/0}:b([e.min/n.min,e.min/n.max,e.max/n.min,e.max/n.max]);break}default:(0,s.UT)(r)}n.set(e,o)})),n}function b(e,t=[]){const n=Math.max(...e,...t.map((e=>e.max)));return{min:Math.min(...e,...t.map((e=>e.min))),max:n}}function v(e,t){return e.flatMap((e=>e)).sort(((e,t)=>t.value-e.value)).slice(0,t)}function x(e){let t=.01,n=new Set(e.flatMap((e=>Object.values(e).map((e=>Math.round(e.plot/t))))));for(;n.size>1500;)t*=2,n=new Set([...n].map((e=>Math.round(e/2))));const a={};for(const n of e)for(const e of Object.values(n)){const n=Math.round(e.plot/t)*t;(!a[n]||a[n].value<e.value)&&(a[n]=e)}return a}},47452:(e,t,n)=>{n.d(t,{IK:()=>r,s_:()=>i,uz:()=>l});var a=n(60467);function i(e){const t=new Set(Object.keys(e.base));Object.values(e.values).forEach((e=>{e.forEach((e=>{e.set&&t.add(e.set),Object.keys(e.values).forEach((e=>t.add(e)))}))}));const n=[...t],i=[...n.filter((e=>!a.Gt.includes(e))),...n.filter((e=>a.Gt.includes(e)))];return{keys:i,baseLinBuf:[],base:i.map((t=>{var n;return null!=(n=e.base[t])?n:0})),values:{flower:e.values.flower.map((({id:e,set:t,values:n})=>({id:e,set:t,values:i.map((e=>{var a;return null!=(a=n[e])?a:e===t?1:0})),linBuf:[]}))),plume:e.values.plume.map((({id:e,set:t,values:n})=>({id:e,set:t,values:i.map((e=>{var a;return null!=(a=n[e])?a:e===t?1:0})),linBuf:[]}))),sands:e.values.sands.map((({id:e,set:t,values:n})=>({id:e,set:t,values:i.map((e=>{var a;return null!=(a=n[e])?a:e===t?1:0})),linBuf:[]}))),goblet:e.values.goblet.map((({id:e,set:t,values:n})=>({id:e,set:t,values:i.map((e=>{var a;return null!=(a=n[e])?a:e===t?1:0})),linBuf:[]}))),circlet:e.values.circlet.map((({id:e,set:t,values:n})=>({id:e,set:t,values:i.map((e=>{var a;return null!=(a=n[e])?a:e===t?1:0})),linBuf:[]})))}}}function r(e){const t=[...e.base],n=[...e.base],a=[...e.baseLinBuf],i=[...e.baseLinBuf];return Object.values(e.values).forEach((e=>{const r=function(e){if(0===e.length)return{lower:[],upper:[],minw:[],maxw:[]};const t=[...e[0].values],n=[...e[0].values],a=[...e[0].linBuf],i=[...e[0].linBuf];for(let r=1;r<e.length;r++){for(let a=0;a<t.length;a++)t[a]=Math.min(t[a],e[r].values[a]),n[a]=Math.max(n[a],e[r].values[a]);for(let t=0;t<a.length;t++)a[t]=Math.min(a[t],e[r].linBuf[t]),i[t]=Math.max(i[t],e[r].linBuf[t])}return{lower:t,upper:n,minw:a,maxw:i}}(e);for(let e=0;e<t.length;e++)t[e]+=r.lower[e],n[e]+=r.upper[e];for(let e=0;e<a.length;e++)a[e]+=r.minw[e],i[e]+=r.maxw[e]})),{lower:t,upper:n,minLinBuf:a,maxLinBuf:i}}function l(e,t){e.baseLinBuf=t.map((({$c:t,weights:n})=>t+n.reduce(((t,n,a)=>t+n*e.base[a]),0))),Object.values(e.values).forEach((e=>e.forEach((e=>e.linBuf=t.map((({weights:t})=>t.reduce(((t,n,a)=>t+n*e.values[a]),0)))))))}}}]);