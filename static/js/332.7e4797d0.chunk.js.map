{"version":3,"file":"static/js/332.7e4797d0.chunk.js","mappings":"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","sources":["PageCharacter/CharacterSelectionModal.tsx"],"sourcesContent":["import { Box, CardActionArea, CardContent, Divider, Grid, TextField, Tooltip, tooltipClasses, TooltipProps, Typography, styled } from \"@mui/material\";\nimport { ChangeEvent, useContext, useDeferredValue, useEffect, useMemo, useState } from \"react\";\nimport { useTranslation } from \"react-i18next\";\nimport CardDark from \"../Components/Card/CardDark\";\nimport CardLight from \"../Components/Card/CardLight\";\nimport CharacterCard from \"../Components/Character/CharacterCard\";\nimport CloseButton from \"../Components/CloseButton\";\nimport ModalWrapper from \"../Components/ModalWrapper\";\nimport SortByButton from \"../Components/SortByButton\";\nimport SqBadge from \"../Components/SqBadge\";\nimport { StarsDisplay } from \"../Components/StarDisplay\";\nimport ElementToggle from \"../Components/ToggleButton/ElementToggle\";\nimport WeaponToggle from \"../Components/ToggleButton/WeaponToggle\";\nimport { DataContext } from \"../Context/DataContext\";\nimport CharacterSheet from \"../Data/Characters/CharacterSheet\";\nimport { ascensionMaxLevel } from \"../Data/LevelData\";\nimport { DatabaseContext } from \"../Database/Database\";\nimport useCharacter from \"../ReactHooks/useCharacter\";\nimport useDBMeta from \"../ReactHooks/useDBMeta\";\nimport useForceUpdate from \"../ReactHooks/useForceUpdate\";\nimport usePromise from \"../ReactHooks/usePromise\";\nimport { ICachedCharacter } from \"../Types/character\";\nimport { allCharacterKeys, CharacterKey } from \"../Types/consts\";\nimport { characterFilterConfigs, characterSortConfigs, CharacterSortKey, characterSortMap } from \"../Util/CharacterSort\";\nimport { filterFunction, sortFunction } from \"../Util/SortByFilters\";\n\ntype characterFilter = (character: ICachedCharacter | undefined, sheet: CharacterSheet) => boolean\n\ntype CharacterSelectionModalProps = {\n  show: boolean,\n  newFirst?: boolean\n  onHide: () => void,\n  onSelect?: (ckey: CharacterKey) => void,\n  filter?: characterFilter\n}\nconst sortKeys = Object.keys(characterSortMap)\nexport default function CharacterSelectionModal({ show, onHide, onSelect, filter = () => true, newFirst = false }: CharacterSelectionModalProps) {\n  const { t } = useTranslation([\"page_character\", \"charNames_gen\"])\n  const { database } = useContext(DatabaseContext)\n  const [state, setState] = useState(() => database.displayCharacter.get())\n  useEffect(() => database.displayCharacter.follow((r, s) => setState(s)), [database, setState])\n\n  const characterSheets = usePromise(() => CharacterSheet.getAll, [])\n\n  const [dbDirty, forceUpdate] = useForceUpdate()\n\n  // character favorite updater\n  useEffect(() => database.charMeta.followAny(s => forceUpdate()), [forceUpdate, database])\n\n  const [searchTerm, setSearchTerm] = useState(\"\")\n  const deferredSearchTerm = useDeferredValue(searchTerm)\n  const deferredState = useDeferredValue(state)\n  const deferredDbDirty = useDeferredValue(dbDirty)\n  const characterKeyList = useMemo(() => {\n    if (!characterSheets) return []\n    const { element, weaponType, sortType, ascending } = deferredState\n    const sortByKeys = [...(newFirst ? [\"new\"] : []), ...(characterSortMap[sortType] ?? [])] as CharacterSortKey[]\n    return deferredDbDirty && allCharacterKeys\n      .filter(key => filter(database.chars.get(key), characterSheets[key]))\n      .filter(filterFunction({ element, weaponType, name: deferredSearchTerm }, characterFilterConfigs(database, characterSheets)))\n      .sort(sortFunction(sortByKeys, ascending, characterSortConfigs(database, characterSheets), [\"new\", \"favorite\"]))\n  }, [database, newFirst, deferredState, characterSheets, deferredDbDirty, deferredSearchTerm, filter])\n\n  if (!characterSheets) return null\n\n  const { weaponType, element, sortType, ascending } = state\n\n  return <ModalWrapper open={show} onClose={onHide} sx={{ \"& .MuiContainer-root\": { justifyContent: \"normal\" } }}>\n    <CardDark>\n      <CardContent sx={{ py: 1, display: \"flex\", alignItems: \"center\", gap: 1, flexWrap: \"wrap\" }}>\n        <WeaponToggle sx={{ height: \"100%\" }} onChange={weaponType => database.displayCharacter.set({ weaponType })} value={weaponType} size=\"small\" />\n        <ElementToggle sx={{ height: \"100%\" }} onChange={element => database.displayCharacter.set({ element })} value={element} size=\"small\" />\n        <Box flexGrow={1}>\n          <TextField\n            autoFocus\n            value={searchTerm}\n            onChange={(e: ChangeEvent<HTMLTextAreaElement>) => setSearchTerm(e.target.value)}\n            label={t(\"characterName\")}\n            size=\"small\"\n            sx={{ height: \"100%\" }}\n            InputProps={{\n              sx: { height: \"100%\" }\n            }}\n          />\n        </Box>\n        <SortByButton sx={{ height: \"100%\" }}\n          sortKeys={sortKeys} value={sortType} onChange={sortType => database.displayCharacter.set({ sortType })}\n          ascending={ascending} onChangeAsc={ascending => database.displayCharacter.set({ ascending })} />\n        <CloseButton onClick={onHide} />\n      </CardContent>\n      <Divider />\n      <DataContext.Provider value={{ teamData: undefined } as any}>\n        <CardContent><Grid container spacing={1} columns={{ xs: 2, sm: 3, md: 4, lg: 5, }}>\n          {characterKeyList.map(characterKey => <Grid item key={characterKey} xs={1} >\n            {/* <CharacterCard key={characterKey} hideStats characterKey={characterKey} onClick={() => { onHide(); onSelect?.(characterKey) }} /> */}\n            <SelectionCard characterKey={characterKey} onClick={() => { onHide(); onSelect?.(characterKey) }} />\n          </Grid>)}\n        </Grid></CardContent>\n      </DataContext.Provider>\n    </CardDark>\n  </ModalWrapper>\n}\n\nconst CustomTooltip = styled(({ className, ...props }: TooltipProps) => (\n  <Tooltip {...props} classes={{ popper: className }} />\n))({\n  [`& .${tooltipClasses.tooltip}`]: {\n    padding: 0,\n  },\n});\n\nfunction SelectionCard({ characterKey, onClick }: { characterKey: CharacterKey, onClick: () => void }) {\n  const { gender } = useDBMeta()\n  const characterSheet = usePromise(() => CharacterSheet.get(characterKey, gender), [characterKey, gender])\n  const character = useCharacter(characterKey)\n  const { level = 1, ascension = 0, constellation = 0 } = character ?? {}\n  return <CustomTooltip enterDelay={300} enterNextDelay={300} arrow placement=\"bottom\" title={\n    <Box sx={{ width: 300 }}>\n      <CharacterCard hideStats characterKey={characterKey} />\n    </Box>\n  }>\n    <Box>\n      <CardLight sx={{ flexGrow: 1, display: \"flex\", flexDirection: \"column\" }}>\n        <CardActionArea onClick={onClick}>\n          <Box display=\"flex\"\n            position=\"relative\"\n            className={`grad-${characterSheet?.rarity}star`}\n            sx={{\n              \"&::before\": {\n                content: '\"\"',\n                display: \"block\", position: \"absolute\",\n                left: 0, top: 0,\n                width: \"100%\", height: \"100%\",\n                opacity: 0.5,\n                backgroundImage: `url(${characterSheet?.bannerImg})`, backgroundPosition: \"center\", backgroundSize: \"cover\",\n              }\n            }}\n            width=\"100%\" >\n            <Box flexShrink={1} sx={{ maxWidth: { xs: \"33%\", lg: \"30%\" } }} alignSelf=\"flex-end\" display=\"flex\" flexDirection=\"column\" zIndex={1}>\n              <Box\n                component=\"img\"\n                src={characterSheet?.thumbImg}\n                width=\"100%\"\n                height=\"auto\"\n                maxWidth={256}\n                sx={{ mt: \"auto\" }}\n              />\n            </Box>\n            <Box flexGrow={1} sx={{ pr: 1 }} display=\"flex\" flexDirection=\"column\" zIndex={1} justifyContent=\"space-evenly\">\n              <Typography variant=\"body2\" ><SqBadge color={characterSheet?.elementKey} sx={{ opacity: 0.85, textShadow: \"0 0 5px gray\" }}>{characterSheet?.name}</SqBadge></Typography>\n              {character ? <Box sx={{ display: \"flex\", gap: 1, alignItems: \"center\" }}>\n                <Box sx={{ textShadow: \"0 0 5px gray\" }}>\n                  <Typography variant=\"body2\" component=\"span\" whiteSpace=\"nowrap\" >Lv. {level}</Typography>\n                  <Typography variant=\"body2\" component=\"span\" color=\"text.secondary\">/{ascensionMaxLevel[ascension]}</Typography>\n                </Box>\n                <Typography variant=\"body2\" >C{constellation}</Typography>\n              </Box> : <Typography component=\"span\" variant=\"body2\" ><SqBadge>NEW</SqBadge></Typography>}\n              <Typography variant=\"body2\" ><StarsDisplay stars={characterSheet?.rarity ?? 1} colored /></Typography>\n            </Box>\n          </Box>\n        </CardActionArea>\n      </CardLight>\n    </Box>\n  </CustomTooltip>\n}\n"],"names":["sortKeys","Object","keys","characterSortMap","CharacterSelectionModal","show","onHide","onSelect","filter","newFirst","t","useTranslation","database","useContext","DatabaseContext","useState","displayCharacter","get","state","setState","useEffect","follow","r","s","characterSheets","usePromise","CharacterSheet","useForceUpdate","dbDirty","forceUpdate","charMeta","followAny","searchTerm","setSearchTerm","deferredSearchTerm","useDeferredValue","deferredState","deferredDbDirty","characterKeyList","useMemo","element","weaponType","sortType","ascending","sortByKeys","allCharacterKeys","key","chars","filterFunction","name","characterFilterConfigs","sort","sortFunction","characterSortConfigs","open","onClose","sx","justifyContent","py","display","alignItems","gap","flexWrap","height","onChange","set","value","size","flexGrow","autoFocus","e","target","label","InputProps","onChangeAsc","onClick","teamData","undefined","container","spacing","columns","xs","sm","md","lg","map","characterKey","item","SelectionCard","CustomTooltip","styled","className","props","classes","popper","tooltipClasses","padding","gender","useDBMeta","characterSheet","character","useCharacter","level","ascension","constellation","enterDelay","enterNextDelay","arrow","placement","title","width","hideStats","flexDirection","position","rarity","content","left","top","opacity","backgroundImage","bannerImg","backgroundPosition","backgroundSize","flexShrink","maxWidth","alignSelf","zIndex","component","src","thumbImg","mt","pr","variant","color","elementKey","textShadow","whiteSpace","ascensionMaxLevel","stars","colored"],"sourceRoot":""}