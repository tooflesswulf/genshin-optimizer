(()=>{"use strict";var e,t,n={40580:(e,t,n)=>{n.d(t,{Gd:()=>a,aD:()=>s,uW:()=>o});var r=n(97797);function s(e,t,n){const r=new Set,s=new Set;e.forEach((function e(o){s.has(o)||(r.has(o)?console.error("Found cyclical dependency during formula traversal"):(r.add(o),t(o),o.operands.forEach(e),n(o),r.delete(o),s.add(o)))}))}function o(e,t,n){const s=new Set,o=new Map,a=new Map;function l(e){let u=o.get(e);if(u)return u;u=t(e);let c=a.get(u);return c||(s.has(u)?(console.error("Found cyclical dependency during formula mapping"),(0,r.a9)(NaN)):(s.add(u),c=n(function(e){const t=e.operands.map(l);return i(t,e.operands)?e:Object.assign({},e,{operands:t})}(u),e),s.delete(u),o.set(e,c),a.set(u,c),c))}const u=e.map(l);return i(u,e)?e:u}function a(e,t,n){const r=new Map;function s(e,t){let o=r.get(t);o||r.set(t,o=[new Set,new Map]);const[a,i]=o,l=i.get(e);if(l)return l;if(a.has(e))throw new Error("Found cyclical dependency during formula mapping");a.add(e);const u=n(e,t,s);return i.set(e,u),a.delete(e),u}return e.map((e=>s(e,t)))}function i(e,t){return void 0===e?void 0===t:void 0!==t&&(e.length===t.length&&e.every(((e,n)=>e===t[n])))}},30597:(e,t,n)=>{n.d(t,{I3:()=>c,aj:()=>i,tL:()=>u});var r=n(41015),s=n(40580),o=n(97797);const a={min:e=>Math.min(...e),max:e=>Math.max(...e),add:e=>e.reduce(((e,t)=>e+t),0),mul:e=>e.reduce(((e,t)=>e*t),1)},i=Object.assign({},a,{res:([e])=>e<0?1-e/2:e>=.75?1/(4*e+1):1-e,sum_frac:e=>e[0]/e.reduce(((e,t)=>e+t)),threshold:([e,t,n,r])=>e>=t?n:r}),l=new Set(Object.keys(a));function u(e,t,n=(e=>!1)){let r=h(e,t,n);return r=p(r),m(r)}function c(e,t,n,o){let a='\n"use strict";\n// copied from the code above\nfunction res(res) {\n  if (res < 0) return 1 - res / 2\n  else if (res >= 0.75) return 1 / (res * 4 + 1)\n  return 1 - res\n}\nconst x0=0',i=1;const l=new Map;return(0,s.aD)(e,(e=>{}),(e=>{const{operation:s,operands:u}=e,c="x"+i++,p=u.map((e=>l.get(e)));switch(l.set(e,c),s){case"read":{const r=n(e);let s=new Array(o).fill(null).map(((e,t)=>`(b[${t}].values["${r}"] ?? 0)`));t[r]&&0!==t[r]&&(s=[t[r].toString(),...s]),a+=`,${c}=${s.join("+")}`;break}case"const":l.set(e,`(${e.value})`);break;case"add":case"mul":a+=`,${c}=${p.join("add"===s?"+":"*")}`;break;case"min":case"max":a+=`,${c}=Math.${s}(${p})`;break;case"threshold":{const[e,t,n,r]=p;a+=`,${c}=(${e}>=${t})?${n}:${r}`;break}case"res":a+=`,${c}=res(${p[0]})`;break;case"sum_frac":a+=`,${c}=${p[0]}/(${p[0]}+${p[1]})`;break;default:(0,r.UT)(s)}})),a+=`;\nreturn [${e.map((e=>l.get(e)))}]`,new Function("b",a)}function p(e){return(0,s.uW)(e,(e=>e),(e=>{let t=e;if(l.has(e.operation)){const n=e,{operation:r}=n;let s=!1;const o=n.operands.flatMap((e=>e.operation===r?(s=!0,e.operands):[e]));t=s?Object.assign({},n,{operands:o}):n}return t}))}function m(e){function t(e){const t=new Map;for(const r of e){var n;t.set(r,(null!=(n=t.get(r))?n:0)+1)}return t}const n={common:{counts:new Map,formulas:new Set,operation:"add"}};for(;;){let o;const i={operation:n.common.operation,operands:(r=n.common.counts,[...r].flatMap((([e,t])=>Array(t).fill(e))))},u=new Map;for(const e of Object.keys(a))u.set(e,[]);if(e=(0,s.uW)(e,(e=>{if(n.common.formulas.has(e)){const t=e,r=new Map(n.common.counts),s=t.operands.filter((e=>{const t=r.get(e);return!t||(r.set(e,t-1),!1)}));return s.length?(s.push(i),Object.assign({},t,{operands:s})):i}return e}),(e=>{if(!l.has(e.operation))return e;const n=e;if(o){if(o.operation===n.operation){const e=t(n.operands),s=new Map,a=o.counts;let i=0;for(const[t,n]of e.entries()){var r;const e=Math.min(n,null!=(r=a.get(t))?r:0);e?(s.set(t,e),i+=e):s.delete(t)}i>1&&(o.counts=s,o.formulas.add(n))}}else{const e=u.get(n.operation),r=t(n.operands);for(const[t,a]of e){let e=0;const i=new Map;for(const[t,n]of a.entries()){var s;const o=Math.min(n,null!=(s=r.get(t))?s:0);o&&(i.set(t,o),e+=o)}if(e>1){o={counts:i,formulas:new Set([n,t]),operation:n.operation},u.clear();break}}o||e.push([n,r])}return n})),!o)break;n.common=o}var r;return e}function h(e,t,n=(e=>!1)){const a={data:[],processed:new Map},l=new Map([[a,new Map]]),u={data:[t],processed:new Map};return l.set(u,new Map),l.get(a).set(t,u),(0,s.Gd)(e,u,((e,t,s)=>{const{operation:u}=e,c=(e,t)=>s(e,t),p=(e,t)=>s(e,t);let m;switch(u){case"const":m=e;break;case"add":case"mul":case"max":case"min":{var h;const n=i[u],r=[],s=e.operands.filter((e=>{const n=c(e,t);return"const"!==n.operation||(r.push(n.value),!1)})).map((e=>c(e,t))),a=n(r);if(isFinite(a)){if("mul"===u&&0===a){m=(0,o.a9)(a);break}}else if("mul"!==u&&("max"!==u||a>0)&&("min"!==u||a<0)){m=(0,o.a9)(a);break}a!==n([])&&s.push((0,o.a9)(a)),m=s.length<=1?null!=(h=s[0])?h:(0,o.a9)(n([])):{operation:u,operands:s};break}case"res":case"sum_frac":{const n=e.operands.map((e=>c(e,t))),r=i[u];m=n.every((e=>"const"===e.operation))?(0,o.a9)(r(n.map((e=>e.value)))):Object.assign({},e,{operands:n});break}case"lookup":{const n=p(e.operands[0],t);if("const"===n.operation){var f;const r=null!=(f=e.table[n.value])?f:e.operands[1];if(r){m=s(r,t);break}}throw new Error(`Unsupported ${u} node while folding`)}case"prio":{const n=e.operands.find((e=>{const n=p(e,t);if("const"!==n.operation)throw new Error(`Unsupported ${u} node while folding`);return void 0!==n.value}));m=n?p(n,t):(0,o.a9)(void 0);break}case"small":{var d;let n;for(const r of e.operands){var b;const e=p(r,t);if("const"!==e.operation)throw new Error(`Unsupported ${u} node while folding`);(void 0===(null==(b=n)?void 0:b.value)||void 0!==e.value&&e.value<n.value)&&(n=e)}m=null!=(d=n)?d:(0,o.a9)(void 0);break}case"match":{const[n,r,o,a]=e.operands.map((e=>s(e,t)));if("const"!==n.operation||"const"!==r.operation)throw new Error(`Unsupported ${u} node while folding`);m=n.value===r.value?o:a;break}case"threshold":{const[n,r,o,a]=e.operands.map((e=>s(e,t)));m="const"===o.operation&&"const"===a.operation&&o.value===a.value?o:"const"===n.operation&&"const"===r.operation?n.value>=r.value?o:a:Object.assign({},e,{operands:[n,r,o,a]});break}case"subscript":{const n=c(e.operands[0],t);if("const"!==n.operation)throw new Error("Found non-constant subscript node while folding");m=(0,o.a9)(e.list[n.value]);break}case"read":{const a=t.data.map((t=>(0,r.Hm)(t,e.path))).filter((e=>e));if(0===a.length)if(n(e)){const{accu:t}=e;m=void 0===t||"small"===t?"string"===e.type?(0,o.a9)(void 0):(0,o.a9)(NaN):(0,o.a9)(i[t]([]))}else m=e;else m=void 0===e.accu||1===a.length?s(a[a.length-1],t):s({operation:e.accu,operands:a},t);break}case"data":{e.reset&&(t=a);const n=l.get(t);let r=n.get(e.data);r||(r={data:[...t.data,e.data],processed:new Map},l.set(r,new Map),n.set(e.data,r)),m=s(e.operands[0],r);break}default:(0,r.UT)(u)}return m.info&&(m=Object.assign({},m),delete m.info),m}))}},97797:(e,t,n)=>{n.d(t,{Lj:()=>i,Sm:()=>o,WV:()=>a,a9:()=>r});r(NaN,{name:"TODO"}),s(1),s(0),r("none");function r(e,t){return"number"==typeof e?{operation:"const",operands:[],type:"number",value:e,info:t}:{operation:"const",operands:[],type:"string",value:e,info:t}}function s(e,t){return e>=Number.MAX_VALUE/100&&(e=1/0),e<=-Number.MAX_VALUE/100&&(e=-1/0),r(e,Object.assign({unit:"%"},t))}function o(...e){return{operation:"add",operands:l(e)}}function a(...e){return{operation:"mul",operands:l(e)}}function i(e,t,n,r,s){return{operation:"threshold",operands:[u(e),u(t),u(n),u(r)],info:s}}function l(e){return e.map((e=>"object"==typeof e?e:r(e)))}function u(e){return"object"!=typeof e?r(e):e}},96064:(e,t,n)=>{var r=n(79924),s=n(30597),o=n(60467),a=n(41015),i=n(47452);function l(e){return e.reduce(((e,{filter:t})=>e+o.Ex.reduce(((e,n)=>e*t[n].length),1)),0)}function u(e){if(0===e.length)return{lower:[],upper:[],minLinBuf:[],maxLinBuf:[]};const t={lower:[...e[0].lower],upper:[...e[0].upper],minLinBuf:[...e[0].minLinBuf],maxLinBuf:[...e[0].maxLinBuf]};return e.forEach((({lower:e,upper:n,maxLinBuf:r,minLinBuf:s})=>{for(let r=0;r<e.length;r++)t.lower[r]=Math.min(e[r],t.lower[r]),t.upper[r]=Math.max(n[r],t.upper[r]);for(let e=0;e<s.length;e++)t.minLinBuf[e]=Math.min(s[e],t.minLinBuf[e]),t.maxLinBuf[e]=Math.max(r[e],t.maxLinBuf[e])})),t}function c(e,t){t.forEach((t=>{const n=(0,i.w7)(e,t.filter),{minLinBuf:r,maxLinBuf:s}=(0,i.IK)(n);t.minLinBuf=r,t.maxLinBuf=s}))}var p=n(40580),m=n(97797);function h(e,t){const n=Object.entries(t).filter((([,{min:e,max:t}])=>e===t)).map((([e])=>e));return(0,p.uW)(e,(e=>e),(e=>{switch(e.operation){case"add":return function(e){if(1===e.length)return e[0];const t=(e=e.flatMap((e=>"add"===e.operation?e.operands:e))).reduce(((e,t)=>"const"===t.operation?e+t.value:e),0);return 0===(e=e.filter((e=>"const"!==e.operation))).length?(0,m.a9)(t):0===t?1===e.length?e[0]:(0,m.Sm)(...e):(0,m.Sm)(...e,(0,m.a9)(t))}(e.operands);case"mul":return function(e){if(1===e.length)return e[0];const t=(e=e.flatMap((e=>"mul"===e.operation?e.operands:e))).reduce(((e,t)=>"const"===t.operation?e*t.value:e),1);return 0===(e=e.filter((e=>"const"!==e.operation))).length?(0,m.a9)(t):1===t?(0,m.WV)(...e):(0,m.WV)(...e,(0,m.a9)(t))}(e.operands);case"read":return n.includes(e.path[1])?(0,m.a9)(t[e.path[1]].min):e;case"threshold":{const[n,r,s,o]=e.operands;if("const"===n.operation&&"const"===r.operation)return n.value>=r.value?s:o;if("read"===n.operation&&"const"===r.operation){const a=t[n.path[1]];if(!a)return e;if(a.min>=r.value)return s;if(a.max<r.value)return o}return e}case"min":case"max":case"res":case"sum_frac":if(e.operands.every((e=>"const"===e.operation))){const t=s.aj[e.operation](e.operands.map((e=>"const"===e.operation?e.value:NaN)));return(0,m.a9)(t)}return e;default:return e}}))}class f{constructor({arts:e,artsVec:t,targetIxs:n,nodes:r,minimums:o,topN:a,artSetExclusion:i},l){this.builds=[],this.buildValues=void 0,this.plotData=void 0,this.threshold=-1/0,this.topN=void 0,this.exclusion=void 0,this.arts=void 0,this.artsVec=void 0,this.objIx=void 0,this.plotIx=void 0,this.nodes=void 0,this.min=void 0,this.callback=void 0,this.arts=e,this.artsVec=t,this.topN=a,this.callback=l,this.nodes=r,this.min=o,this.exclusion=i,this.objIx=n[0],n.length>1&&(this.plotData={},this.plotIx=n[1]),this.nodes=(0,s.tL)(this.nodes,{},(e=>!1))}setThreshold(e){this.threshold=Math.max(this.threshold,e)}enumerate(e){const{min:t,objIx:n,plotIx:r,exclusion:i}=this,l=this,c=this.arts,p=this.builds.length,{lower:m,upper:f}=u(e),d=Object.fromEntries(this.artsVec.keys.map(((e,t)=>[e,{min:m[t],max:f[t]}])));let b=this.nodes;b=h(b,d),b=(0,s.tL)(b,{},(e=>!1));const v=(0,s.I3)(b,c.base,(e=>e.path[1]),5),g=e.map((e=>Object.values(function(e,{filter:t}){return{base:e.base,values:(0,a.O)(o.Ex,(n=>t[n].map((t=>e.values[n][t]))))}}(c,e).values).sort(((e,t)=>e.length-t.length)))),w=Array(5),x={tested:0,failed:0,skipped:0};function k(e,s,o){if(s<0){const e=v(w);if(t.some(((t,n)=>t>e[n]))||!function(e,t){if(!Object.entries(e).every((([e,n])=>!t[e]||!t[e].includes(n))))return!1;if(!t.uniqueKey)return!0;const n=Object.values(e).reduce(((e,t)=>e+t%2),0);return!t.uniqueKey.includes(n)}(o,i))return void x.failed++;const s=e[n],{builds:a,plotData:u,threshold:c}=l;let p;if(s>=c&&(p={value:s,artifactIds:w.map((e=>e.id))},a.push(p)),void 0!==r&&u){const t=e[r],n=u[t];(!n||n.value<s)&&(p||(p={value:s,artifactIds:w.map((e=>e.id)).filter((e=>e))}),p.plot=t,u[t]=p)}}else g[e][s].forEach((t=>{var n,r,a,i,l,u;w[s]=t,o[null!=(n=t.set)?n:""]=1+(null!=(r=o[null!=(a=t.set)?a:""])?r:0),k(e,s-1,o),o[null!=(i=t.set)?i:""]-=1,0===o[null!=(l=t.set)?l:""]&&delete o[null!=(u=t.set)?u:""]})),0===s&&(x.tested+=g[e][s].length,x.tested>65536&&l.interimReport(x))}for(let e=0;e<g.length;e++)w.fill({id:"",values:{}}),k(e,g[e].length-1,{});this.interimReport(x,this.builds.length>p)}refresh(e){const{topN:t}=this;var n;(this.plotData&&Object.keys(this.plotData).length>=1e5&&(this.plotData=(0,r.s7)([this.plotData])),this.builds.length>=1e3||e)&&(this.builds=this.builds.sort(((e,t)=>t.value-e.value)).slice(0,t),this.buildValues=this.builds.map((e=>e.value)),this.threshold=Math.max(this.threshold,null!=(n=this.buildValues[t-1])?n:-1/0))}interimReport(e,t=!1){this.refresh(t),this.callback(Object.assign({resultType:"interim",buildValues:this.buildValues},e)),this.buildValues=void 0,e.tested=0,e.failed=0,e.skipped=0}}var d=n(14613),b=n(42652);function v(e,t){const n=(0,d.Zk)(e,t),{lower:r,upper:s,keys:o}=t;return g(n,Object.fromEntries(o.map(((e,t)=>[e,{min:r[t],max:s[t]}])))).map((e=>({$c:e.$c,weights:o.map((t=>{var n;return null!=(n=e[t])?n:0}))})))}function g(e,t){try{return e.map((e=>function(...e){const t={$c:0};for(const[r,s]of e)for(const[e,o]of Object.entries(s)){var n;t[e]=(null!=(n=t[e])?n:0)+r*o}return t}(...e.map((e=>{const n=e.terms.map((e=>t[e])),{w:r,$c:s}=function(e,t="upper"){if(0===e.length)return{w:[],$c:1,err:0};const n=e.length,r=e.map((({min:e,max:t})=>Math.max(-e,t))),s=r.reduce(((e,t)=>e*t),1);e=e.map((({min:e,max:t},n)=>({min:e/r[n],max:t/r[n]})));const o=(0,a.Og)(...e.map((({min:e,max:t})=>[e,t]))).flatMap((e=>{const r=e.reduce(((e,t)=>e*t),1),s=e.reduce(((e,t)=>e+t),0);switch(t){case"upper":return[[...e,-1,0,s-r-n],[...e.map((e=>-e)),1,-1,n+r-s]];case"lower":return[[...e.map((e=>-e)),-1,0,r-s-n],[...e,1,-1,n+s-r]];default:(0,a.UT)(t)}})),i=[...e.map((e=>0)),0,1];try{const e=(0,b.A)(i,o);switch(t){case"upper":return{w:e.slice(0,n).map(((e,t)=>(1-e)*s/r[t])),$c:s*(e[n]-n),err:s*e[n+1]};case"lower":return{w:e.slice(0,n).map(((e,t)=>(1-e)*s/r[t])),$c:s*(n-e[n]),err:s*e[n+1]};default:(0,a.UT)(t)}}catch(t){throw console.log("ERROR on bounds",e),console.log("Possibly numerical instability issue."),console.log(t),t}}(n,e.$k>=0?"upper":"lower"),o={$c:s};return e.terms.forEach(((e,t)=>{var n;return o[e]=r[t]+(null!=(n=o[e])?n:0)})),[e.$k,o]})))))}catch(n){throw console.log("ERROR POLY: ",{polys:e,minMax:t}),n}}function w(e){e.forEach((e=>{e.forEach((e=>e.terms.sort(((e,t)=>e-t)))),e.sort((({terms:e},{terms:t})=>{if(e.length!==t.length)return e.length-t.length;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return e[n]-t[n];return 0}))}))}function x(e){return e.map((e=>{const t=[];let n;return e.forEach((({$k:e,terms:r})=>{n&&n.terms.length===r.length&&n.terms.every(((e,t)=>e===r[t]))?n.$k+=e:(n={$k:e,terms:r},t.push(n))})),t}))}function k(e,t){const{minimums:n,targetIxs:r}=t,s=r[0],a=(r.length>1&&r[1],t.unionFilter.filter((({filter:t,maxLinBuf:r})=>o.Ex.reduce(((e,n)=>e*t[n].length),1)>0&&r[s]>e&&n.every(((e,t)=>r[t]>=e)))));return Object.assign({},t,{unionFilter:a})}function y(e,t,n){if((0,i.uz)(e,n.lin),c(e,n.unionFilter),0===(n=k(t,n)).unionFilter.length)return;const{lower:r,upper:l}=u(n.unionFilter),p=Object.fromEntries(e.keys.map(((e,t)=>[e,{min:r[t],max:l[t]}]))),m=function({formulas:e,atoms:t},n){const r=h(t,n),s=r.filter((e=>"const"!==e.operation)),o=(0,a.Qy)(r.map((e=>"const"!==e.operation))),i=e.map((e=>e.map((({$k:e,terms:t})=>({$k:t.reduce(((e,t)=>{const n=r[t];return"const"===n.operation?e*n.value:e}),e),terms:t.filter((e=>o[e]>=0)).map((e=>o[e]))})))));return w(i),{formulas:x(i),atoms:s}}(n.formulas,p),f=Object.fromEntries(e.keys.map(((e,t)=>[e,r[t]]))),d=Object.fromEntries(e.keys.map(((e,t)=>[e,l[t]]))),b=(0,s.I3)(m.atoms,{},(e=>e.path[1]),1)([{id:"",values:f}]),v=m.formulas.map((e=>e.reduce(((e,{$k:t,terms:n})=>e+n.reduce(((e,t)=>e*b[t]),t)),0))),g=n.minimums.map(((e,t)=>n.targetIxs.includes(t)||e>v[t])),y=(0,a.Qy)(g),M=n.targetIxs.map((e=>y[e]));m.formulas=m.formulas.filter(((e,t)=>g[t]));const O=n.minimums.filter(((e,t)=>g[t])),E={};for(const[e,t]of Object.entries(n.exclusion)){if("uniqueKey"===e){E[e]=t;const r=o.Gt.filter((e=>d[e]>0));let s=0,i=0;if(r.forEach((e=>{let t=(0,a.w6)(f[e],d[e]);n.exclusion[e]&&(t=t.filter((t=>!n.exclusion[e].includes(t)))),(t.includes(4)||t.includes(5))&&s++,(t.includes(2)||t.includes(3))&&i++})),t.includes(5)&&0===s){if(0===i)return;if(t.includes(3)&&i<2)return}continue}const r=t.filter((t=>f[e]<=t&&t<=d[e]));if(r.includes(f[e])&&r.includes(d[e]))return;r.length>0&&(E[e]=r)}return{cache:!0,lin:n.lin,unionFilter:n.unionFilter,depth:n.depth,targetIxs:M,formulas:m,minimums:O,exclusion:E}}const M=1e-6;class O{constructor({artsVec:e,artSetExclusion:t},n){this.artsVec=void 0,this.exclusion=void 0,this.threshold=-1/0,this.maxUnionFilterLength=50,this.subproblems=[],this.interim=void 0,this.callback=void 0,this.artsVec=e,this.exclusion=t,this.callback=n}setThreshold(e){this.threshold=Math.max(e,this.threshold)}addSubproblem(e){this.subproblems.push(e)}*split(e){for(;this.subproblems.length;){const t=this.subproblems.pop(),n=l(null==t?void 0:t.unionFilter);if(n<=e){yield t;continue}const r=this.splitBNB(t),s=r.reduce(((e,t)=>e+l(t.unionFilter)),0);this.interim?this.interim.skipped+=n-s:this.interim={resultType:"interim",tested:0,failed:0,skipped:n-s,buildValues:void 0},this.subproblems.push(...r),this.reportInterim()}this.reportInterim(!0)}reportInterim(e=!1){this.interim&&(e||this.interim.skipped>1e5)&&(this.callback(this.interim),this.interim=void 0)}shareWork(e){const t=[];for(let n=0;n<e&&!(this.subproblems.length<=1);n++)t.push(this.subproblems.shift());return console.log({numShareTo:e,nprob:this.subproblems.length}),t}splitBNB(e){const t=this.threshold;(0,i.uz)(this.artsVec,e.lin),c(this.artsVec,e.unionFilter),e=k(t,e);const{targetIxs:n,unionFilter:r}=e,s=n[0];let o=[];if(r.length>this.maxUnionFilterLength){o=this.makeRandomBranches(r,s).map((t=>Object.assign({},e,{unionFilter:t})))}else o=this.makeBranches(t,e).map((t=>Object.assign({},e,{unionFilter:t})));const a=[];return o.forEach((e=>{if(0===l(e.unionFilter))return;const n=y(this.artsVec,t,e);if(!n)return;n.depth++;const{lower:r,upper:s}=u(n.unionFilter),o=v(n.formulas,{keys:this.artsVec.keys,lower:r,upper:s});n.lin=o;const i=y(this.artsVec,t,n);i&&a.push({problemSize:l(i.unionFilter),subproblem:i})})),a.sort(((e,t)=>t.problemSize-e.problemSize)),a.map((({subproblem:e})=>e))}makeRandomBranches(e,t){e.sort(((e,n)=>e.maxLinBuf[t]-n.maxLinBuf[t]));const n=Math.ceil(e.length/this.maxUnionFilterLength);return(0,a.uK)(e,n)}makeBranches(e,t){const{minimums:n,lin:r,unionFilter:s,targetIxs:i}=t,l=i[0];if(0===s.length)return[];const{lower:c,upper:p,minLinBuf:m,maxLinBuf:h}=u(s),f=(d=s,(0,a.O)(o.Ex,(e=>[...new Set(d.flatMap((({filter:t})=>t[e])))])));var d;const b=n.map(((e,t)=>(e-m[t])/(h[t]-m[t])));b[l]=(e-m[l])/(h[l]-m[l]);let v=t.targetIxs[0];b.forEach(((e,t)=>{r[t].weights.every((e=>0===e))||b[t]<.5||b[t]>b[v]&&(v=t)}));const g=r[v],w=(0,a.kB)(g.weights,(e=>0!==e));let x="";if(0===w.length){let e=-1;o.Gt.filter((e=>p[e]>0)).forEach((t=>{const n=o.Ex.reduce(((e,n)=>e+f[n].reduce(((e,r)=>e+(this.artsVec.values[n][r].set===t?1:0)),0)),0);n>e&&(e=n,x=t)}))}else{let e=-1;w.forEach((t=>{const n=o.Ex.reduce(((e,n)=>{const r=f[n].map((e=>this.artsVec.values[n][e].values[t])),s=Math.min(...r),o=Math.max(...r);if(s===o)return e;const a=(s+o)/2,i=Math.max(...r.filter((e=>e<=a))),l=Math.min(...r.filter((e=>e>a)));return e+Math.min(o-i,l-s)}),0);let r=g.weights[t]*n;o.Gt.includes(this.artsVec.keys[t])&&(r*=5),r>e&&(x=this.artsVec.keys[t],e=r)}))}const k=this.artsVec.keys.indexOf(x);if(k<0)throw console.error("===================== SHATTER BROKE ====================",{lin:r,artsVec:this.artsVec,artsSel:f},{branchKey:x,branchIx:k}),Error("Could not find branch key (should never happen)");if(o.Gt.includes(x)){return this.branchOnSetKey(x,s)}{const e=(c[k]+p[k])/2;return this.branchOnValue(k,e,s)}}branchOnSetKey(e,t){const n=t.map((({filter:t})=>(0,a.O)(o.Ex,(n=>{const r=this.artsVec.values[n];return t[n].map((t=>r[t].set===e?1:0))})))),r=[],s=[],i=[],l=[r,r,s,s,i,i];return this.partitionSlots(n,t).forEach((e=>{(0,a.Og)(e.flower,e.plume,e.sands,e.goblet,e.circlet).forEach((e=>{const[t,n,r,s,o]=e.map((({ixs:e})=>e)),{upper:a,lower:i}=E(this.artsVec.base,e),u={filter:{flower:t,plume:n,sands:r,goblet:s,circlet:o},lower:i,upper:a,minLinBuf:[],maxLinBuf:[]},c=e.reduce(((e,{group:t})=>e+t),0);l[c].push(u)}))})),[r,s,i]}branchOnValue(e,t,n){const r=n.map((({filter:n})=>this.calculateSplit(e,t,n))),s=[],o=[];return this.partitionSlots(r,n).forEach((n=>{(0,a.Og)(n.flower,n.plume,n.sands,n.goblet,n.circlet).forEach((n=>{const[r,a,i,l,u]=n.map((({ixs:e})=>e)),{upper:c,lower:p}=E(this.artsVec.base,n),m={filter:{flower:r,plume:a,sands:i,goblet:l,circlet:u},lower:p,upper:c,minLinBuf:[],maxLinBuf:[]};(p[e]+c[e])/2>t?o.push(m):s.push(m)}))})),[s,o]}calculateSplit(e,t,n){const r=this.artsVec;t-=r.base[e];const s=o.Ex.map((t=>{const s=n[t].map((n=>({ixs:[n],v:r.values[t][n].values[e]}))).sort((({v:e},{v:t})=>e-t));for(let e=s.length-1;e>0;e-=1)s[e].v===s[e-1].v&&(s[e-1].ixs.push(...s[e].ixs),s.splice(e,1));return s})),i=s.map((([{v:e}])=>e)),l=s.map((e=>e[e.length-1].v-e[0].v));l.every((e=>0===e))&&l.fill(1);const u=(t-i.reduce(((e,t)=>e+t)))/l.reduce(((e,t)=>e+t)),c=s.map(((e,t)=>{let n=-1;for(let r=0;r<e.length;r++)if(e[r].v>=i[t]+u*l[t]){n=r;break}return n<0&&(n=e.length),n}));function p(e){let n=0,r=0;for(let t=0;t<s.length;t++){var o,a,i,l;const u=e[t];n+=null!=(o=null==(a=s[t][u-1])?void 0:a.v)?o:-1/0,r+=null!=(i=null==(l=s[t][u])?void 0:l.v)?i:1/0}return n<=t+M&&t<=r+M}function m(e){return e.reduce(((e,t)=>e*t),1)+e.reduce(((e,t,n)=>e*(s[n].length-t)),1)}if(!p(c))throw new Error("calculateSplit failed! Initial solution infeasible!");const h=[[0,1],[0,-1],[1,1],[1,-1],[2,1],[2,-1],[3,1],[3,-1],[4,1],[4,-1]],f=[[0,1,-1,-1],[0,1,-1,1],[0,1,1,-1],[0,1,1,1],[0,2,-1,-1],[0,2,-1,1],[0,2,1,-1],[0,2,1,1],[0,3,-1,-1],[0,3,-1,1],[0,3,1,-1],[0,3,1,1],[0,4,-1,-1],[0,4,-1,1],[0,4,1,-1],[0,4,1,1],[1,2,-1,-1],[1,2,-1,1],[1,2,1,-1],[1,2,1,1],[1,3,-1,-1],[1,3,-1,1],[1,3,1,-1],[1,3,1,1],[1,4,-1,-1],[1,4,-1,1],[1,4,1,-1],[1,4,1,1],[2,3,-1,-1],[2,3,-1,1],[2,3,1,-1],[2,3,1,1],[2,4,-1,-1],[2,4,-1,1],[2,4,1,-1],[2,4,1,1],[3,4,-1,-1],[3,4,-1,1],[3,4,1,-1],[3,4,1,1]];function d(e){let t={score:m(e)};return h.forEach((([n,r])=>{const o=[...e];if(o[n]+=r,o[n]<0||o[n]>=s[n].length)return;if(!p(o))return;const a=m(o);a>t.score&&(t={score:a,next:o})})),f.forEach((([n,r,o,a])=>{const i=[...e];if(i[n]+=o,i[r]+=a,i[n]<0||i[n]>=s[n].length)return;if(i[r]<0||i[r]>=s[r].length)return;if(!p(i))return;const l=m(i);l>t.score&&(t={score:l,next:i})})),t.next}let b=c,v=c;for(;v;)b=v,v=d(b);return(0,a.O)(o.Ex,((e,t)=>{const r=new Set(s[t].slice(b[t]).flatMap((({ixs:e})=>e)));return n[e].map((e=>r.has(e)?1:0))}))}partitionSlots(e,t,n=[0,1]){return e.map(((e,r)=>{const s=t[r].filter;return(0,a.O)(o.Ex,(t=>{const r=e[t],o=this.artsVec.values[t];return n.map((e=>{const n=s[t].filter(((t,n)=>r[n]===e)),{upper:a,lower:l}=(0,i.Cn)(n.map((e=>o[e])));return{ixs:n,upper:a,lower:l,group:e}}))}))}))}}function E(e,t){return t.reduce((({upper:t,lower:n},{upper:r,lower:s})=>{for(let i=0;i<e.length;i++){var o,a;t[i]+=null!=(o=r[i])?o:0,n[i]+=null!=(a=s[i])?a:0}return{upper:t,lower:n}}),{upper:[...e],lower:[...e]})}let j,B,S;onmessage=e=>{const{data:t}=e,{command:n}=t;switch(n){case"setup":j=new f(t,(e=>postMessage(e))),B=new O(t,(e=>postMessage(e))),postMessage({resultType:"done"});break;case"share":{console.log("Requested to share (b4)",B.subproblems.length);const e=B.shareWork(t.splitsToAdd);console.log("Requested to share work. Worker has N:",B.subproblems.length,{toShare:e}),e.forEach((e=>{postMessage({command:"split",maxIterateSize:S,subproblem:e})}));break}case"split":B.addSubproblem(t.subproblem),S=t.maxIterateSize;case"resume":{let e=0;for(const t of B.split(S))if(t&&postMessage({command:"enumerate",filters:t.unionFilter}),e++>5)return void postMessage({resultType:"checkin"});postMessage({resultType:"done"});break}case"threshold":j.setThreshold(t.threshold),B.setThreshold(t.threshold);break;case"enumerate":j.enumerate(t.filters),t.interrupt||postMessage({resultType:"done"});break;case"finalize":{j.refresh(!0);const{builds:e,plotData:t}=j;postMessage({resultType:"finalize",builds:e,plotData:t}),postMessage({resultType:"done"});break}}}},79924:(e,t,n)=>{n.d(t,{s7:()=>l,sk:()=>a});var r=n(40580),s=n(30597),o=(n(97797),n(36893),n(41015));function a(e,t){const n=new Map;return(0,r.aD)(e,(e=>{}),(e=>{var r;const{operation:a}=e,l=e.operands.map((e=>n.get(e)));let u;switch(a){case"read":if("dyn"!==e.path[0])throw new Error(`Found non-dyn path ${e.path} while computing range`);u=null!=(r=t[e.path[1]])?r:{min:0,max:0};break;case"const":u=i([e.value]);break;case"add":case"min":case"max":u={min:s.aj[a](l.map((e=>e.min))),max:s.aj[a](l.map((e=>e.max)))};break;case"res":u={min:s.aj[a]([l[0].max]),max:s.aj[a]([l[0].min])};break;case"mul":u=l.reduce(((e,t)=>i([e.min*t.min,e.min*t.max,e.max*t.min,e.max*t.max])));break;case"threshold":u=l[0].min>=l[1].max?l[2]:l[0].max<l[1].min?l[3]:i([],[l[2],l[3]]);break;case"sum_frac":{const[e,t]=l,n={min:e.min+t.min,max:e.max+t.max};u=n.min<=0&&n.max>=0?e.min<=0&&e.max>=0?{min:NaN,max:NaN}:{min:-1/0,max:1/0}:i([e.min/n.min,e.min/n.max,e.max/n.min,e.max/n.max]);break}default:(0,o.UT)(a)}n.set(e,u)})),n}function i(e,t=[]){const n=Math.max(...e,...t.map((e=>e.max)));return{min:Math.min(...e,...t.map((e=>e.min))),max:n}}function l(e){let t=.01;let n=new Set(e.flatMap((e=>Object.values(e).map((e=>Math.round(e.plot/t))))));for(;n.size>1500;)t*=2,n=new Set([...n].map((e=>Math.round(e/2))));const r={};for(const n of e)for(const e of Object.values(n)){const n=Math.round(e.plot/t)*t;(!r[n]||r[n].value<e.value)&&(r[n]=e)}return r}},47452:(e,t,n)=>{n.d(t,{Cn:()=>a,IK:()=>i,uz:()=>l,w7:()=>o});var r=n(60467),s=n(41015);function o(e,t){return{keys:e.keys,base:e.base,baseLinBuf:e.baseLinBuf,values:(0,s.O)(r.Ex,(n=>{const r=t[n],s=e.values[n];return r.map((e=>s[e]))}))}}function a(e){if(0===e.length)return{lower:[],upper:[],minw:[],maxw:[]};const t=[...e[0].values],n=[...e[0].values],r=[...e[0].linBuf],s=[...e[0].linBuf];for(let o=1;o<e.length;o++){for(let r=0;r<t.length;r++)t[r]=Math.min(t[r],e[o].values[r]),n[r]=Math.max(n[r],e[o].values[r]);for(let t=0;t<r.length;t++)r[t]=Math.min(r[t],e[o].linBuf[t]),s[t]=Math.max(s[t],e[o].linBuf[t])}return{lower:t,upper:n,minw:r,maxw:s}}function i(e){const t=[...e.base],n=[...e.base],r=[...e.baseLinBuf],s=[...e.baseLinBuf];return Object.values(e.values).forEach((e=>{const o=a(e);for(let e=0;e<t.length;e++)t[e]+=o.lower[e],n[e]+=o.upper[e];for(let e=0;e<r.length;e++)r[e]+=o.minw[e],s[e]+=o.maxw[e]})),{lower:t,upper:n,minLinBuf:r,maxLinBuf:s}}function l(e,t){e.baseLinBuf=t.map((({$c:t,weights:n})=>t+n.reduce(((t,n,r)=>t+n*e.base[r]),0))),Object.values(e.values).forEach((e=>e.forEach((e=>e.linBuf=t.map((({weights:t})=>t.reduce(((t,n,r)=>t+n*e.values[r]),0)))))))}},36893:(e,t,n)=>{var r=n(60467);r.Kn;const s=["TravelerAnemo","TravelerGeo","TravelerElectro","TravelerDendro"];r.Kn,r.Kn,r.j4,r.X7,r.ie,r.oK,r.Xt},41015:(e,t,n)=>{n.d(t,{Hm:()=>r,O:()=>s,Og:()=>l,Qy:()=>p,UT:()=>i,kB:()=>c,uK:()=>u,w6:()=>a});function r(e,t){if(e&&t)return!Array.isArray(t)&&console.error(t),t.reduce(((e,t)=>null==e?void 0:e[t]),e)}function s(e,t){return Object.fromEntries(e.map(((e,n)=>[e,t(e,n)])))}const o=function*(e,t){for(let n=e;n<=t;n++)yield n};function a(e,t){return[...o(e,t)]}function i(e){throw new Error(`Should not reach this with value ${e}`)}function l(...e){return e.reduce(((e,t)=>e.flatMap((e=>t.map((t=>[e,[t]].flat()))))),[[]])}function u(e,t){const n=e.length%t,r=Math.floor(e.length/t);let s=0;return Array.from({length:t},((t,o)=>e.slice(s,s+=r+(o<n?1:0))))}function c(e,t){return e.reduce(((e,n,r)=>(t(n)&&e.push(r),e)),[])}function p(e){let t=0;return e.map((e=>e?t++:-1))}},60467:(e,t,n)=>{n.d(t,{Gt:()=>s,Ex:()=>o,oK:()=>a.oK,Xt:()=>a.Xt,X7:()=>a.X7,ie:()=>a.ie,j4:()=>a.j4,Kn:()=>r.Kn});var r=n(10533);const s=["Adventurer","ArchaicPetra","Berserker","BlizzardStrayer","BloodstainedChivalry","BraveHeart","CrimsonWitchOfFlames","DeepwoodMemories","DefendersWill","DesertPavilionChronicle","EchoesOfAnOffering","EmblemOfSeveredFate","FlowerOfParadiseLost","Gambler","GildedDreams","GladiatorsFinale","HeartOfDepth","HuskOfOpulentDreams","Instructor","Lavawalker","LuckyDog","MaidenBeloved","MartialArtist","NoblesseOblige","OceanHuedClam","PaleFlame","PrayersForDestiny","PrayersForIllumination","PrayersForWisdom","PrayersToSpringtime","ResolutionOfSojourner","RetracingBolide","Scholar","ShimenawasReminiscence","TenacityOfTheMillelith","TheExile","ThunderingFury","Thundersoother","TinyMiracle","TravelingDoctor","VermillionHereafter","ViridescentVenerer","WanderersTroupe"],o=["flower","plume","sands","goblet","circlet"];var a=n(7664)}},r={};function s(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return n[e](o,o.exports,s),o.exports}s.m=n,s.x=()=>{var e=s.O(void 0,[592],(()=>s(96064)));return e=s.O(e)},e=[],s.O=(t,n,r,o)=>{if(!n){var a=1/0;for(c=0;c<e.length;c++){for(var[n,r,o]=e[c],i=!0,l=0;l<n.length;l++)(!1&o||a>=o)&&Object.keys(s.O).every((e=>s.O[e](n[l])))?n.splice(l--,1):(i=!1,o<a&&(a=o));if(i){e.splice(c--,1);var u=r();void 0!==u&&(t=u)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[n,r,o]},s.d=(e,t)=>{for(var n in t)s.o(t,n)&&!s.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},s.f={},s.e=e=>Promise.all(Object.keys(s.f).reduce(((t,n)=>(s.f[n](e,t),t)),[])),s.u=e=>"common.e2fe9b8b013983f2.js",s.miniCssF=e=>{},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.j=64,(()=>{var e;s.g.importScripts&&(e=s.g.location+"");var t=s.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var n=t.getElementsByTagName("script");n.length&&(e=n[n.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=e})(),(()=>{var e={64:1};s.f.i=(t,n)=>{e[t]||importScripts(s.p+s.u(t))};var t=self.webpackChunk=self.webpackChunk||[],n=t.push.bind(t);t.push=t=>{var[r,o,a]=t;for(var i in o)s.o(o,i)&&(s.m[i]=o[i]);for(a&&a(s);r.length;)e[r.pop()]=1;n(t)}})(),t=s.x,s.x=()=>s.e(592).then(t);s.x()})();